<VirtualHost*:80>
	ServerName%(hostname)s
	Redirect/https://%(hostname)s/
	DocumentRoot"/var/www/html/"
</VirtualHost>

<VirtualHost*:443>
	DocumentRoot"/var/www/html/"
	ServerName%(hostname)s:443

	LogLevelwarn
	SSLEngineon
	SSLProtocol-all+TLSv1.1+TLSv1.2
	SSLHonorCipherOrderOn
	SSLCipherSuiteECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-SHA256:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:DHE-RSA-AES128-SHA256:DHE-DSS-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:DHE-RSA-AES128-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!3DES:!MD5:!PSK
	SSLCertificateFile%(httpdCertFn)s
	SSLCertificateKeyFile%(httpdKeyFn)s

	#SetEnvproxy-nokeepalive1
	SetEnvproxy-initial-not-pooled1
	Timeout60
	ProxyTimeout60
	
	#Securityheaders
	#HeaderalwaysappendX-Frame-OptionsSAMEORIGIN
	HeaderalwayssetX-Xss-Protection"1;mode=block"
	HeaderalwayssetX-Content-Type-Optionsnosniff
	#HeaderalwayssetContent-Security-Policy"default-src'self''unsafe-inline'https://%(hostname)s"
	HeaderalwayssetStrict-Transport-Security"max-age=31536000;includeSubDomains"

	HeadereditSet-Cookie^((?!session_state).*)$$1;HttpOnly
	SetEnvIfUser-Agent".*MSIE.*"\
	nokeepalivessl-unclean-shutdown\
	downgrade-1.0force-response-1.0
	
	#UnsetX-ClientCerttomakesurethatwenotgetcertificateinrequest
	RequestHeaderunsetX-ClientCert
	
	#TurnoffsupportfortrueProxybehaviourasweareactingasatransparentproxy
	ProxyRequestsOff
	
	#TurnoffVIAheaderasweknowwheretherequestsareproxied
	ProxyViaOff
	
	#TurnonHostheaderpreservationsothattheservletcontainer
	#canwritelinkswiththecorrecthostandrewritingcanbeavoided.
	ProxyPreserveHostOn
	
	#PreservetheschemewhenproxyingtherequesttoJetty
	RequestHeadersetX-Forwarded-Proto"https"env=HTTPS
	
	HeaderunsetETag
	FileETagNone
	
	RedirectMatch^(/)$/identity/
	
	#Setthepermissionsfortheproxy
	<Proxy*>
		AddDefaultCharsetoff
		Orderdeny,allow
		Allowfromall
	</Proxy>

	<Location/idp>
		ProxyPasshttp://localhost:8086/idpretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/identity>
		ProxyPasshttp://localhost:8082/identityretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/cas>
		ProxyPasshttp://localhost:8083/casretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/oxauth-rp>
		ProxyPasshttp://localhost:8085/oxauth-rpretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/asimba>
		ProxyPasshttp://localhost:8084/asimbaretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/passport>
		ProxyPasshttp://localhost:8090/passportretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>
	
	<Location/casa>
		ProxyPasshttp://localhost:8091/casaretry=5connectiontimeout=60timeout=60
		Orderdeny,allow
		Allowfromall
	</Location>

	<Location/oxauth>
		ProxyPasshttp://localhost:8081/oxauthretry=5connectiontimeout=60timeout=60
		#HeadersetAccess-Control-Allow-Origin"*"
		Orderdeny,allow
		Allowfromall
	</Location>

	<LocationMatch/oxauth/auth/cert/cert-login>
		SSLVerifyClientoptional_no_ca
		SSLVerifyDepth10
		SSLOptions-StdEnvVars+ExportCertData
		
		#Forwardcertificatetodestinationserver
		RequestHeadersetX-ClientCert%{SSL_CLIENT_CERT}s
	</LocationMatch>

	ProxyPass/.well-known/openid-configurationhttp://localhost:8081/oxauth/.well-known/openid-configuration
	ProxyPass/.well-known/simple-web-discoveryhttp://localhost:8081/oxauth/.well-known/simple-web-discovery
	ProxyPass/.well-known/webfingerhttp://localhost:8081/oxauth/.well-known/webfinger
	ProxyPass/.well-known/uma2-configurationhttp://localhost:8081/oxauth/restv1/uma2-configuration
	ProxyPass/.well-known/fido-configurationhttp://localhost:8081/oxauth/restv1/fido-configuration
	ProxyPass/.well-known/fido-u2f-configurationhttp://localhost:8081/oxauth/restv1/fido-configuration
	ProxyPass/.well-known/scim-configurationhttp://localhost:8082/identity/restv1/scim-configuration
</VirtualHost>

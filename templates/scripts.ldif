version: 1

dn: inum=%(inumOrg)s!0011!031C.4A65,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Id Generator script
displayName: id_generator
gluuStatus: false
inum: %(inumOrg)s!0011!031C.4A65
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5pZCBpbXBvcnQgS
 WRHZW5lcmF0b3JUeXBlCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFy
 cmF5SGVscGVyCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdAoKaW1wb3J
 0IGphdmEKCmNsYXNzIElkR2VuZXJhdG9yKElkR2VuZXJhdG9yVHlwZSk6CiAgICBkZWYgX19pbm
 l0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOgogICAgICAgIHNlbGYuY3VycmVudFRpbWVNa
 WxsaXMgPSBjdXJyZW50VGltZU1pbGxpcwoKICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXphdGl
 vbiIKICAgICAgICBwcmludCAiSWQgZ2VuZXJhdG9yLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbH
 kiCgogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIERlc3Ryb3ki
 CiAgICAgICAgcHJpbnQgIklkIGdlbmVyYXRvci4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSIKICA
 gICAgICByZXR1cm4gVHJ1ZSAgIAoKICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOgogICAgIC
 AgIHJldHVybiAxCgogICAgIyBJZCBnZW5lcmF0b3IgaW5pdCBtZXRob2QKICAgICMgICBhcHBJZ
 CBpcyBhcHBsaWNhdGlvbiBJZAogICAgIyAgIGlkVHlwZSBpcyBJZCBUeXBlCiAgICAjICAgaWRQ
 cmVmaXggaXMgSWQgUHJlZml4CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGV
 sLkdsdXVDdXN0b21QZXJzb24KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYX
 ZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+CiAgICBkZWYgZ2VuZXJhd
 GVJZChzZWxmLCBhcHBJZCwgaWRUeXBlLCBpZFByZWZpeCwgY29uZmlndXJhdGlvbkF0dHJpYnV0
 ZXMpOgogICAgICAgIHByaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkIgogICAgICAgIHB
 yaW50ICJJZCBnZW5lcmF0b3IuIEdlbmVyYXRlIElkLiBBcHBJZDogJyIsIGFwcElkLCAiJywgSW
 RUeXBlOiAnIiwgaWRUeXBlLCAiJywgSWRQcmVmaXg6ICciLCBpZFByZWZpeCwgIiciCgogICAgI
 CAgICMgUmV0dXJuIE5vbmUgb3IgZW1wdHkgc3RyaW5nIHRvIHRyaWdnZXIgZGVmYXVsdCBJZCBn
 ZW5lcmF0aW9uIG1ldGhvZAogICAgICAgIHJldHVybiBOb25lCg==
oxScriptType: id_generator
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!13D3.E7AD,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Cache Refresh script
displayName: cache_refresh
gluuStatus: false
inum: %(inumOrg)s!0011!13D3.E7AD
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBDYWNoZVJlZnJlc2hUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQp
 mcm9tIG9yZy5nbHV1Lm94dHJ1c3QubW9kZWwgaW1wb3J0IEdsdXVDdXN0b21BdHRyaWJ1dGUNCg
 0KaW1wb3J0IGphdmENCg0KY2xhc3MgQ2FjaGVSZWZyZXNoKENhY2hlUmVmcmVzaFR5cGUpOg0KI
 CAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYu
 Y3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2V
 sZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcm
 VzaC4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLiBJbml0a
 WFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRl
 ZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQ
 gIkNhY2hlIHJlZnJlc2guIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJDYWNoZSByZWZyZXNoLi
 BEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgI
 yBVcGRhdGUgdXNlciBlbnRyeSBiZWZvcmUgcGVyc2lzdCBpdA0KICAgICMgICB1c2VyIGlzIG9y
 Zy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICBjb25maWd1cmF
 0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcG
 VydHk+DQogICAgZGVmIHVwZGF0ZVVzZXIoc2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMpOg0KICAgICAgICBwcmludCAiQ2FjaGUgcmVmcmVzaC4gVXBkYXRlVXNlciBtZXRob2Qi
 DQoNCiAgICAgICAgYXR0cmlidXRlcyA9IHVzZXIuZ2V0Q3VzdG9tQXR0cmlidXRlcygpDQoNCiA
 gICAgICAgIyBBZGQgbmV3IGF0dHJpYnV0ZSBwcmVmZXJyZWRMYW5ndWFnZQ0KICAgICAgICBhdH
 RyUHJlZmZlcmVkTGFuZ3VhZ2UgPSBHbHV1Q3VzdG9tQXR0cmlidXRlKCJwcmVmZXJyZWRMYW5nd
 WFnZSIsICJlbi11cyIpDQogICAgICAgIGF0dHJpYnV0ZXMuYWRkKGF0dHJQcmVmZmVyZWRMYW5n
 dWFnZSkNCg0KICAgICAgICAjIEFkZCBuZXcgYXR0cmlidXRlIHVzZXJQYXNzd29yZA0KICAgICA
 gICBhdHRyVXNlclBhc3N3b3JkID0gR2x1dUN1c3RvbUF0dHJpYnV0ZSgidXNlclBhc3N3b3JkIi
 wgInRlc3QiKQ0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChhdHRyVXNlclBhc3N3b3JkKQ0KDQogI
 CAgICAgICMgVXBkYXRlIGdpdmVuTmFtZSBhdHRyaWJ1dGUNCiAgICAgICAgZm9yIGF0dHJpYnV0
 ZSBpbiBhdHRyaWJ1dGVzOg0KICAgICAgICAgICAgYXR0ck5hbWUgPSBhdHRyaWJ1dGUuZ2V0TmF
 tZSgpDQogICAgICAgICAgICBpZiAoKCJnaXZlbm5hbWUiID09IFN0cmluZ0hlbHBlci50b0xvd2
 VyQ2FzZShhdHRyTmFtZSkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eShhdHRyaWJ1dGUuZ
 2V0VmFsdWUoKSkpOg0KICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShTdHJpbmdI
 ZWxwZXIucmVtb3ZlTXVsdGlwbGVTcGFjZXMoYXR0cmlidXRlLmdldFZhbHVlKCkpICsgIiAodXB
 kYXRlZCkiKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbi
 hzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: cache_refresh
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!2DAF.F995,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample UMA Authorization policy
displayName: uma_authorization_policy
gluuStatus: true
inum: %(inumOrg)s!0011!2DAF.F995
oxConfigurationProperty: {"value1":"allowed_clients","value2":"%(scim_rp_client_id)s","description":""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51bWEgaW1wb3J0IEF1d
 Ghvcml6YXRpb25Qb2xpY3lUeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVy
 LCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0LCBIYXN
 oU2V0DQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UudW1hLmF1dGhvcml6YXRpb24gaW1wb3J0IE
 F1dGhvcml6YXRpb25Db250ZXh0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEF1dGhvcml6YXRpb25Qb
 2xpY3koQXV0aG9yaXphdGlvblBvbGljeVR5cGUpOg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJy
 ZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGl
 tZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KIC
 AgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml0aWFsaXphdGlvbiINCg0KI
 CAgICAgICBzZWxmLmNsaWVudHNTZXQgPSBzZWxmLnByZXBhcmVDbGllbnRzU2V0KGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKQ0KICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiBJbml
 0aWFsaXphdGlvbi4gQ291bnQgYXV0aG9yaXplZCBjbGllbnRzOiAlcyIgJSBzZWxmLmNsaWVudHNTZX
 Quc2l6ZSgpDQoNCiAgICAgICAgcHJpbnQgIlVNQSBhdXRob3JpemF0aW9uIHBvbGljeS4gSW5pdGlhb
 Gl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVz
 dHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgYXV
 0aG9yaXphdGlvbiBwb2xpY3kuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJVTUEgYXV0aG9yaXphdG
 lvbiBwb2xpY3kuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgD
 QoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgICMg
 UHJvY2VzcyBwb2xpY3kgcnVsZQ0KICAgICMgICBhdXRob3JpemF0aW9uQ29udGV4dCBpcyBvcmcueGR
 pLm94YXV0aC5zZXJ2aWNlLnVtYS5hdXRob3JpemF0aW9uLkF1dGhvcml6YXRpb25Db250ZXh0DQogIC
 AgIyAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wb
 GVDdXN0b21Qcm9wZXJ0eT4NCiAgICBkZWYgYXV0aG9yaXplKHNlbGYsIGF1dGhvcml6YXRpb25Db250
 ZXh0LCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXp
 hdGlvbiBwb2xpY3kuIEF0dGVtcHRpbmcgdG8gYXV0aG9yaXplIGNsaWVudCINCiAgICAgICAgY2xpZW
 50X2lkID0gYXV0aG9yaXphdGlvbkNvbnRleHQuZ2V0R3JhbnQoKS5nZXRDbGllbnRJZCgpDQoNCiAgI
 CAgICAgcHJpbnQgIlVNQSBBdXRob3JpemF0aW9uIHBvbGljeS4gQ2xpZW50OiAiLCBjbGllbnRfaWQN
 CiAgICAgICAgaWYgKHNlbGYuY2xpZW50c1NldC5jb250YWlucyhjbGllbnRfaWQpKToNCiAgICAgICA
 gICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3kuIEF1dGhvcml6aW5nIGNsaWVudCINCi
 AgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICBwcmludCAiV
 U1BIEF1dGhvcml6YXRpb24gcG9saWN5LiBDbGllbnQgaXNuJ3QgYXV0aG9yaXplZCINCiAgICAgICAg
 ICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHByaW50ICJVTUEgQXV0aG9yaXphdGlvbiBwb2xpY3k
 uIEF1dGhvcml6aW5nIGNsaWVudCINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcmVwYX
 JlQ2xpZW50c1NldChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNsaWVud
 HNTZXQgPSBIYXNoU2V0KCkNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5j
 b250YWluc0tleSgiYWxsb3dlZF9jbGllbnRzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHN
 TZXQNCg0KICAgICAgICBhbGxvd2VkQ2xpZW50c0xpc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImFsbG93ZWRfY2xpZW50cyIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIChTdHJpbmdIZWxwZ
 XIuaXNFbXB0eShhbGxvd2VkQ2xpZW50c0xpc3QpKToNCiAgICAgICAgICAgIHByaW50ICJVTUEgYXV0
 aG9yaXphdGlvbiBwb2xpY3kuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgYWxsb3dlZF9jbGl
 lbnRzIGlzIGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudHNTZXQgICAgDQoNCiAgICAgIC
 AgYWxsb3dlZENsaWVudHNMaXN0QXJyYXkgPSBTdHJpbmdIZWxwZXIuc3BsaXQoYWxsb3dlZENsaWVud
 HNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcHR5KGFsbG93ZWRDbGllbnRz
 TGlzdEFycmF5KSk6DQogICAgICAgICAgICBwcmludCAiVU1BIGF1dGhvcml6YXRpb24gcG9saWN5LiB
 Jbml0aWFsaXphdGlvbi4gVGhlcmUgYXJlbid0IGNsaWVudHMgc3BlY2lmaWVkIGluIGFsbG93ZWRfY2
 xpZW50cyBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBjbGllbnRzU2V0DQogICAgICAgIA0KI
 CAgICAgICAjIENvbnZlcnQgdG8gSGFzaFNldCB0byBxdWljayBzZWFyY2gNCiAgICAgICAgaSA9IDAN
 CiAgICAgICAgY291bnQgPSBsZW4oYWxsb3dlZENsaWVudHNMaXN0QXJyYXkpDQogICAgICAgIHdoaWx
 lIChpIDwgY291bnQpOg0KICAgICAgICAgICAgY2xpZW50ID0gYWxsb3dlZENsaWVudHNMaXN0QXJyYX
 lbaV0NCiAgICAgICAgICAgIGNsaWVudHNTZXQuYWRkKGNsaWVudCkNCiAgICAgICAgICAgIGkgPSBpI
 CsgMQ0KDQogICAgICAgIHJldHVybiBjbGllbnRzU2V0DQo=
oxScriptType: uma_authorization_policy
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!522F.CDC5,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Update User script
displayName: update_user
gluuStatus: false
inum: %(inumOrg)s!0011!522F.CDC5
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9yd
 CBVcGRhdGVVc2VyVHlwZQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyLCBB
 cnJheUhlbHBlcgpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QKCmltcG9
 ydCBqYXZhCgpjbGFzcyBVcGRhdGVVc2VyKFVwZGF0ZVVzZXJUeXBlKToKICAgIGRlZiBfX2luaX
 RfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6CiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pb
 GxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzCgogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGlv
 bkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gSW5pdGlhbGl6YXRpb24
 iCiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiCg
 ogICAgICAgIHJldHVybiBUcnVlICAgCgogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMpOgogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gRGVzdHJveSIKICAg
 ICAgICBwcmludCAiVXBkYXRlIHVzZXIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiCiAgICAgICA
 gcmV0dXJuIFRydWUgICAKCiAgICAjIFVwZGF0ZSB1c2VyIGVudHJ5IGJlZm9yZSBwZXJzaXN0ZW
 50IGl0CiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZ
 XJzb24KICAgICMgICBwZXJzaXN0ZWQgaXMgYm9vbGVhbiB2YWx1ZSB0byBzcGVjaWZ5IGlmIG9w
 ZXJhdGlvbiB0eXBlOiBhZGQvbW9kaWZ5CiAgICAjICAgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 gaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5PgogICAgZGVmIH
 VwZGF0ZVVzZXIoc2VsZiwgdXNlciwgcGVyc2lzdGVkLCBjb25maWd1cmF0aW9uQXR0cmlidXRlc
 yk6CiAgICAgICAgcHJpbnQgIlVwZGF0ZSB1c2VyLiBVcGRhdGVVc2VyIG1ldGhvZCIKCiAgICAg
 ICAgdWlkID0gdXNlci5nZXRVaWQoKQogICAgICAgIHByaW50ICJVcGRhdGUgdXNlci4gVXNlciB
 VaWQ6IiwgdWlkCiAgICAgICAgCiAgICAgICAgbWFpbCA9IHVpZCArICJAZXhhbXBsZS5vcmciCi
 AgICAgICAgdXNlci5zZXRNYWlsKG1haWwpCgogICAgICAgIHJldHVybiBUcnVlCgogICAgZGVmI
 GdldEFwaVZlcnNpb24oc2VsZik6CiAgICAgICAgcmV0dXJuIDEK
oxScriptType: update_user
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!6EA0.8F0C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample User Registration script
displayName: user_registration
gluuStatus: false
inum: %(inumOrg)s!0011!6EA0.8F0C
oxConfigurationProperty: {"value1":"enable_user","value2":"false","description":
 ""}
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS51c2VyIGltcG9ydCBVc
 2VyUmVnaXN0cmF0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLmxkYXAubW9kZWwgaW1wb3J0IEdsdXVTdGF0
 dXMNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9
 tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QNCg0KaW1wb3J0IGphdmENCg0KY2xhc3
 MgVXNlclJlZ2lzdHJhdGlvbihVc2VyUmVnaXN0cmF0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fK
 HNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9
 IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cml
 idXRlcyk6DQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6YXRpb24iDQ
 oNCiAgICAgICAgc2VsZi5lbmFibGVfdXNlciA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJlbmFibGVfdXNlciIpLmdldFZhbHVlMigpLCBGYWxzZSkNCg0K
 ICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSI
 NCg0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb24uIERlc3Ryb
 3kiDQogICAgICAgIHByaW50ICJVc2VyIHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxs
 eSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXNlciByZWdpc3RyYXRpb24gaW5pdCB
 tZXRob2QNCiAgICAjICAgdXNlciBpcyBvcmcuZ2x1dS5veHRydXN0Lm1vZGVsLkdsdXVDdXN0b21QZX
 Jzb24NCiAgICAjICAgcmVxdWVzdFBhcmFtZXRlcnMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFN0c
 mluZ1tdPg0KICAgICMgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0
 cmluZywgU2ltcGxlQ3VzdG9tUHJvcGVydHk+DQogICAgZGVmIGluaXRSZWdpc3RyYXRpb24oc2VsZiw
 gdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgIC
 AgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9uLiBJbml0IG1ldGhvZCINCg0KICAgICAgICByZXR1cm4gV
 HJ1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwcmUgbWV0aG9kDQogICAgIyAgIHVzZXIgaXMg
 b3JnLmdsdXUub3h0cnVzdC5tb2RlbC5HbHV1Q3VzdG9tUGVyc29uDQogICAgIyAgIHJlcXVlc3RQYXJ
 hbWV0ZXJzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTdHJpbmdbXT4NCiAgICAjICAgY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3Blc
 nR5Pg0KICAgIGRlZiBwcmVSZWdpc3RyYXRpb24oc2VsZiwgdXNlciwgcmVxdWVzdFBhcmFtZXRlcnMs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlVzZXIgcmVnaXN0cmF0aW9
 uLiBQcmUgbWV0aG9kIg0KDQogICAgICAgIHVzZXJTdGF0dXMgPSBHbHV1U3RhdHVzLkFDVElWRQ0KIC
 AgICAgICBpZiBub3Qgc2VsZi5lbmFibGVfdXNlcjoNCiAgICAgICAgICAgIHVzZXJTdGF0dXMgPSBHb
 HV1U3RhdHVzLklOQUNUSVZFDQoNCiAgICAgICAgIyBEaXNhYmxlL0VuYWJsZSByZWdpc3RlcmVkIHVz
 ZXINCiAgICAgICAgdXNlci5zZXRTdGF0dXModXNlclN0YXR1cykNCg0KICAgICAgICByZXR1cm4gVHJ
 1ZQ0KDQogICAgIyBVc2VyIHJlZ2lzdHJhdGlvbiBwb3N0IG1ldGhvZA0KICAgICMgICB1c2VyIGlzIG
 9yZy5nbHV1Lm94dHJ1c3QubW9kZWwuR2x1dUN1c3RvbVBlcnNvbg0KICAgICMgICByZXF1ZXN0UGFyY
 W1ldGVycyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU3RyaW5nW10+DQogICAgIyAgIGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21Qcm9wZXJ
 0eT4NCiAgICBkZWYgcG9zdFJlZ2lzdHJhdGlvbihzZWxmLCB1c2VyLCByZXF1ZXN0UGFyYW1ldGVycy
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiVXNlciByZWdpc3RyYXRpb
 24uIFBvc3QgbWV0aG9kIg0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVy
 c2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg==
oxScriptType: user_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!A51E.76DA,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Authentication script
displayName: basic
gluuStatus: false
inum: %(inumOrg)s!0011!A51E.76DA
oxLevel: 100
oxModuleProperty: {"value1":"usage_type","value2":"both","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20g
 b3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJTZXJ
 2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZS
 k6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pd
 ChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6YXRpb24iDQogICAgICAgIHByaW50ICJCYXNpYy4gSW5pdGlhbGl6ZWQgc3VjY2Vz
 c2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMuIERlc3Ryb3k
 iDQogICAgICAgIHByaW50ICJCYXNpYy4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgICAgICByZX
 R1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KI
 CAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAg
 ZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHB
 yaW50ICJCYXNpYy4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgIC
 AgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICAgICAgICAgICBsb
 2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJf
 cGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW5
 0aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIH
 JldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxd
 WVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJCYXNpYy4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgICAgICAgICAgcmV0dXJu
 IFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXM
 sIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldH
 VybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY
 29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!4BBE.C6A8,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Basic (with user locking)
displayName: basic_lock
gluuStatus: false
inum: %(inumOrg)s!0011!4BBE.C6A8
oxConfigurationProperty: {"value1":"invalid_login_count_attribute","value2":
 "oxCountInvalidLogin","description":""}
oxConfigurationProperty: {"value1":"maximum_invalid_login_attemps","value2":
 "3","description":""}
oxLevel: 110
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20g
 b3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J0IFVzZXJTZXJ
 2aWNlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy5nbHV1LnNpdGUubGRhcC5wZXJzaXN0ZW5jZS5leGNlcHRpb24gaW1wb3J0IEF1dGhlbnRpY2F0aW9uRX
 hjZXB0aW9uDQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUa
 W1lTWlsbGlzKToNCiAgICAgICAgc2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQog
 ICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0dHJpYnV0ZSA9ICJveENvdW50SW52YWxpZEx
 vZ2luIg0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiaW52YWxpZF9sb2dpbl9jb3VudF9hdHRyaWJ1dGUiKToNCiAgICAgICAgICAgIHNlbGYuaW52YWxpZE
 xvZ2luQ291bnRBdHRyaWJ1dGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgZWxzZToNCiAgI
 CAgICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gSW5pdGlhbGl6YXRpb24uIFVzaW5nIGRlZmF1bHQgYXR0cmlidXRlIg0KDQogICAgICAgIHNlbGYubWF4aW11bUludmFsaWRMb2dp
 bkF0dGVtcHMgPSAzDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wcyIpOg0KICAgICAgICAgICAgc2VsZi5
 tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcyA9IFN0cmluZ0hlbHBlci50b0ludGVnZXIoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJtYXhpbXVtX2ludmFsaWRfbG9naW5fYXR0ZW1wcyIpLm
 dldFZhbHVlMigpKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBJbml0aWFsaXphdGlvbi4gVXNpbmcgZGVmYXVsdCBudW1iZXIgYXR0ZW1wd
 HMiDQoNCiAgICAgICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkuIGludmFsaWRfbG9naW5fY291bnRfYXR0cmlidXRlOiAnJXMnLCBtYXhpbXVt
 X2ludmFsaWRfbG9naW5fYXR0ZW1wczogJyVzJyIgJSAoc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0dHJpYnV0ZSwgc2VsZi5tYXhpbXVtSW52YWxpZExvZ2luQXR0ZW1wcykNCg0KICAgICAgICByZXR
 1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIERlc3Ryb3kiDQogIC
 AgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KI
 CAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJu
 IFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9
 uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgIC
 AgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KDQogICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q
 3JlZGVudGlhbHMoKQ0KICAgICAgICAgICAgdXNlcl9uYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3
 b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXI
 uaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKSk6DQogICAgICAgICAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgdHJ5Og0KIC
 AgICAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KICAgICAgICAgICAgICAgIGV4Y2VwdCBBdXRoZW50a
 WNhdGlvbkV4Y2VwdGlvbjoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBBdXRoZW50aWNhdGUuIEZhaWxlZCB0byBhdXRoZW50aWNhdGUgdXNlciAnJXMn
 IiAlIHVzZXJfbmFtZQ0KDQogICAgICAgICAgICBpZiAobm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgY291bnRJbnZhbGlkTG9naW5BcnJpYnV0ZVZhbHVlID0gc2VsZi5nZXRVc2VyQXR
 0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxmLmludmFsaWRMb2dpbkNvdW50QXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZExvZ2luID0gU3RyaW5nSGVscGVyLnRvSW50ZW
 dlcihjb3VudEludmFsaWRMb2dpbkFycmlidXRlVmFsdWUsIDApDQoNCiAgICAgICAgICAgICAgICBpZiBjb3VudEludmFsaWRMb2dpbiA8IHNlbGYubWF4aW11bUludmFsaWRMb2dpbkF0dGVtcHM6D
 QogICAgICAgICAgICAgICAgICAgIGNvdW50SW52YWxpZExvZ2luID0gY291bnRJbnZhbGlkTG9naW4gKyAxDQogICAgICAgICAgICAgICAgICAgIHNlbGYuc2V0VXNlckF0dHJpYnV0ZVZhbHVlKHVz
 ZXJfbmFtZSwgc2VsZi5pbnZhbGlkTG9naW5Db3VudEF0dHJpYnV0ZSwgU3RyaW5nSGVscGVyLnRvU3RyaW5nKGNvdW50SW52YWxpZExvZ2luKSkNCg0KICAgICAgICAgICAgICAgIGlmIGNvdW50SW5
 2YWxpZExvZ2luID49IHNlbGYubWF4aW11bUludmFsaWRMb2dpbkF0dGVtcHM6DQogICAgICAgICAgICAgICAgICAgIHNlbGYubG9ja1VzZXIodXNlcl9uYW1lKQ0KICAgICAgICAgICAgICAgICAgIC
 ANCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5zZXRVc2VyQXR0cmlidXRlVmFsdWUodXNlcl9uYW1lLCBzZWxmLmludmFsaWRMb2dpbkNvdW50QXR0cmlid
 XRlLCBTdHJpbmdIZWxwZXIudG9TdHJpbmcoMCkpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVw
 YXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgICBwcmludCAiQmF
 zaWMgKGxvY2sgYWNjb3VudCkuIFByZXBhcmUgZm9yIFN0ZXAgMSINCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIG
 RlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlb
 nRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRy
 aWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJ
 ldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0VXNlckF0dHJpYnV0ZVZhbHVlKHNlbGYsIHVzZXJfbmFtZSwgYXR0cmlidXRlX25hbWUpOg0KICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh1c2
 VyX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gd
 XNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUsIGF0dHJpYnV0ZV9uYW1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQog
 ICAgICAgIGN1c3RvbV9hdHRyaWJ1dGVfdmFsdWUgPSB1c2VyU2VydmljZS5nZXRDdXN0b21BdHRyaWJ1dGUoZmluZF91c2VyX2J5X3VpZCwgYXR0cmlidXRlX25hbWUpDQogICAgICAgIGlmIGN1c3R
 vbV9hdHRyaWJ1dGVfdmFsdWUgPT0gTm9uZToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBhdHRyaWJ1dGVfdmFsdWUgPSBjdXN0b21fYXR0cmlidXRlX3ZhbHVlLm
 dldFZhbHVlKCkNCg0KICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIEdldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICclcycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJ
 SAodXNlcl9uYW1lLCBhdHRyaWJ1dGVfbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiBhdHRyaWJ1dGVfdmFsdWUNCg0KICAgIGRlZiBzZXRVc2VyQXR0cmlidXRlVmFsdWUo
 c2VsZiwgdXNlcl9uYW1lLCBhdHRyaWJ1dGVfbmFtZSwgYXR0cmlidXRlX3ZhbHVlKToNCiAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkodXNlcl9uYW1lKToNCiAgICAgICAgICAgIHJldHV
 ybiBOb25lDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW
 1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgdXNlclNlcnZpY2Uuc2V0Q3VzdG9tQXR0cmlid
 XRlKGZpbmRfdXNlcl9ieV91aWQsIGF0dHJpYnV0ZV9uYW1lLCBhdHRyaWJ1dGVfdmFsdWUpDQogICAgICAgIHVwZGF0ZWRfdXNlciA9IHVzZXJTZXJ2aWNlLnVwZGF0ZVVzZXIoZmluZF91c2VyX2J5
 X3VpZCkNCg0KICAgICAgICBwcmludCAiQmFzaWMgKGxvY2sgYWNjb3VudCkuIFNldCB1c2VyIGF0dHJpYnV0ZS4gVXNlcidzICclcycgYXR0cmlidXRlICclcycgdmFsdWUgaXMgJyVzJyIgJSAodXN
 lcl9uYW1lLCBhdHRyaWJ1dGVfbmFtZSwgYXR0cmlidXRlX3ZhbHVlKQ0KDQogICAgICAgIHJldHVybiB1cGRhdGVkX3VzZXINCg0KICAgIGRlZiBsb2NrVXNlcihzZWxmLCB1c2VyX25hbWUpOg0KIC
 AgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eSh1c2VyX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlK
 CkNCg0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUpDQogICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAg
 ICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICBzdGF0dXNfYXR0cmlidXRlX3ZhbHVlID0gdXNlclNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGZpbmRfdXNlcl9ieV91aWQsICJnbHV1U3RhdHVzIik
 NCiAgICAgICAgaWYgc3RhdHVzX2F0dHJpYnV0ZV92YWx1ZSAhPSBOb25lOg0KICAgICAgICAgICAgdXNlcl9zdGF0dXMgPSBzdGF0dXNfYXR0cmlidXRlX3ZhbHVlLmdldFZhbHVlKCkNCiAgICAgIC
 AgICAgIGlmIFN0cmluZ0hlbHBlci5lcXVhbHModXNlcl9zdGF0dXMsICJpbmFjdGl2ZSIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJCYXNpYyAobG9jayBhY2NvdW50KS4gTG9jayB1c2VyLiBVc
 2VyICclcycgbG9ja2VkIGFscmVhZHkiICUgdXNlcl9uYW1lDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIA0KICAgICAgICB1c2VyU2VydmljZS5zZXRDdXN0b21BdHRyaWJ1dGUoZmlu
 ZF91c2VyX2J5X3VpZCwgImdsdXVTdGF0dXMiLCAiaW5hY3RpdmUiKQ0KICAgICAgICB1cGRhdGVkX3VzZXIgPSB1c2VyU2VydmljZS51cGRhdGVVc2VyKGZpbmRfdXNlcl9ieV91aWQpDQoNCiAgICA
 gICAgcHJpbnQgIkJhc2ljIChsb2NrIGFjY291bnQpLiBMb2NrIHVzZXIuIFVzZXIgJyVzJyBsb2NrZWQiICUgdXNlcl9uYW1lDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!8BAF.80D6,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Fido U2F authentication module
displayName: u2f
gluuStatus: false
inum: %(inumOrg)s!0011!8BAF.80D6
oxConfigurationProperty: {"value1":"u2f_application_id","value2":"https://%(hostname)s","description":""}
oxConfigurationProperty: {"value1":"u2f_server_uri","value2":"https://%(hostname)s","description":""}
oxLevel: 10
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQ
 ZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLmpib3NzLnNlYW0uY29udGV4dHMgaW1wb3J0IENvbnRleHQsIENvbnRleHRzDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9
 ydCBJZGVudGl0eQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZSwgQXV0aGVudGljYXRpb25TZXJ2aWNlLCBTZXNzaW9uU3RhdGVTZXJ2aWNlDQpmcm9tIG9yZy
 54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLnhkaS5veGF1dGguY2xpZW50LmZpZG8udTJmIGltcG9ydCBGa
 WRvVTJmQ2xpZW50RmFjdG9yeQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmZpZG8udTJmIGltcG9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0
 aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20gb3JnLnhkaS5veGF1dGgubW9kZWwuY29uZmlnIGltcG9ydCBDb25zdGFudHMNCmZyb20gb3JnLmpib3NzLnJlc3RlYXN5LmNsaWVudCBpbXBvcnQgQ2x
 pZW50UmVzcG9uc2VGYWlsdXJlDQpmcm9tIGphdmF4LndzLnJzLmNvcmUgaW1wb3J0IFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQoNCmltcG9ydCBzeXMNCmltcG9ydCBqYX
 ZhDQoNCmNsYXNzIFBlcnNvbkF1dGhlbnRpY2F0aW9uKFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZSk6DQogICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc
 2VsZi5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJVMkYuIElu
 aXRpYWxpemF0aW9uIg0KDQogICAgICAgIHByaW50ICJVMkYuIEluaXRpYWxpemF0aW9uLiBEb3dubG9hZGluZyBVMkYgbWV0YWRhdGEiDQogICAgICAgIHUyZl9zZXJ2ZXJfdXJpID0gY29uZmlndXJ
 hdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ1MmZfc2VydmVyX3VyaSIpLmdldFZhbHVlMigpDQogICAgICAgIHUyZl9zZXJ2ZXJfbWV0YWRhdGFfdXJpID0gdTJmX3NlcnZlcl91cmkgKyAiLy53ZWxsLWtub3
 duL2ZpZG8tdTJmLWNvbmZpZ3VyYXRpb24iDQoNCiAgICAgICAgbWV0YURhdGFDb25maWd1cmF0aW9uU2VydmljZSA9IEZpZG9VMmZDbGllbnRGYWN0b3J5Lmluc3RhbmNlKCkuY3JlYXRlTWV0YURhd
 GFDb25maWd1cmF0aW9uU2VydmljZSh1MmZfc2VydmVyX21ldGFkYXRhX3VyaSkNCg0KICAgICAgICBtYXhfYXR0ZW1wdHMgPSAzDQogICAgICAgIGZvciBhdHRlbXB0IGluIHJhbmdlKDEsIG1heF9h
 dHRlbXB0cyk6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgc2VsZi5tZXRhRGF0YUNvbmZpZ3VyYXRpb24gPSBtZXRhRGF0YUNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldE1ldGFkYXR
 hQ29uZmlndXJhdGlvbigpDQogICAgICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cmUsIGV4Og0KICAgICAgICAgICAgICAgICMgRGV0ZWN0IG
 lmIGxhc3QgdHJ5IG9yIHdlIHN0aWxsIGdldCBTZXJ2aWNlIFVuYXZhaWxhYmxlIEhUVFAgZXJyb3INCiAgICAgICAgICAgICAgICBpZiAoYXR0ZW1wdCA9PSBtYXhfYXR0ZW1wdHMpIG9yIChleC5nZ
 XRSZXNwb25zZSgpLmdldFJlc3BvbnNlU3RhdHVzKCkgIT0gUmVzcG9uc2UuU3RhdHVzLlNFUlZJQ0VfVU5BVkFJTEFCTEUpOg0KICAgICAgICAgICAgICAgICAgICByYWlzZSBleA0KDQogICAgICAg
 ICAgICAgICAgamF2YS5sYW5nLlRocmVhZC5zbGVlcCgzMDAwKQ0KICAgICAgICAgICAgICAgIHByaW50ICJBdHRlbXB0aW5nIHRvIGxvYWQgbWV0YWRhdGE6ICVkIiAlIGF0dGVtcHQNCiAgICAgICA
 gDQogICAgICAgIHByaW50ICJVMkYuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdH
 RyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlUyRi4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIlUyRi4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgI
 GRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25B
 dHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KIC
 AgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiAgICAgI
 CAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdl
 dFBhc3N3b3JkKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGV
 scGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgICAgIGxvZ2
 dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZ
 XR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJVMkYuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAy
 Ig0KDQogICAgICAgICAgICB0b2tlbl9yZXNwb25zZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywgInRva2VuUmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgdG9
 rZW5fcmVzcG9uc2UgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gdG9rZW5SZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgYXV0aF9tZXRob2QgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXRlcnMsICJhdXRoTWV0aG9kIikNCiAgICAgICAgI
 CAgIGlmIGF1dGhfbWV0aG9kID09IE5vbmU6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGF1dGhNZXRob2QgaXMgZW1wdHkiDQogICAgICAgICAg
 ICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICB1c2VyID0gYXV
 0aGVudGljYXRpb25TZXJ2aWNlLmdldEF1dGhlbnRpY2F0ZWRVc2VyKCkNCiAgICAgICAgICAgIGlmICh1c2VyID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJVMkYuIFByZXBhcmUgZm
 9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGlmIChhdXRoX21ldGhvZCA9PSAnYXV0aGVud
 GljYXRlJyk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIGZpbmlzaCBhdXRoZW50aWNhdGlvbiB3b3JrZmxv
 dyINCiAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3RvcnkuaW5zdGFuY2UoKS5jcmVhdGVBdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ
 2aWNlKHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uU3RhdHVzID0gYXV0aGVudGljYXRpb25SZXF1ZXN0U2VydmljZS5maW5pc2hBdXRoZW
 50aWNhdGlvbih1c2VyLmdldFVzZXJJZCgpLCB0b2tlbl9yZXNwb25zZSkNCg0KICAgICAgICAgICAgICAgIGlmIChhdXRoZW50aWNhdGlvblN0YXR1cy5nZXRTdGF0dXMoKSAhPSBDb25zdGFudHMuU
 kVTVUxUX1NVQ0NFU1MpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiVTJGLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gR2V0IGludmFsaWQgYXV0aGVudGljYXRpb24gc3RhdHVzIGZyb20g
 RklETyBVMkYgc2VydmVyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbGlmIChhdXRoX21ldGhvZCA
 9PSAnZW5yb2xsJyk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIGZpbmlzaCByZWdpc3RyYXRpb24gd29ya2
 Zsb3ciDQogICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9uUmVxdWVzdFNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5pbnN0YW5jZSgpLmNyZWF0ZVJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2a
 WNlKHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblN0YXR1cyA9IHJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlLmZpbmlzaFJlZ2lzdHJhdGlv
 bih1c2VyLmdldFVzZXJJZCgpLCB0b2tlbl9yZXNwb25zZSkNCg0KICAgICAgICAgICAgICAgIGlmIChyZWdpc3RyYXRpb25TdGF0dXMuZ2V0U3RhdHVzKCkgIT0gQ29uc3RhbnRzLlJFU1VMVF9TVUN
 DRVNTKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEdldCBpbnZhbGlkIHJlZ2lzdHJhdGlvbiBzdGF0dXMgZnJvbSBGSURPIFUyRiBzZX
 J2ZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgI
 lUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBBdXRoZW50aWNhdGlvZCBtZXRob2QgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIEZh
 bHNlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmF
 tZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQ
 ogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHNlc3Npb25fc3RhdGUgPSBTZXNzaW9uU3Rhd
 GVTZXJ2aWNlLmluc3RhbmNlKCkuZ2V0U2Vzc2lvblN0YXRlRnJvbUNvb2tpZSgpDQogICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eShzZXNzaW9uX3N0YXRlKToNCiAgICAgICAgICAg
 ICAgICBwcmludCAiVTJGLiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgc2Vzc2lvbl9zdGF0ZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICA
 gICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgIHVzZXIgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuZ2V0QXV0aGVudG
 ljYXRlZFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lI
 HVzZXIgbmFtZSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdTJmX2FwcGxpY2F0aW9uX2lkID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ1MmZfYXBw
 bGljYXRpb25faWQiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgaGF2ZSByZWdpc3RlcmVkIGRldmljZXMNCiAgICAgICAgICAgIGRldmljZVJlZ2lzdHJhdGlvblN
 lcnZpY2UgPSBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICAgICAgdXNlckludW0gPSB1c2VyLmdldEF0dHJpYnV0ZSgiaW51bSIpDQoNCiAgICAgICAgICAgIH
 JlZ2lzdHJhdGlvblJlcXVlc3QgPSBOb25lDQogICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3QgPSBOb25lDQoNCiAgICAgICAgICAgIGRldmljZVJlZ2lzdHJhdGlvbnMgPSBkZXZpY2VSZ
 Wdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyRGV2aWNlUmVnaXN0cmF0aW9ucyh1c2VySW51bSwgdTJmX2FwcGxpY2F0aW9uX2lkKQ0KICAgICAgICAgICAgaWYgKGRldmljZVJlZ2lzdHJhdGlvbnMu
 c2l6ZSgpID4gMCk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBDYWxsIEZJRE8gVTJGIGluIG9yZGVyIHRvIHN0YXJ0IGF1dGhlbnRpY2F0aW9uIHdvcmt
 mbG93Ig0KDQogICAgICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlID0gRmlkb1UyZkNsaWVudEZhY3RvcnkuaW5zdGFuY2UoKS
 5jcmVhdGVBdXRoZW50aWNhdGlvblJlcXVlc3RTZXJ2aWNlKHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgICAgICAgICBhdXRoZW50aWNhdGlvblJlcXVlc3QgPSBhdXRoZ
 W50aWNhdGlvblJlcXVlc3RTZXJ2aWNlLnN0YXJ0QXV0aGVudGljYXRpb24odXNlci5nZXRVc2VySWQoKSwgTm9uZSwgdTJmX2FwcGxpY2F0aW9uX2lkLCBzZXNzaW9uX3N0YXRlKQ0KICAgICAgICAg
 ICAgICAgIGV4Y2VwdCBDbGllbnRSZXNwb25zZUZhaWx1cmUsIGV4Og0KICAgICAgICAgICAgICAgICAgICBpZiAoZXguZ2V0UmVzcG9uc2UoKS5nZXRSZXNwb25zZVN0YXR1cygpICE9IFJlc3BvbnN
 lLlN0YXR1cy5OT1RfRk9VTkQpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gc3RhcnQgYXV0aGVudGljYXRpb24gd29ya2
 Zsb3cuIEV4Y2VwdGlvbjoiLCBzeXMuZXhjX2luZm8oKVsxXQ0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHBya
 W50ICJVMkYuIFByZXBhcmUgZm9yIHN0ZXAgMi4gQ2FsbCBGSURPIFUyRiBpbiBvcmRlciB0byBzdGFydCByZWdpc3RyYXRpb24gd29ya2Zsb3ciDQogICAgICAgICAgICAgICAgcmVnaXN0cmF0aW9u
 UmVxdWVzdFNlcnZpY2UgPSBGaWRvVTJmQ2xpZW50RmFjdG9yeS5pbnN0YW5jZSgpLmNyZWF0ZVJlZ2lzdHJhdGlvblJlcXVlc3RTZXJ2aWNlKHNlbGYubWV0YURhdGFDb25maWd1cmF0aW9uKQ0KICA
 gICAgICAgICAgICAgIHJlZ2lzdHJhdGlvblJlcXVlc3QgPSByZWdpc3RyYXRpb25SZXF1ZXN0U2VydmljZS5zdGFydFJlZ2lzdHJhdGlvbih1c2VyLmdldFVzZXJJZCgpLCB1MmZfYXBwbGljYXRpb2
 5faWQsIHNlc3Npb25fc3RhdGUpDQoNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJmaWRvX3UyZl9hdXRoZW50aWNhdGlvbl9yZXF1ZXN0IiwgU2VydmVyVXRpbC5hc0pzb24oYXV0aGVudGljYXRpb
 25SZXF1ZXN0KSkNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJmaWRvX3UyZl9yZWdpc3RyYXRpb25fcmVxdWVzdCIsIFNlcnZlclV0aWwuYXNKc29uKHJlZ2lzdHJhdGlvblJlcXVlc3QpKQ0KDQog
 ICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09IDMpOg0KICAgICAgICAgICAgcHJpbnQgIlUyRi4gUHJlcGFyZSBmb3Igc3RlcCAyIg0KDQogICAgICAgICAgICByZXR
 1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidX
 Rlcywgc3RlcCk6DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgc
 mV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcmV0
 dXJuICIvYXV0aC91MmYvbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGV
 ycyk6DQogICAgICAgIHJldHVybiBUcnVlDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!92F0.BF9E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Super Gluu authentication module
displayName: super_gluu
gluuStatus: false
inum: %(inumOrg)s!0011!92F0.BF9E
oxConfigurationProperty: {"value1":"qr_options","value2":"{ size: 500, mSize: 0.
 05 }","description":""}
oxConfigurationProperty: {"value1":"label","value2":"Super Gluu","description":""}
oxConfigurationProperty: {"value1":"registration_uri","value2":"https://%(hostname)s/identity/register","description":""}
oxConfigurationProperty: {"value1":"authentication_mode","value2":"two_step","de
 scription":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/super_gluu_creds.json","description":""}
oxLevel: 15
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KaW1wb3J0IHN5cw0KaW1wb3J0IGRhdGV0aW1lDQppbXBvcnQgdXJsbGliDQoNCmZyb20g
 b3JnLnhkaS5tb2RlbC5jdXN0b20uc2NyaXB0LnR5cGUuYXV0aCBpbXBvcnQgUGVyc29uQXV0aGVudGljYXRpb25UeXBlDQpmcm9tIG9yZy5qYm9zcy5zZWFtLmNvbnRleHRzIGltcG9ydCBDb250ZXh
 0cw0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2
 VydmljZSwgU2Vzc2lvblN0YXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmZpZG8udTJmIGltcG9ydCBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlDQpmcm9tIG9yZy54ZGkud
 XRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnV0aWwgaW1wb3J0IFNlcnZlclV0aWwNCmZyb20gb3JnLnhkaS51dGlsLnNlY3VyaXR5IGltcG9ydCBTdHJpbmdFbmNy
 eXB0ZXINCmZyb20gb3JnLnhkaS5veGF1dGgubW9kZWwuY29uZmlnIGltcG9ydCBDb25maWd1cmF0aW9uRmFjdG9yeQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cw0KZnJvbSBvcmcueGRpLm9
 4YXV0aC5zZXJ2aWNlLm5ldCBpbXBvcnQgSHR0cFNlcnZpY2UNCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNvbm5lY3Rpb25QTmFtZXMNCmZyb20gY29tLm5vdG5vb3AuYX
 BucyBpbXBvcnQgQVBOUw0KZnJvbSBjb20uZ29vZ2xlLmFuZHJvaWQuZ2NtLnNlcnZlciBpbXBvcnQgU2VuZGVyLCBNZXNzYWdlDQoNCg0KdHJ5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcHQgSW1wb
 3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGUpOg0KICAgIGRlZiBfX2luaXRf
 XyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmlndXJhdGl
 vbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KC
 JhdXRoZW50aWNhdGlvbl9tb2RlIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5pdGlhbGl6YXRpb24uIFByb3BlcnR5IGF1dGhlbnRpY2F0aW9uX21vZGUgaXMgbWFuZGF0b3J5I
 g0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5yZWdpc3RyYXRpb25VcmkgPSBOb25lDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5
 KCJyZWdpc3RyYXRpb25fdXJpIik6DQogICAgICAgICAgICBzZWxmLnJlZ2lzdHJhdGlvblVyaSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgicmVnaXN0cmF0aW9uX3VyaSIpLmdldFZhbHV
 lMigpDQoNCiAgICAgICAgYXV0aGVudGljYXRpb25fbW9kZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiYXV0aGVudGljYXRpb25fbW9kZSIpLmdldFZhbHVlMigpDQogICAgICAgIGlmIF
 N0cmluZ0hlbHBlci5pc0VtcHR5KGF1dGhlbnRpY2F0aW9uX21vZGUpOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIGF1d
 GhlbnRpY2F0aW9uX21vZGUuIGF1dGhlbnRpY2F0aW9uX21vZGUgY29uZmlndXJhdGlvbiBwYXJhbWV0ZXIgaXMgZW1wdHkiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAg
 ICAgIHNlbGYub25lU3RlcCA9IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlbnRpY2F0aW9uX21vZGUsICJvbmVfc3RlcCIpDQogICAgICAgIHNlbGYudHdvU3RlcCA9IFN0cmluZ0h
 lbHBlci5lcXVhbHNJZ25vcmVDYXNlKGF1dGhlbnRpY2F0aW9uX21vZGUsICJ0d29fc3RlcCIpDQoNCiAgICAgICAgaWYgbm90IChzZWxmLm9uZVN0ZXAgb3Igc2VsZi50d29TdGVwKToNCiAgICAgIC
 AgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXphdGlvbi4gVmFsaWQgYXV0aGVudGljYXRpb25fbW9kZSB2YWx1ZXMgYXJlIG9uZV9zdGVwIGFuZCB0d29fc3RlcCINCiAgICAgICAgICAgI
 HJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5lbmFibGVkUHVzaE5vdGlmaWNhdGlvbnMgPSBzZWxmLmluaXRQdXNoTm90aWZpY2F0aW9uU2VydmljZShjb25maWd1cmF0aW9uQXR0
 cmlidXRlcykNCg0KICAgICAgICBzZWxmLmN1c3RvbUxhYmVsID0gTm9uZQ0KICAgICAgICBpZiBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgibGFiZWwiKToNCiAgICAgICAgICA
 gIHNlbGYuY3VzdG9tTGFiZWwgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImxhYmVsIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW9ucyA9IHt9DQogICAgIC
 AgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJxcl9vcHRpb25zIik6DQogICAgICAgICAgICBzZWxmLmN1c3RvbVFyT3B0aW9ucyA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1d
 GVzLmdldCgicXJfb3B0aW9ucyIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseS4gb25lU3RlcDogJyVzJywgdHdvU3RlcDog
 JyVzJywgcHVzaE5vdGlmaWNhdGlvbnM6ICclcycsIGN1c3RvbUxhYmVsOiAnJXMnIiAlIChzZWxmLm9uZVN0ZXAsIHNlbGYudHdvU3RlcCwgc2VsZi5lbmFibGVkUHVzaE5vdGlmaWNhdGlvbnMsIHN
 lbGYuY3VzdG9tTGFiZWwpDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlN1cG
 VyLUdsdXUuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb
 24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAg
 ICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZlQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICA
 gIHJldHVybiBOb25lDQoNCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNyZWRlbnRpYW
 xzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCg0KICAgICAgICBjb250ZXh0ID0gQ29ud
 GV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg0KICAgICAgICBjbGllbnRfcmVkaXJlY3Rf
 dXJpID0gc2VsZi5nZXRDbGllbnRSZWRpcmVjVXJpKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgaWYgY2xpZW50X3JlZGlyZWN0X3VyaSA9PSBOb25lOg0KICAgICAgICAgICAgcHJpbnQgIlN
 1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZS4gcmVkaXJlY3RfdXJpIGlzIG5vdCBzZXQiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzZWxmLnNldEV2ZW50Q29udGV4dFBhcmFtZX
 RlcnMoY29udGV4dCkNCg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZSA9IERldmljZVJlZ2lzdHJhd
 GlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBpZiBzdGVwID09IDE6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEiDQogICAgICAgICAg
 ICBpZiBzZWxmLm9uZVN0ZXA6DQogIA0KICAgICAgICAgICAgICAgIHNlc3Npb25fZGV2aWNlX3N0YXR1cyA9IHNlbGYuZ2V0U2Vzc2lvbkRldmljZVN0YXR1cyhzZXNzaW9uX2F0dHJpYnV0ZXMsIHV
 zZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXMgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuDQoNCiAgICAgICAgICAgICAgICB1MmZfZG
 V2aWNlX2lkID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydkZXZpY2VfaWQnXQ0KDQogICAgICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZhbGlkYXRlU2Vzc2lvbkRldmljZVN0Y
 XR1cyhjbGllbnRfcmVkaXJlY3RfdXJpLCBzZXNzaW9uX2RldmljZV9zdGF0dXMpDQogICAgICAgICAgICAgICAgaWYgdmFsaWRhdGlvbl9yZXN1bHQ6DQogICAgICAgICAgICAgICAgICAgIHByaW50
 ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVXNlciBzdWNjZXNzZnVsbHkgYXV0aGVudGljYXRlZCB3aXRoIHUyZl9kZXZpY2UgJyVzJyIgJSB1MmZfZGV2aWNlX2lkDQogICA
 gICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIG5vdCBzZXNzaW9uX2RldmljZV
 9zdGF0dXNbJ29uZV9zdGVwJ106DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gdTJmX2RldmljZSAnJXMnIGlzIG5vdCBvbmUgc
 3RlcCBkZXZpY2UiICUgdTJmX2RldmljZV9pZA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBUaGVyZSBhcmUg
 dHdvIHN0ZXBzIG9ubHkgaW4gZW5yb2xsbWVudCBtb2RlDQogICAgICAgICAgICAgICAgaWYgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydlbnJvbGwnXToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJ
 uIHZhbGlkYXRpb25fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic3VwZXJfZ2x1dV9jb3VudF9sb2dpbl9zdGVwcyIsIDEpDQoNCiAgICAgICAgICAgICAgICB1c2VyX2ludW
 0gPSBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ3VzZXJfaW51bSddDQoNCiAgICAgICAgICAgICAgICB1MmZfZGV2aWNlID0gZGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZS5maW5kVXNlckRldmljZVJlZ
 2lzdHJhdGlvbih1c2VyX2ludW0sIHUyZl9kZXZpY2VfaWQsICJveElkIikNCiAgICAgICAgICAgICAgICBpZiB1MmZfZGV2aWNlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJT
 dXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGxvYWQgdTJmX2RldmljZSAnJXMnIiAlIHUyZl9kZXZpY2VfaWQNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZ
 hbHNlDQoNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lKQ0KICAgICAgICAgICAgICAgIGlmIG5vdCBsb2dnZWRfaW46DQogICAgIC
 AgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB1c2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2VyICclcycgc3VjY2Vzc2Z1bGx5IGF1
 dGhlbnRpY2F0ZWQgd2l0aCB1MmZfZGV2aWNlICclcyciICUgKHVzZXJfbmFtZSwgdTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICA
 gICAgICAgICAgZWxpZiBzZWxmLnR3b1N0ZXA6DQogICAgICAgICAgICAgICAgYXV0aGVudGljYXRlZF91c2VyID0gc2VsZi5wcm9jZXNzQmFzaWNBdXRoZW50aWNhdGlvbihjcmVkZW50aWFscykNCi
 AgICAgICAgICAgICAgICBpZiBhdXRoZW50aWNhdGVkX3VzZXIgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgDQogICAgICAgICAgICAgICAgYXV0aF9tZXRob
 2QgPSAnYXV0aGVudGljYXRlJw0KICAgICAgICAgICAgICAgIGVucm9sbG1lbnRfbW9kZSA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFyYW1ldGVycywgImxvZ2luRm9ybTpyZWdp
 c3RlckJ1dHRvbiIpDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkoZW5yb2xsbWVudF9tb2RlKToNCiAgICAgICAgICAgICAgICAgICAgYXV0aF9tZXRob2QgPSAnZW5
 yb2xsJw0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kID09ICdhdXRoZW50aWNhdGUnOg0KICAgICAgICAgICAgICAgICAgICB1c2VyX2ludW0gPSB1c2VyU2
 VydmljZS5nZXRVc2VySW51bShhdXRoZW50aWNhdGVkX3VzZXIpDQogICAgICAgICAgICAgICAgICAgIHUyZl9kZXZpY2VzX2xpc3QgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRVc2VyR
 GV2aWNlUmVnaXN0cmF0aW9ucyh1c2VyX2ludW0sIGNsaWVudF9yZWRpcmVjdF91cmksICJveElkIikNCiAgICAgICAgICAgICAgICAgICAgaWYgdTJmX2RldmljZXNfbGlzdC5zaXplKCkgPT0gMDoN
 CiAgICAgICAgICAgICAgICAgICAgICAgIGF1dGhfbWV0aG9kID0gJ2Vucm9sbCcNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXA
 gMS4gVGhlcmUgaXMgbm8gVTJGICclcycgdXNlciBkZXZpY2VzIGFzc29jaWF0ZWQgd2l0aCBhcHBsaWNhdGlvbiAnJXMnLiBDaGFuZ2luZyBhdXRoX21ldGhvZCB0byAnJXMnIiAlICh1c2VyX25hbW
 UsIGNsaWVudF9yZWRpcmVjdF91cmksIGF1dGhfbWV0aG9kKQ0KICAgIA0KICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gYXV0aF9tZXRob
 2Q6ICclcyciICUgYXV0aF9tZXRob2QNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic3VwZXJfZ2x1dV9hdXRoX21ldGhvZCIsIGF1dGhfbWV0aG9kKQ0KDQog
 ICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsaWYgc3RlcCA9PSAyOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF
 1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg0KICAgICAgICAgICAgc2Vzc2lvbl
 9kZXZpY2Vfc3RhdHVzID0gc2VsZi5nZXRTZXNzaW9uRGV2aWNlU3RhdHVzKHNlc3Npb25fYXR0cmlidXRlcywgdXNlcl9uYW1lKQ0KICAgICAgICAgICAgaWYgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzI
 D09IE5vbmU6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHUyZl9kZXZpY2VfaWQgPSBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2RldmljZV9pZCddDQoNCiAgICAg
 ICAgICAgICMgVGhlcmUgYXJlIHR3byBzdGVwcyBvbmx5IGluIGVucm9sbG1lbnQgbW9kZQ0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwIGFuZCBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ2Vucm9
 sbCddOg0KICAgICAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlciA9IHNlbGYucHJvY2Vzc0Jhc2ljQXV0aGVudGljYXRpb24oY3JlZGVudGlhbHMpDQogICAgICAgICAgICAgICAgaWYgYXV0aG
 VudGljYXRlZF91c2VyID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0oY
 XV0aGVudGljYXRlZF91c2VyKQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIGF0dGFjaF9yZXN1bHQgPSBkZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmF0dGFjaFVzZXJEZXZpY2VS
 ZWdpc3RyYXRpb24odXNlcl9pbnVtLCB1MmZfZGV2aWNlX2lkKQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBSZXN1bHQgYWZ0ZXI
 gYXR0YWNoaW5nIHUyZl9kZXZpY2UgJyVzJyB0byB1c2VyICclcyc6ICclcyciICUgKHUyZl9kZXZpY2VfaWQsIHVzZXJfbmFtZSwgYXR0YWNoX3Jlc3VsdCkgDQoNCiAgICAgICAgICAgICAgICByZX
 R1cm4gYXR0YWNoX3Jlc3VsdA0KICAgICAgICAgICAgZWxpZiBzZWxmLnR3b1N0ZXA6DQogICAgICAgICAgICAgICAgaWYgdXNlcl9uYW1lID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHBya
 W50ICJTdXBlci1HbHV1LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSB1c2VyIG5hbWUiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAg
 ICAgICAgICAgICAgdmFsaWRhdGlvbl9yZXN1bHQgPSBzZWxmLnZhbGlkYXRlU2Vzc2lvbkRldmljZVN0YXR1cyhjbGllbnRfcmVkaXJlY3RfdXJpLCBzZXNzaW9uX2RldmljZV9zdGF0dXMsIHVzZXJ
 fbmFtZSkNCiAgICAgICAgICAgICAgICBpZiB2YWxpZGF0aW9uX3Jlc3VsdDoNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBVc2
 VyICclcycgc3VjY2Vzc2Z1bGx5IGF1dGhlbnRpY2F0ZWQgd2l0aCB1MmZfZGV2aWNlICclcyciICUgKHVzZXJfbmFtZSwgdTJmX2RldmljZV9pZCkNCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgI
 CAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3QgPSBqc29uLmxvYWRzKHNlc3Npb25fZGV2aWNlX3N0
 YXR1c1snc3VwZXJfZ2x1dV9yZXF1ZXN0J10pDQogICAgICAgICAgICAgICAgYXV0aF9tZXRob2QgPSBzdXBlcl9nbHV1X3JlcXVlc3RbJ21ldGhvZCddDQogICAgICAgICAgICAgICAgaWYgYXV0aF9
 tZXRob2QgaW4gWydlbnJvbGwnLCAnYXV0aGVudGljYXRlJ106DQogICAgICAgICAgICAgICAgICAgIHJldHVybiB2YWxpZGF0aW9uX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cG
 VyLUdsdXUuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBVMkYgYXV0aF9tZXRob2QgaXMgaW52YWxpZCINCg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQogICAgICAgI
 CAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250
 ZXh0ID0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgc2Vzc2lvbl9hdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCg0KICAgICAgICBjbGllbnR
 fcmVkaXJlY3RfdXJpID0gc2VsZi5nZXRDbGllbnRSZWRpcmVjVXJpKHNlc3Npb25fYXR0cmlidXRlcykNCiAgICAgICAgaWYgY2xpZW50X3JlZGlyZWN0X3VyaSA9PSBOb25lOg0KICAgICAgICAgIC
 AgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAuIHJlZGlyZWN0X3VyaSBpcyBub3Qgc2V0Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5zZXRFdmVud
 ENvbnRleHRQYXJhbWV0ZXJzKGNvbnRleHQpDQoNCiAgICAgICAgaWYgc3RlcCA9PSAxOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAgMSINCiAgICAgICAg
 ICAgIGlmIHNlbGYub25lU3RlcDoNCiAgICAgICAgICAgICAgICBzZXNzaW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF0ZUZyb21Db29raWUoKQ0
 KICAgICAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5KHNlc3Npb25fc3RhdGUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcC
 AyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHNlc3Npb25fc3RhdGUiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaXNzdWVyID0gQ
 29uZmlndXJhdGlvbkZhY3RvcnkuaW5zdGFuY2UoKS5nZXRDb25maWd1cmF0aW9uKCkuZ2V0SXNzdWVyKCkNCiAgICAgICAgICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSA9IHsn
 YXBwJzogY2xpZW50X3JlZGlyZWN0X3VyaSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2lzc3Vlcic6IGlzc3VlciwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA
 gICAgJ3N0YXRlJzogc2Vzc2lvbl9zdGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2NyZWF0ZWQnOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKX0NCg
 0KICAgICAgICAgICAgICAgIHNlbGYuYWRkR2VvbG9jYXRpb25EYXRhKHNlc3Npb25fYXR0cmlidXRlcywgc3VwZXJfZ2x1dV9yZXF1ZXN0X2RpY3Rpb25hcnkpDQoNCiAgICAgICAgICAgICAgICBzd
 XBlcl9nbHV1X3JlcXVlc3QgPSBqc29uLmR1bXBzKHN1cGVyX2dsdXVfcmVxdWVzdF9kaWN0aW9uYXJ5LCBzZXBhcmF0b3JzPSgnLCcsJzonKSkNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXIt
 R2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAxLiBQcmVwYXJlZCBzdXBlcl9nbHV1X3JlcXVlc3Q6Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0DQogICAgDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInN
 1cGVyX2dsdXVfcmVxdWVzdCIsIHN1cGVyX2dsdXVfcmVxdWVzdCkNCiMgICAgICAgICAgICBlbGlmIHNlbGYudHdvU3RlcDoNCiMgICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImRpc3BsYXlfcm
 VnaXN0ZXJfYWN0aW9uIiwgVHJ1ZSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZ
 SBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwOg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1
 dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICB1c2VyID0gYXV0aGVudGljYXRpb25TZXJ2aWNlLmdldEF1dGhlbnRpY2F0ZWRVc2VyKCkNCiAgICAgICAgICAgIGlmIHV
 zZXIgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gZGV0ZXJtaW5lIHVzZXIgbmFtZSINCiAgICAgICAgICAgIC
 AgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzdXBlcl9nbHV1X3JlcXVlc3QiKToNCiAgICAgICAgICAgICAgICBwcmludCAiU
 3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBSZXF1ZXN0IHdhcyBnZW5lcmF0ZWQgYWxyZWFkeSINCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICAgICAgDQogICAgICAg
 ICAgICBzZXNzaW9uX3N0YXRlID0gU2Vzc2lvblN0YXRlU2VydmljZS5pbnN0YW5jZSgpLmdldFNlc3Npb25TdGF0ZUZyb21Db29raWUoKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1
 wdHkoc2Vzc2lvbl9zdGF0ZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFByZXBhcmUgZm9yIHN0ZXAgMi4gRmFpbGVkIHRvIGRldGVybWluZSBzZXNzaW9uX3N0YXRlIg0KIC
 AgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBhdXRoX21ldGhvZCA9IHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInN1cGVyX2dsdXVfYXV0aF9tZXRob2QiKQ0KICAgICAgI
 CAgICAgaWYgU3RyaW5nSGVscGVyLmlzRW1wdHkoYXV0aF9tZXRob2QpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRl
 cm1pbmUgYXV0aF9tZXRob2QiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwYXJlIGZvciBzdGVwIDIuIGF1dGhfbWV0aG9
 kOiAnJXMnIiAlIGF1dGhfbWV0aG9kDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlzc3VlciA9IENvbmZpZ3VyYXRpb25GYWN0b3J5Lmluc3RhbmNlKCkuZ2V0Q29uZmlndXJhdGlvbigpLmdldE
 lzc3VlcigpDQogICAgICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSA9IHsndXNlcm5hbWUnOiB1c2VyLmdldFVzZXJJZCgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgI
 CAgICdhcHAnOiBjbGllbnRfcmVkaXJlY3RfdXJpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdpc3N1ZXInOiBpc3N1ZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
 J21ldGhvZCc6IGF1dGhfbWV0aG9kLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdzdGF0ZSc6IHNlc3Npb25fc3RhdGUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2N
 yZWF0ZWQnOiBkYXRldGltZS5kYXRldGltZS5ub3coKS5pc29mb3JtYXQoKX0NCg0KICAgICAgICAgICAgc2VsZi5hZGRHZW9sb2NhdGlvbkRhdGEoc2Vzc2lvbl9hdHRyaWJ1dGVzLCBzdXBlcl9nbH
 V1X3JlcXVlc3RfZGljdGlvbmFyeSkNCg0KICAgICAgICAgICAgc3VwZXJfZ2x1dV9yZXF1ZXN0ID0ganNvbi5kdW1wcyhzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSwgc2VwYXJhdG9ycz0oJ
 ywnLCc6JykpDQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBQcmVwYXJlZCBzdXBlcl9nbHV1X3JlcXVlc3Q6Iiwgc3VwZXJfZ2x1dV9yZXF1ZXN0DQoN
 CiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X3JlcXVlc3QiLCBzdXBlcl9nbHV1X3JlcXVlc3QpDQoNCiAgICAgICAgICAgIGlmIGF1dGhfbWV0aG9kIGluIFsnYXV0aGVudGljYXR
 lJ106DQogICAgICAgICAgICAgICAgc2VsZi5zZW5kUHVzaE5vdGlmaWNhdGlvbihjbGllbnRfcmVkaXJlY3RfdXJpLCB1c2VyLCBzdXBlcl9nbHV1X3JlcXVlc3QpDQoNCiAgICAgICAgICAgIHJldH
 VybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1d
 GVzLCBzdGVwKToNCiAgICAgICAgaWYgc3RlcCA9PSAxOg0KICAgICAgICAgICAgaWYgc2VsZi5vbmVTdGVwOiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuIEFycmF5cy5hc0xpc3QoInN1
 cGVyX2dsdXVfcmVxdWVzdCIpDQogICAgICAgICAgICBlbGlmIHNlbGYudHdvU3RlcDoNCiAgICAgICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgiZGlzcGxheV9yZWdpc3Rlcl9hY3Rpb24
 iKQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCiAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJzdXBlcl9nbHV1X2F1dGhfbWV0aG9kIiwgInN1cGVyX2dsdXVfcmVxdWVzdCIpDQogIC
 AgICAgIA0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIGNvbnRle
 HQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBpZiBjb250ZXh0LmlzU2V0KCJzdXBlcl9nbHV1X2NvdW50X2xvZ2luX3N0ZXBzIik6DQogICAgICAgICAgICByZXR1cm4gY29u
 dGV4dC5nZXQoInN1cGVyX2dsdXVfY291bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25
 maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIHN0ZXAgPT0gMToNCiAgICAgICAgICAgIGlmIHNlbGYub25lU3RlcDogICAgICAgIA0KICAgICAgICAgICAgICAgIHJldHVybi
 AiL2F1dGgvc3VwZXItZ2x1dS9sb2dpbi54aHRtbCINCiAgICAgICAgZWxpZiBzdGVwID09IDI6DQogICAgICAgICAgICBpZiBzZWxmLm9uZVN0ZXA6DQogICAgICAgICAgICAgICAgcmV0dXJuICIvb
 G9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2F1dGgvc3VwZXItZ2x1dS9sb2dpbi54aHRtbCINCg0KICAgICAgICByZXR1cm4gIiINCg0KICAg
 IGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBwcm9jZXNzQmFzaWNBdXRoZW5
 0aWNhdGlvbihzZWxmLCBjcmVkZW50aWFscyk6DQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldF
 VzZXJuYW1lKCkNCiAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICBpZiBTdHJpbmdIZWxwZ
 XIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX25hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyX3Bhc3N3b3JkKToNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2
 aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgaWYgbm90IGxvZ2dlZF9pbjoNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgZmluZF9
 1c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmdldFVzZXIodXNlcl9uYW1lKQ0KICAgICAgICBpZiBmaW5kX3VzZXJfYnlfdWlkID09IE5vbmU6DQogICAgICAgICAgICBwcmludCAib3hQdXNoLiBQcm
 9jZXNzIGJhc2ljIGF1dGhlbnRpY2F0aW9uLiBGYWlsZWQgdG8gZmluZCB1c2VyICclcyciICUgdXNlcl9uYW1lDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmV0d
 XJuIGZpbmRfdXNlcl9ieV91aWQNCg0KICAgIGRlZiB2YWxpZGF0ZVNlc3Npb25EZXZpY2VTdGF0dXMoc2VsZiwgY2xpZW50X3JlZGlyZWN0X3VyaSwgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzLCB1c2Vy
 X25hbWUgPSBOb25lKToNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgPSBEZXZpY2VSZWdpc3RyYXR
 pb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWydkZXZpY2VfaWQnXQ0KDQogICAgICAgIHUyZl9kZXZpY2UgPSBOb25lDQ
 ogICAgICAgIGlmIHNlc3Npb25fZGV2aWNlX3N0YXR1c1snZW5yb2xsJ10gYW5kIHNlc3Npb25fZGV2aWNlX3N0YXR1c1snb25lX3N0ZXAnXToNCiAgICAgICAgICAgIHUyZl9kZXZpY2UgPSBkZXZpY
 2VSZWdpc3RyYXRpb25TZXJ2aWNlLmZpbmRPbmVTdGVwVXNlckRldmljZVJlZ2lzdHJhdGlvbih1MmZfZGV2aWNlX2lkKQ0KICAgICAgICAgICAgaWYgdTJmX2RldmljZSA9PSBOb25lOg0KICAgICAg
 ICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBWYWxpZGF0ZSBzZXNzaW9uIGRldmljZSBzdGF0dXMuIFRoZXJlIGlzIG5vIG9uZSBzdGVwIHUyZl9kZXZpY2UgJyVzJyIgJSB1MmZfZGV2aWNlX2l
 kDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICAjIFZhbGlkYXRlIGlmIHVzZXIgaGFzIHNwZWNpZmllZCBkZXZpY2VfaWQgZW5yb2xsbWVudA
 0KICAgICAgICAgICAgdXNlcl9pbnVtID0gdXNlclNlcnZpY2UuZ2V0VXNlckludW0odXNlcl9uYW1lKQ0KDQogICAgICAgICAgICBpZiBzZXNzaW9uX2RldmljZV9zdGF0dXNbJ29uZV9zdGVwJ106D
 QogICAgICAgICAgICAgICAgdXNlcl9pbnVtID0gc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzWyd1c2VyX2ludW0nXQ0KICAgIA0KICAgICAgICAgICAgdTJmX2RldmljZSA9IGRldmljZVJlZ2lzdHJhdGlv
 blNlcnZpY2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb24odXNlcl9pbnVtLCB1MmZfZGV2aWNlX2lkKQ0KICAgICAgICAgICAgaWYgdTJmX2RldmljZSA9PSBOb25lOg0KICAgICAgICAgICAgICA
 gIHByaW50ICJTdXBlci1HbHV1LiBWYWxpZGF0ZSBzZXNzaW9uIGRldmljZSBzdGF0dXMuIFRoZXJlIGlzIG5vIHUyZl9kZXZpY2UgJyVzJyBhc3NvY2lhdGVkIHdpdGggdXNlciAnJXMnIiAlICh1Mm
 ZfZGV2aWNlX2lkLCB1c2VyX2ludW0pDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgaWYgbm90IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKGNsaWVudF9yZWRpc
 mVjdF91cmksIHUyZl9kZXZpY2UuYXBwbGljYXRpb24pOg0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFZhbGlkYXRlIHNlc3Npb24gZGV2aWNlIHN0YXR1cy4gdTJmX2RldmljZSAnJXMn
 IGFzc29jaWF0ZWQgd2l0aCBvdGhlciBhcHBsaWNhdGlvbiAnJXMnIiAlICh1MmZfZGV2aWNlX2lkLCB1MmZfZGV2aWNlLmFwcGxpY2F0aW9uKQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICA
 gICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldFNlc3Npb25EZXZpY2VTdGF0dXMoc2VsZiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLCB1c2VyX25hbWUpOg0KICAgICAgICBwcmludC
 AiU3VwZXItR2x1dS4gR2V0IHNlc3Npb24gZGV2aWNlIHN0YXR1cyINCg0KICAgICAgICBpZiBub3Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzdXBlcl9nbHV1X3JlcXVlc3QiKToNC
 iAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyBTdXBlci1HbHV1IHJlcXVlc3QgaW4gc2Vzc2lvbiBhdHRyaWJ1dGVzIg0K
 ICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIENoZWNrIHNlc3Npb24gc3RhdGUgZXh0ZW5kZWQNCiAgICAgICAgaWYgbm90IHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSg
 ic2Vzc2lvbl9jdXN0b21fc3RhdGUiKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyBzZXNzaW9uX2N1c3RvbV9zdG
 F0ZSBpbiBzZXNzaW9uIGF0dHJpYnV0ZXMiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIHNlc3Npb25fY3VzdG9tX3N0YXRlID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgic2Vzc
 2lvbl9jdXN0b21fc3RhdGUiKQ0KICAgICAgICBpZiBub3QgU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoImFwcHJvdmVkIiwgc2Vzc2lvbl9jdXN0b21fc3RhdGUpOg0KICAgICAgICAgICAg
 cHJpbnQgIlN1cGVyLUdsdXUuIEdldCBzZXNzaW9uIGRldmljZSBzdGF0dXMuIFVzZXIgJyVzJyBub3QgYXBwcm92ZSBvciBub3QgcGFzcyBVMkYgYXV0aGVudGljYXRpb24uIHNlc3Npb25fY3VzdG9
 tX3N0YXRlOiAnJXMnIiAlICh1c2VyX25hbWUsIHNlc3Npb25fY3VzdG9tX3N0YXRlKQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAjIFRyeSB0byBmaW5kIGRldmljZV9pZCBpbi
 BzZXNzaW9uIGF0dHJpYnV0ZQ0KICAgICAgICBpZiBub3Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJveHB1c2gyX3UyZl9kZXZpY2VfaWQiKToNCiAgICAgICAgICAgIHByaW50ICJTd
 XBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyB1MmZfZGV2aWNlIGFzc29jaWF0ZWQgd2l0aCB0aGlzIHJlcXVlc3QiDQogICAgICAgICAgICByZXR1cm4gTm9u
 ZQ0KDQogICAgICAgICMgVHJ5IHRvIGZpbmQgdXNlcl9pbnVtIGluIHNlc3Npb24gYXR0cmlidXRlDQogICAgICAgIGlmIG5vdCBzZXNzaW9uX2F0dHJpYnV0ZXMuY29udGFpbnNLZXkoIm94cHVzaDJ
 fdTJmX2RldmljZV91c2VyX2ludW0iKToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBHZXQgc2Vzc2lvbiBkZXZpY2Ugc3RhdHVzLiBUaGVyZSBpcyBubyB1c2VyX2ludW0gYXNzb2NpYX
 RlZCB3aXRoIHRoaXMgcmVxdWVzdCINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBlbnJvbGwgPSBGYWxzZQ0KICAgICAgICBpZiBzZXNzaW9uX2F0dHJpYnV0ZXMuY
 29udGFpbnNLZXkoIm94cHVzaDJfdTJmX2RldmljZV9lbnJvbGwiKToNCiAgICAgICAgICAgIGVucm9sbCA9IFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKCJ0cnVlIiwgc2Vzc2lvbl9hdHRy
 aWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX2Vucm9sbCIpKQ0KDQogICAgICAgIG9uZV9zdGVwID0gRmFsc2UNCiAgICAgICAgaWYgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJ
 veHB1c2gyX3UyZl9kZXZpY2Vfb25lX3N0ZXAiKToNCiAgICAgICAgICAgIG9uZV9zdGVwID0gU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UoInRydWUiLCBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2
 V0KCJveHB1c2gyX3UyZl9kZXZpY2Vfb25lX3N0ZXAiKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIA0KICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3QgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0K
 CJzdXBlcl9nbHV1X3JlcXVlc3QiKQ0KICAgICAgICB1MmZfZGV2aWNlX2lkID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX2lkIikNCiAgICAgICAgdXNlcl9pbnVt
 ID0gc2Vzc2lvbl9hdHRyaWJ1dGVzLmdldCgib3hwdXNoMl91MmZfZGV2aWNlX3VzZXJfaW51bSIpDQoNCiAgICAgICAgc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzID0geyJzdXBlcl9nbHV1X3JlcXVlc3Q
 iOiBzdXBlcl9nbHV1X3JlcXVlc3QsICJkZXZpY2VfaWQiOiB1MmZfZGV2aWNlX2lkLCAidXNlcl9pbnVtIiA6IHVzZXJfaW51bSwgImVucm9sbCIgOiBlbnJvbGwsICJvbmVfc3RlcCIgOiBvbmVfc3
 RlcH0NCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIEdldCBzZXNzaW9uIGRldmljZSBzdGF0dXMuIHNlc3Npb25fZGV2aWNlX3N0YXR1czogJyVzJyIgJSAoc2Vzc2lvbl9kZXZpY2Vfc3RhdHVzK
 Q0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNlc3Npb25fZGV2aWNlX3N0YXR1cw0KDQogICAgZGVmIGluaXRQdXNoTm90aWZpY2F0aW9uU2VydmljZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmli
 dXRlcyk6DQogICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXplIG5vdGlmaWNhdGlvbiBzZXJ2aWNlcyINCiAgICAgICAgaWYgbm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnR
 haW5zS2V5KCJjcmVkZW50aWFsc19maWxlIik6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBzdXBlcl9nbHV1X2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy
 5nZXQoImNyZWRlbnRpYWxzX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgICMgTG9hZCBjcmVkZW50aWFscyBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oc3VwZXJfZ2x1dV9jcmVkc19ma
 WxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNyZWRzID0ganNvbi5sb2FkcyhmLnJlYWQoKSkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUu
 IEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBGYWlsZWQgdG8gbG9hZCBjcmVkZW50aWFscyBmcm9tIGZpbGU6Iiwgc3VwZXJfZ2x1dV9jcmVkc19maWxlDQogICAgICAgICAgICByZXR
 1cm4gRmFsc2UNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgYW5kcm9pZF9jcmVkcyA9IGNyZWRzWyJhbm
 Ryb2lkIl1bImdjbSJdDQogICAgICAgICAgICBpb3NfY3JlYWRzID0gY3JlZHNbImlvcyJdWyJhcG5zIl0NCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIElua
 XRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBJbnZhbGlkIGNyZWRlbnRpYWxzIGZpbGUgJyVzJyBmb3JtYXQ6IiAlIHN1cGVyX2dsdXVfY3JlZHNfZmlsZQ0KICAgICAgICAgICAgcmV0dXJu
 IEZhbHNlDQogICAgICAgIA0KICAgICAgICBzZWxmLnB1c2hBbmRyb2lkU2VydmljZSA9IE5vbmUNCiAgICAgICAgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID0gTm9uZQ0KICAgICAgICBpZiBhbmRyb2l
 kX2NyZWRzWyJlbmFibGVkIl06DQogICAgICAgICAgICBzZWxmLnB1c2hBbmRyb2lkU2VydmljZSA9IFNlbmRlcihhbmRyb2lkX2NyZWRzWyJhcGlfa2V5Il0pIA0KICAgICAgICAgICAgcHJpbnQgIl
 N1cGVyLUdsdXUuIEluaXRpYWxpemUgbm90aWZpY2F0aW9uIHNlcnZpY2VzLiBDcmVhdGVkIEFuZHJvaWQgbm90aWZpY2F0aW9uIHNlcnZpY2UiDQogICAgICAgICAgICANCiAgICAgICAgaWYgaW9zX
 2NyZWFkc1siZW5hYmxlZCJdOg0KICAgICAgICAgICAgcDEyX2ZpbGVfcGF0aCA9IGlvc19jcmVhZHNbInAxMl9maWxlX3BhdGgiXQ0KICAgICAgICAgICAgcDEyX3Bhc3Nvd3JkID0gaW9zX2NyZWFk
 c1sicDEyX3Bhc3N3b3JkIl0NCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHN0cmluZ0VuY3J5cHRlciA9IFN0cmluZ0VuY3J5cHRlci5kZWZhdWx0SW5zdGFuY2UoKQ0KICAgICA
 gICAgICAgICAgIHAxMl9wYXNzb3dyZCA9IHN0cmluZ0VuY3J5cHRlci5kZWNyeXB0KHAxMl9wYXNzb3dyZCkNCiAgICAgICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgICAgICAjIElnbm9yZSBleG
 NlcHRpb24uIFBhc3N3b3JkIGlzIG5vdCBlbmNyeXB0ZWQNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gSW5pdGlhbGl6ZSBub3RpZmljYXRpb24gc2VydmljZXMuIEFzc3VtaW5nI
 HRoYXQgJ3AxMl9wYXNzb3dyZCcgcGFzc3dvcmQgaW4gbm90IGVuY3J5cHRlZCINCg0KICAgICAgICAgICAgYXBuc1NlcnZpY2VCdWlsZGVyID0gIEFQTlMubmV3U2VydmljZSgpLndpdGhDZXJ0KHAx
 Ml9maWxlX3BhdGgsIHAxMl9wYXNzb3dyZCkNCiAgICAgICAgICAgIGlmIGlvc19jcmVhZHNbInByb2R1Y3Rpb24iXToNCiAgICAgICAgICAgICAgICBzZWxmLnB1c2hBcHBsZVNlcnZpY2UgPSBhcG5
 zU2VydmljZUJ1aWxkZXIud2l0aFByb2R1Y3Rpb25EZXN0aW5hdGlvbigpLmJ1aWxkKCkNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5wdXNoQXBwbGVTZXJ2aWNlID0gYX
 Buc1NlcnZpY2VCdWlsZGVyLndpdGhTYW5kYm94RGVzdGluYXRpb24oKS5idWlsZCgpDQoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBJbml0aWFsaXplIG5vdGlmaWNhdGlvbiBzZXJ2a
 WNlcy4gQ3JlYXRlZCBpT1Mgbm90aWZpY2F0aW9uIHNlcnZpY2UiDQoNCiAgICAgICAgZW5hYmxlZCA9IHNlbGYucHVzaEFuZHJvaWRTZXJ2aWNlICE9IE5vbmUgb3Igc2VsZi5wdXNoQXBwbGVTZXJ2
 aWNlICE9IE5vbmUNCg0KICAgICAgICByZXR1cm4gZW5hYmxlZA0KDQogICAgZGVmIHNlbmRQdXNoTm90aWZpY2F0aW9uKHNlbGYsIGNsaWVudF9yZWRpcmVjdF91cmksIHVzZXIsIHN1cGVyX2dsdXV
 fcmVxdWVzdCk6DQogICAgICAgIGlmIG5vdCBzZWxmLmVuYWJsZWRQdXNoTm90aWZpY2F0aW9uczoNCiAgICAgICAgICAgIHJldHVybg0KDQogICAgICAgIHVzZXJfbmFtZSA9IHVzZXIuZ2V0VXNlck
 lkKCkNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3RpZmljYXRpb24uIExvYWRpbmcgdXNlciAnJXMnIGRldmljZXMiICUgdXNlcl9uYW1lDQoNCiAgICAgICAgc2VuZF9ub
 3RpZmljYXRpb24gPSBGYWxzZQ0KICAgICAgICBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQgPSBUcnVlDQoNCiAgICAgICAgdXNlclNlcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAg
 ICAgIGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgPSBEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB1c2VyX2ludW0gPSB1c2VyU2VydmljZS5nZXRVc2VySW5
 1bSh1c2VyX25hbWUpDQoNCiAgICAgICAgdTJmX2RldmljZXNfbGlzdCA9IGRldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UuZmluZFVzZXJEZXZpY2VSZWdpc3RyYXRpb25zKHVzZXJfaW51bSwgY2xpZW
 50X3JlZGlyZWN0X3VyaSwgIm94SWQiLCAib3hEZXZpY2VEYXRhIikNCiAgICAgICAgaWYgdTJmX2RldmljZXNfbGlzdC5zaXplKCkgPiAwOg0KICAgICAgICAgICAgZm9yIHUyZl9kZXZpY2UgaW4gd
 TJmX2RldmljZXNfbGlzdDoNCiAgICAgICAgICAgICAgICBkZXZpY2VfZGF0YSA9IHUyZl9kZXZpY2UuZ2V0RGV2aWNlRGF0YSgpDQoNCiAgICAgICAgICAgICAgICAjIERldmljZSBkYXRhIHdoaWNo
 IFN1cGVyLUdsdXUgZ2V0cyBkdXJpbmcgZW5yb2xsbWVudA0KICAgICAgICAgICAgICAgIGlmIGRldmljZV9kYXRhID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlDQoNCiAgICA
 gICAgICAgICAgICBwbGF0Zm9ybSA9IGRldmljZV9kYXRhLmdldFBsYXRmb3JtKCkNCiAgICAgICAgICAgICAgICBwdXNoX3Rva2VuID0gZGV2aWNlX2RhdGEuZ2V0UHVzaFRva2VuKCkNCiAgICAgIC
 AgICAgICAgICBkZWJ1ZyA9IEZhbHNlDQoNCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShwbGF0Zm9ybSwgImlvcyIpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb
 3RFbXB0eShwdXNoX3Rva2VuKToNCiAgICAgICAgICAgICAgICAgICAgIyBTZW5kaW5nIG5vdGlmaWNhdGlvbiB0byBpT1MgdXNlcidzIGRldmljZQ0KICAgICAgICAgICAgICAgICAgICBpZiBzZWxm
 LnB1c2hBcHBsZVNlcnZpY2UgPT0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBTZW5kIHB1c2ggbm90aWZpY2F0aW9uLiBBcHBsZSBwdXNoIG5vdGlmaWN
 hdGlvbiBzZXJ2aWNlIGlzIG5vdCBlbmFibGVkIg0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb24gPSBUcnVlDQogICAgIC
 AgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIlN1cGVyLUdsdXUiDQogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlID0gIlN1cGVyLUdsdXUgb
 G9naW4gcmVxdWVzdCB0bzogJXMiICUgY2xpZW50X3JlZGlyZWN0X3VyaQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBhZGRpdGlvbmFsX2ZpZWxkcyA9IHsgInJlcXVlc3QiIDogc3VwZXJfZ2x1
 dV9yZXF1ZXN0IH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgbXNnQnVpbGRlciA9IEFQTlMubmV3UGF5bG9hZCgpLmFsZXJ0Qm9keShtZXNzYWdlKS5hbGVydFRpdGxlKHRpdGxlKS5zb3VuZCg
 iZGVmYXVsdCIpDQogICAgICAgICAgICAgICAgICAgICAgICBtc2dCdWlsZGVyLmNhdGVnb3J5KCdBQ1RJT05BQkxFJykuYmFkZ2UoMCkNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0J1aWxkZX
 IuZm9yTmV3c3N0YW5kKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIG1zZ0J1aWxkZXIuY3VzdG9tRmllbGRzKGFkZGl0aW9uYWxfZmllbGRzKQ0KICAgICAgICAgICAgICAgICAgICAgICAgcHVza
 F9tZXNzYWdlID0gbXNnQnVpbGRlci5idWlsZCgpDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbmRfbm90aWZpY2F0aW9uX3Jlc3VsdCA9IHNlbGYucHVzaEFwcGxlU2VydmljZS5wdXNoKHB1
 c2hfdG9rZW4sIHB1c2hfbWVzc2FnZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBTZW5kIGl
 PUyBwdXNoIG5vdGlmaWNhdGlvbi4gdG9rZW46ICclcycsIG1lc3NhZ2U6ICclcycsIHNlbmRfbm90aWZpY2F0aW9uX3Jlc3VsdDogJyVzJyIgJSAocHVzaF90b2tlbiwgcHVzaF9tZXNzYWdlLCBzZW
 5kX25vdGlmaWNhdGlvbl9yZXN1bHQpDQoNCiAgICAgICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShwbGF0Zm9ybSwgImFuZHJvaWQiKSBhbmQgU3RyaW5nSGVscGVyL
 mlzTm90RW1wdHkocHVzaF90b2tlbik6DQogICAgICAgICAgICAgICAgICAgICMgU2VuZGluZyBub3RpZmljYXRpb24gdG8gQW5kcm9pZCB1c2VyJ3MgZGV2aWNlDQogICAgICAgICAgICAgICAgICAg
 IGlmIHNlbGYucHVzaEFuZHJvaWRTZXJ2aWNlID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gU2VuZCBwdXNoIG5vdGlmaWNhdGlvbi4gQW5kcm9pZCB
 wdXNoIG5vdGlmaWNhdGlvbiBzZXJ2aWNlIGlzIG5vdCBlbmFibGVkIg0KICAgICAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICAgICAgc2VuZF9ub3RpZmljYXRpb24gPS
 BUcnVlDQoNCiAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlID0gIlN1cGVyLUdsdXUiDQogICAgICAgICAgICAgICAgICAgICAgICBtc2dCdWlsZGVyID0gTWVzc2FnZS5CdWlsZGVyKCkuYWRkR
 GF0YSgibWVzc2FnZSIsIHN1cGVyX2dsdXVfcmVxdWVzdCkuYWRkRGF0YSgidGl0bGUiLCB0aXRsZSkuY29sbGFwc2VLZXkoInNpbmdsZSIpLmNvbnRlbnRBdmFpbGFibGUoVHJ1ZSkNCiAgICAgICAg
 ICAgICAgICAgICAgICAgIHB1c2hfbWVzc2FnZSA9IG1zZ0J1aWxkZXIuYnVpbGQoKQ0KDQogICAgICAgICAgICAgICAgICAgICAgICBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQgPSBzZWxmLnB1c2h
 BbmRyb2lkU2VydmljZS5zZW5kKHB1c2hfbWVzc2FnZSwgcHVzaF90b2tlbiwgMykNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGRlYnVnOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIH
 ByaW50ICJTdXBlci1HbHV1LiBTZW5kIEFuZHJvaWQgcHVzaCBub3RpZmljYXRpb24uIHRva2VuOiAnJXMnLCBtZXNzYWdlOiAnJXMnLCBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQ6ICclcyciICUgK
 HB1c2hfdG9rZW4sIHB1c2hfbWVzc2FnZSwgc2VuZF9ub3RpZmljYXRpb25fcmVzdWx0KQ0KDQoNCiAgICAgICAgcHJpbnQgIlN1cGVyLUdsdXUuIFNlbmQgcHVzaCBub3RpZmljYXRpb24uIHNlbmRf
 bm90aWZpY2F0aW9uOiAnJXMnLCBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQ6ICclcyciICUgKHNlbmRfbm90aWZpY2F0aW9uLCBzZW5kX25vdGlmaWNhdGlvbl9yZXN1bHQpDQoNCiAgICBkZWYgZ2V
 0Q2xpZW50UmVkaXJlY1VyaShzZWxmLCBzZXNzaW9uX2F0dHJpYnV0ZXMpOg0KICAgICAgICBpZiBub3Qgc2Vzc2lvbl9hdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJyZWRpcmVjdF91cmkiKToNCiAgIC
 AgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuIHNlc3Npb25fYXR0cmlidXRlcy5nZXQoInJlZGlyZWN0X3VyaSIpDQoNCiAgICBkZWYgc2V0RXZlbnRDb250ZXh0UGFyYW1ldGVyc
 yhzZWxmLCBjb250ZXh0KToNCiAgICAgICAgaWYgc2VsZi5yZWdpc3RyYXRpb25VcmkgIT0gTm9uZToNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9yZWdpc3RyYXRpb25fdXJpIiwg
 c2VsZi5yZWdpc3RyYXRpb25VcmkpDQoNCiAgICAgICAgaWYgc2VsZi5jdXN0b21MYWJlbCAhPSBOb25lOg0KICAgICAgICAgICAgY29udGV4dC5zZXQoInN1cGVyX2dsdXVfbGFiZWwiLCBzZWxmLmN
 1c3RvbUxhYmVsKQ0KDQogICAgICAgIGNvbnRleHQuc2V0KCJzdXBlcl9nbHV1X3FyX29wdGlvbnMiLCBzZWxmLmN1c3RvbVFyT3B0aW9ucykNCg0KICAgIGRlZiBhZGRHZW9sb2NhdGlvbkRhdGEoc2
 VsZiwgc2Vzc2lvbl9hdHRyaWJ1dGVzLCBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeSk6DQogICAgICAgIGlmIHNlc3Npb25fYXR0cmlidXRlcy5jb250YWluc0tleSgicmVtb3RlX2lwIik6D
 QogICAgICAgICAgICByZW1vdGVfaXAgPSBzZXNzaW9uX2F0dHJpYnV0ZXMuZ2V0KCJyZW1vdGVfaXAiKQ0KICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmlzTm90RW1wdHkocmVtb3RlX2lwKToN
 CiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gUHJlcGFyZSBmb3Igc3RlcCAyLiBBZGRpbmcgcmVxX2lwIGFuZCByZXFfbG9jIHRvIHN1cGVyX2dsdXVfcmVxdWVzdCINCiAgICAgICA
 gICAgICAgICBzdXBlcl9nbHV1X3JlcXVlc3RfZGljdGlvbmFyeVsncmVxX2lwJ10gPSByZW1vdGVfaXANCg0KICAgICAgICAgICAgICAgIHJlbW90ZV9sb2NfZGljID0gc2VsZi5kZXRlcm1pbmVHZW
 9sb2NhdGlvbkRhdGEocmVtb3RlX2lwKQ0KICAgICAgICAgICAgICAgIGlmIHJlbW90ZV9sb2NfZGljID09IE5vbmU6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBQcmVwY
 XJlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBkZXRlcm1pbmUgcmVtb3RlIGxvY2F0aW9uIGJ5IHJlbW90ZSBJUCAnJXMnIiAlIHJlbW90ZV9pcA0KICAgICAgICAgICAgICAgICAgICByZXR1cm4NCg0K
 ICAgICAgICAgICAgICAgIHJlbW90ZV9sb2MgPSAiJXMsICVzLCAlcyIgJSAoIHJlbW90ZV9sb2NfZGljWydjb3VudHJ5J10sIHJlbW90ZV9sb2NfZGljWydyZWdpb25OYW1lJ10sIHJlbW90ZV9sb2N
 fZGljWydjaXR5J10gKQ0KICAgICAgICAgICAgICAgIHJlbW90ZV9sb2NfZW5jb2RlZCA9IHVybGxpYi5xdW90ZShyZW1vdGVfbG9jKQ0KICAgICAgICAgICAgICAgIHN1cGVyX2dsdXVfcmVxdWVzdF
 9kaWN0aW9uYXJ5WydyZXFfbG9jJ10gPSByZW1vdGVfbG9jX2VuY29kZWQNCg0KICAgIGRlZiBkZXRlcm1pbmVHZW9sb2NhdGlvbkRhdGEoc2VsZiwgcmVtb3RlX2lwKToNCiAgICAgICAgcHJpbnQgI
 lN1cGVyLUdsdXUuIERldGVybWluZSByZW1vdGUgbG9jYXRpb24uIHJlbW90ZV9pcDogJyVzJyIgJSByZW1vdGVfaXANCiAgICAgICAgaHR0cFNlcnZpY2UgPSBIdHRwU2VydmljZS5pbnN0YW5jZSgp
 DQoNCiAgICAgICAgaHR0cF9jbGllbnQgPSBodHRwU2VydmljZS5nZXRIdHRwc0NsaWVudCgpDQogICAgICAgIGh0dHBfY2xpZW50X3BhcmFtcyA9IGh0dHBfY2xpZW50LmdldFBhcmFtcygpDQogICA
 gICAgIGh0dHBfY2xpZW50X3BhcmFtcy5zZXRJbnRQYXJhbWV0ZXIoQ29yZUNvbm5lY3Rpb25QTmFtZXMuQ09OTkVDVElPTl9USU1FT1VULCAxNSAqIDEwMDApDQogICAgICAgIA0KICAgICAgICBnZW
 9sb2NhdGlvbl9zZXJ2aWNlX3VybCA9ICJodHRwOi8vaXAtYXBpLmNvbS9qc29uLyVzP2ZpZWxkcz00OTE3NyIgJSByZW1vdGVfaXANCiAgICAgICAgZ2VvbG9jYXRpb25fc2VydmljZV9oZWFkZXJzI
 D0geyAiQWNjZXB0IiA6ICJhcHBsaWNhdGlvbi9qc29uIiB9DQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZUdldCho
 dHRwX2NsaWVudCwgZ2VvbG9jYXRpb25fc2VydmljZV91cmwsICBnZW9sb2NhdGlvbl9zZXJ2aWNlX2hlYWRlcnMpDQogICAgICAgICAgICBodHRwX3Jlc3BvbnNlID0gaHR0cF9zZXJ2aWNlX3Jlc3B
 vbnNlLmdldEh0dHBSZXNwb25zZSgpDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXRlcm1pbmUgcmVtb3RlIGxvY2F0aW9uLiBFeGNlcHRpb246ICIsIH
 N5cy5leGNfaW5mbygpWzFdDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGlmIG5vdCBodHRwU2VydmljZS5pc1Jlc3BvbnNlU3Rhc3R1c0NvZGVPa
 yhodHRwX3Jlc3BvbnNlKToNCiAgICAgICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gRGV0ZXJtaW5lIHJlbW90ZSBsb2NhdGlvbi4gR2V0IGludmFsaWQgcmVzcG9uc2UgZnJvbSB2YWxpZGF0
 aW9uIHNlcnZlcjogIiwgc3RyKGh0dHBfcmVzcG9uc2UuZ2V0U3RhdHVzTGluZSgpLmdldFN0YXR1c0NvZGUoKSkNCiAgICAgICAgICAgICAgICBodHRwU2VydmljZS5jb25zdW1lKGh0dHBfcmVzcG9
 uc2UpDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICANCiAgICAgICAgICAgIHJlc3BvbnNlX2J5dGVzID0gaHR0cFNlcnZpY2UuZ2V0UmVzcG9uc2VDb250ZW50KGh0dHBfcmVzcG9uc2
 UpDQogICAgICAgICAgICByZXNwb25zZV9zdHJpbmcgPSBodHRwU2VydmljZS5jb252ZXJ0RW50aXR5VG9TdHJpbmcocmVzcG9uc2VfYnl0ZXMpDQogICAgICAgICAgICBodHRwU2VydmljZS5jb25zd
 W1lKGh0dHBfcmVzcG9uc2UpDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICBpZiByZXNwb25zZV9z
 dHJpbmcgPT0gTm9uZToNCiAgICAgICAgICAgIHByaW50ICJTdXBlci1HbHV1LiBEZXRlcm1pbmUgcmVtb3RlIGxvY2F0aW9uLiBHZXQgZW1wdHkgcmVzcG9uc2UgZnJvbSBsb2NhdGlvbiBzZXJ2ZXI
 iDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgcmVzcG9uc2UgPSBqc29uLmxvYWRzKHJlc3BvbnNlX3N0cmluZykNCiAgICAgICAgDQogICAgICAgIGlmIG5vdCBTdH
 JpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZXNwb25zZVsnc3RhdHVzJ10sICJzdWNjZXNzIik6DQogICAgICAgICAgICBwcmludCAiU3VwZXItR2x1dS4gRGV0ZXJtaW5lIHJlbW90ZSBsb2Nhd
 Glvbi4gR2V0IHJlc3BvbnNlIHdpdGggc3RhdHVzOiAnJXMnIiAlIHJlc3BvbnNlWydzdGF0dXMnXQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICByZXR1cm4gcmVzcG9uc2UNCg==
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!5018.F9CF,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: DUO authentication module
displayName: duo
gluuStatus: false
inum: %(inumOrg)s!0011!5018.F9CF
oxConfigurationProperty: {"value1":"duo_creds_file","value2":"/etc/certs/duo
 _creds.json","description":""}
oxConfigurationProperty: {"value1":"duo_host","value2":"api-random.duosecuri
 ty.com","description":""}
oxLevel: 20
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4
 dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnR
 pY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZSwgVXNlckdyb3VwU2VydmljZSwgQXV0aGVudGljYXRpb25TZXJ2aWNlDQpmcm9tIG9yZy54ZG
 kuc2VydmljZSBpbXBvcnQgTWFpbFNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KDQppbXBvc
 nQgamF2YQ0KaW1wb3J0IGR1b193ZWINCnRyeToNCiAgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24NCg0KY2xhc3MgUGVyc29u
 QXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWl
 sbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl6YXRpb24iDQoNCi
 AgICAgICAgZHVvX2NyZWRzX2ZpbGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19jcmVkc19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgIyBMb2FkIGNyZWRlbnRpYWxzIGZyb
 20gZmlsZQ0KICAgICAgICBmID0gb3BlbihkdW9fY3JlZHNfZmlsZSwgJ3InKQ0KICAgICAgICB0cnk6DQogICAgICAgICAgICBjcmVkcyA9IGpzb24ubG9hZHMoZi5yZWFkKCkpDQogICAgICAgIGV4
 Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBGYWlsZWQgdG8gbG9hZCBjcmVkcyBmcm9tIGZpbGU6IiwgZHVvX2NyZWRzX2ZpbGUNCiAgICAgICAgICAgIHJldHV
 ybiBGYWxzZQ0KICAgICAgICBmaW5hbGx5Og0KICAgICAgICAgICAgZi5jbG9zZSgpDQoNCiAgICAgICAgc2VsZi5pa2V5ID0gc3RyKGNyZWRzWyJpa2V5Il0pDQogICAgICAgIHNlbGYuc2tleSA9IH
 N0cihjcmVkc1sic2tleSJdKQ0KICAgICAgICBzZWxmLmFrZXkgPSBzdHIoY3JlZHNbImFrZXkiXSkNCg0KICAgICAgICBzZWxmLnVzZV9kdW9fZ3JvdXAgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZ
 mlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImR1b19ncm91cCIpKToNCiAgICAgICAgICAgIHNlbGYuZHVvX2dyb3VwID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJkdW9fZ3Jv
 dXAiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2VsZi51c2VfZHVvX2dyb3VwID0gVHJ1ZQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gSW5pdGlhbGl6YXRpb24uIFVzaW5nIER1byBvbmx5IGl
 mIHVzZXIgYmVsb25nIHRvIGdyb3VwOiIsIHNlbGYuZHVvX2dyb3VwDQoNCiAgICAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYn
 V0ZXMuY29udGFpbnNLZXkoImF1ZGl0X2dyb3VwIikpOg0KICAgICAgICAgICAgc2VsZi5hdWRpdF9ncm91cCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3JvdXAiKS5nZXRWY
 Wx1ZTIoKQ0KDQogICAgICAgICAgICBpZiAobm90IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJhdWRpdF9ncm91cF9lbWFpbCIpKToNCiAgICAgICAgICAgICAgICBwcmludCAi
 RHVvLiBJbml0aWFsaXphdGlvbi4gUHJvcGVydHkgYXVkaXRfZ3JvdXBfZW1haWwgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2V
 sZi5hdWRpdF9lbWFpbCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiYXVkaXRfZ3JvdXBfZW1haWwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgc2VsZi51c2VfYXVkaXRfZ3JvdXAgPS
 BUcnVlDQoNCiAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBVc2luZyBhdWRpdG8gZ3JvdXA6Iiwgc2VsZi5hdWRpdF9ncm91cA0KICAgICAgICAgICAgDQogICAgICAgIGlmI
 ChzZWxmLnVzZV9kdW9fZ3JvdXAgb3Igc2VsZi51c2VfYXVkaXRfZ3JvdXApOg0KICAgICAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiYXVkaXRfYXR0
 cmlidXRlIikpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBhdWRpdF9hdHRyaWJ1dGUgaXMgbm90IHNwZWNpZmllZCINCiAgICAgICAgICAgICA
 gICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgc2VsZi5hdWRpdF9hdHRyaWJ1dGUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImF1ZGl0X2F0dH
 JpYnV0ZSIpLmdldFZhbHVlMigpDQoNCg0KICAgICAgICBwcmludCAiRHVvLiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJve
 ShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJEdW8uIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAg
 ICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXN
 hZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZV
 R5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc
 3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgZHVvX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImR1b19ob3N0IikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICBjcmVkZW50aWFs
 cyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk
 6DQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgdXNlcl9wYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCiAgIC
 AgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTd
 HJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2
 aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICA
 gICAgICAgICAgYXV0aGVudGljYXRpb25TZXJ2aWNlID0gQXV0aGVudGljYXRpb25TZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgIHVzZXIgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuZ2V0QX
 V0aGVudGljYXRlZFVzZXIoKQ0KICAgICAgICAgICAgaWYgKHNlbGYudXNlX2R1b19ncm91cCk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkR1by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIENoZ
 WNraW5nIGlmIHVzZXIgYmVsb25nIHRvIER1byBncm91cCINCiAgICAgICAgICAgICAgICBpc19tZW1iZXJfZHVvX2dyb3VwID0gc2VsZi5pc1VzZXJNZW1iZXJPZkdyb3VwKHVzZXIsIHNlbGYuYXVk
 aXRfYXR0cmlidXRlLCBzZWxmLmR1b19ncm91cCkNCiAgICAgICAgICAgICAgICBpZiAoaXNfbWVtYmVyX2R1b19ncm91cCk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnR
 pY2F0ZSBmb3Igc3RlcCAxLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1lbWJlciBvZiBEdW8gZ3JvdXAiDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpbl9zdGVwcy
 A9IDINCiAgICAgICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpdEdyb3VwKHVzZXIpDQogICAgICAgICAgICAgICAgICAgIGR1b19jb3VudF9sb2dpb
 l9zdGVwcyA9IDENCg0KICAgICAgICAgICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJkdW9fY291bnRfbG9naW5f
 c3RlcHMiLCBkdW9fY291bnRfbG9naW5fc3RlcHMpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXR
 oZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgc2lnX3Jlc3BvbnNlX2FycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJzaWdfcmVzcG9uc2UiKQ0KICAgICAgICAgICAgaWYgQX
 JyYXlIZWxwZXIuaXNFbXB0eShzaWdfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgICAgICAgICAgIHByaW50ICJEdW8uIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBzaWdfcmVzcG9uc2UgaXMgZW1wd
 HkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGR1b19zaWdfcmVzcG9uc2UgPSBzaWdfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgICAgcHJpbnQgIkR1
 by4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGR1b19zaWdfcmVzcG9uc2U6ICIgKyBkdW9fc2lnX3Jlc3BvbnNlDQoNCiAgICAgICAgICAgIGF1dGhlbnRpY2F0ZWRfdXNlcm5hbWUgPSBkdW9fd2V
 iLnZlcmlmeV9yZXNwb25zZShzZWxmLmlrZXksIHNlbGYuc2tleSwgc2VsZi5ha2V5LCBkdW9fc2lnX3Jlc3BvbnNlKQ0KDQogICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNhdGUgZm9yIH
 N0ZXAgMi4gYXV0aGVudGljYXRlZF91c2VybmFtZTogIiArIGF1dGhlbnRpY2F0ZWRfdXNlcm5hbWUgKyAiLCBleHBlY3RlZCB1c2VyX25hbWU6ICIgKyB1c2VyX25hbWUNCg0KICAgICAgICAgICAga
 WYgKG5vdCBTdHJpbmdIZWxwZXIuZXF1YWxzKHVzZXJfbmFtZSwgYXV0aGVudGljYXRlZF91c2VybmFtZSkpOg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBhdXRo
 ZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgdXNlciA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5nZXRBdXRoZW50aWNhdGVkVXN
 lcigpDQogICAgICAgICAgICBzZWxmLnByb2Nlc3NBdWRpdEdyb3VwKHVzZXIpDQoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2
 UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHMuZ
 2V0RXZlbnRDb250ZXh0KCkNCg0KICAgICAgICBkdW9faG9zdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZHVvX2hvc3QiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIGNyZWRlbnRpYWxz
 ID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCg0KICAgICAgICBpZiAoc3RlcCA9PSAxKTo
 NCiAgICAgICAgICAgIHByaW50ICJEdW8uIFByZXBhcmUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIH
 ByaW50ICJEdW8uIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgZHVvX3NpZ19yZXF1ZXN0ID0gZHVvX3dlYi5zaWduX3JlcXVlc3Qoc2VsZi5pa2V5LCBzZWxmLnNrZXksIHNlbGYuY
 WtleSwgdXNlcl9uYW1lKQ0KICAgICAgICAgICAgcHJpbnQgIkR1by4gUHJlcGFyZSBmb3Igc3RlcCAyLiBkdW9fc2lnX3JlcXVlc3Q6ICIgKyBkdW9fc2lnX3JlcXVlc3QNCiAgICAgICAgICAgIA0K
 ICAgICAgICAgICAgY29udGV4dC5zZXQoImR1b19ob3N0IiwgZHVvX2hvc3QpDQogICAgICAgICAgICBjb250ZXh0LnNldCgiZHVvX3NpZ19yZXF1ZXN0IiwgZHVvX3NpZ19yZXF1ZXN0KQ0KDQogICA
 gICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgZ2V0RXh0cmFQYXJhbWV0ZXJzRm9yU3RlcChzZWxmLCBjb25maWd1cm
 F0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzK
 ToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGlmIChjb250ZXh0LmlzU2V0KCJkdW9fY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAg
 ICByZXR1cm4gY29udGV4dC5nZXQoImR1b19jb3VudF9sb2dpbl9zdGVwcyIpDQoNCiAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR
 0cmlidXRlcywgc3RlcCk6DQogICAgICAgIGlmIChzdGVwID09IDIpOg0KICAgICAgICAgICAgcmV0dXJuICIvYXV0aC9kdW8vZHVvbG9naW4ueGh0bWwiDQogICAgICAgIHJldHVybiAiIg0KDQogIC
 AgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGlzVXNlck1lbWJlck9mR3Jvd
 XAoc2VsZiwgdXNlciwgYXR0cmlidXRlLCBncm91cCk6DQogICAgICAgIGlzX21lbWJlciA9IEZhbHNlDQogICAgICAgIG1lbWJlcl9vZl9saXN0ID0gdXNlci5nZXRBdHRyaWJ1dGVWYWx1ZXMoYXR0
 cmlidXRlKQ0KICAgICAgICBpZiAobWVtYmVyX29mX2xpc3QgIT0gTm9uZSk6DQogICAgICAgICAgICBmb3IgbWVtYmVyX29mIGluIG1lbWJlcl9vZl9saXN0Og0KICAgICAgICAgICAgICAgIGlmICh
 TdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShncm91cCwgbWVtYmVyX29mKSk6DQogICAgICAgICAgICAgICAgICAgIGlzX21lbWJlciA9IFRydWUNCiAgICAgICAgICAgICAgICAgICAgYnJlYW
 sNCg0KICAgICAgICByZXR1cm4gaXNfbWVtYmVyDQoNCiAgICBkZWYgcHJvY2Vzc0F1ZGl0R3JvdXAoc2VsZiwgdXNlcik6DQogICAgICAgIGlmIChzZWxmLnVzZV9hdWRpdF9ncm91cCk6DQogICAgI
 CAgICAgICBpc19tZW1iZXIgPSBzZWxmLmlzVXNlck1lbWJlck9mR3JvdXAodXNlciwgc2VsZi5hdWRpdF9hdHRyaWJ1dGUsIHNlbGYuYXVkaXRfZ3JvdXApDQogICAgICAgICAgICBpZiAoaXNfbWVt
 YmVyKToNCiAgICAgICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHByb2Nlc3NBdWRpdEdyb3VwLiBVc2VyICciICsgdXNlci5nZXRVc2VySWQoKSArICInIG1lbWJlciBvZiB
 hdWRpdCBncm91cCINCiAgICAgICAgICAgICAgICBwcmludCAiRHVvLiBBdXRoZW50aWNhdGUgZm9yIHByb2Nlc3NBdWRpdEdyb3VwLiBTZW5kaW5nIGUtbWFpbCBhYm91dCB1c2VyICciICsgdXNlci
 5nZXRVc2VySWQoKSArICInIGxvZ2luIHRvIiwgc2VsZi5hdWRpdF9lbWFpbA0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgICMgU2VuZCBlLW1haWwgdG8gYWRtaW5pc3RyYXRvcg0KI
 CAgICAgICAgICAgICAgIHVzZXJfaWQgPSB1c2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgbWFpbFNlcnZpY2UgPSBNYWlsU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAg
 c3ViamVjdCA9ICJVc2VyIGxvZyBpbjogIiArIHVzZXJfaWQNCiAgICAgICAgICAgICAgICBib2R5ID0gIlVzZXIgbG9nIGluOiAiICsgdXNlcl9pZA0KICAgICAgICAgICAgICAgIG1haWxTZXJ2aWN
 lLnNlbmRNYWlsKHNlbGYuYXVkaXRfZW1haWwsIHN1YmplY3QsIGJvZHkpDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!2124.0CF1,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Cert authentication module
displayName: cert
gluuStatus: false
inum: %(inumOrg)s!2124.0CF1
oxConfigurationProperty: {"value1":"chain_cert_file_path","value2":"/etc/certs/c
 hain_cert.pem","description":""}
oxConfigurationProperty: {"value1":"credentials_file","value2":"/etc/certs/cert_
 creds.json","description":""}
oxConfigurationProperty: {"value1":"map_user_cert","value2":"true","description"
 :""}
oxConfigurationProperty: {"value1":"use_generic_validator","value2":"true","desc
 ription":""}
oxConfigurationProperty: {"value1":"use_path_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_ocsp_validator","value2":"true","descrip
 tion":""}
oxConfigurationProperty: {"value1":"use_crl_validator","value2":"false","descript
 ion":""}
oxConfigurationProperty: {"value1":"crl_max_response_size","value2":"10485760","
 description":""}
oxLevel: 25
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""
 }
oxRevision: 1
oxScript:: Iw0KIyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRle
 HQuDQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KaW1wb3J0IHN5cw0KaW1wb3J0IGJhc2U2NA0KaW1wb3J0IHVybGxpYg0KDQpmcm9t
 IG9yZy54ZGkubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV
 4dHMNCmZyb20gamF2YXguZmFjZXMuY29udGV4dCBpbXBvcnQgRmFjZXNDb250ZXh0DQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZGVudGl0eQ0KZnJvbSBvcmcueGRpLm94YX
 V0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlcg0KZnJvbSBvcmcueGRpLm94YXV0aC51dGlsIGltcG9ydCBTZXJ2ZXJVdGlsD
 Qpmcm9tIG9yZy54ZGkudXRpbC5zZWN1cml0eSBpbXBvcnQgU3RyaW5nRW5jcnlwdGVyDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzDQpmcm9tIG9yZy54ZGkub3hhdXRoLmNlcnQuZmluZ2Vy
 cHJpbnQgaW1wb3J0IEZpbmdlcnByaW50SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLmNlcnQudmFsaWRhdGlvbiBpbXBvcnQgR2VuZXJpY0NlcnRpZmljYXRlVmVyaWZpZXIsIFBhdGhDZXJ0aWZ
 pY2F0ZVZlcmlmaWVyLCBPQ1NQQ2VydGlmaWNhdGVWZXJpZmllciwgQ1JMQ2VydGlmaWNhdGVWZXJpZmllcg0KZnJvbSBvcmcueGRpLm94YXV0aC5jZXJ0LnZhbGlkYXRpb24ubW9kZWwgaW1wb3J0IF
 ZhbGlkYXRpb25TdGF0dXMNCmZyb20gb3JnLnhkaS5veGF1dGgudXRpbCBpbXBvcnQgQ2VydFV0aWwNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZS5uZXQgaW1wb3J0IEh0dHBTZXJ2aWNlDQpmc
 m9tIG9yZy5hcGFjaGUuaHR0cC5wYXJhbXMgaW1wb3J0IENvcmVDb25uZWN0aW9uUE5hbWVzDQppbXBvcnQgamF2YQ0KDQoNCnRyeToNCiAgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG9ydEVycm9y
 Og0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiw
 gY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaW
 J1dGVzKToNCiAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIGlmIG5vdCAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNoYWluX2NlcnRfZ
 mlsZV9wYXRoIikpOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBjaGFpbl9jZXJ0X2ZpbGVfcGF0aCBpcyBtYW5kYXRvcnkiDQogICAgICAgICAgICBy
 ZXR1cm4gRmFsc2UNCg0KICAgICAgICBpZiBub3QgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJtYXBfdXNlcl9jZXJ0IikpOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEl
 uaXRpYWxpemF0aW9uLiBQcm9wZXJ0eSBtYXBfdXNlcl9jZXJ0IGlzIG1hbmRhdG9yeSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIGNoYWluX2NlcnRfZmlsZV9wYXRoID0gY2
 9uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjaGFpbl9jZXJ0X2ZpbGVfcGF0aCIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgc2VsZi5jaGFpbl9jZXJ0cyA9IENlcnRVdGlsLmxvYWRYNTA5Q2Vyd
 GlmaWNhdGVGcm9tRmlsZShjaGFpbl9jZXJ0X2ZpbGVfcGF0aCkNCiAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemF0aW9uLiBMb2FkZWQgJyVkJyBjaGFpbiBjZXJ0aWZpY2F0ZXMiICUgc2Vs
 Zi5jaGFpbl9jZXJ0cy5zaXplKCkNCiAgICAgICAgDQogICAgICAgIGNybF9tYXhfcmVzcG9uc2Vfc2l6ZSA9IDUgKiAxMDI0ICogMTAyNCAgIyAxME1iDQogICAgICAgIGlmIGNvbmZpZ3VyYXRpb25
 BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjcmxfbWF4X3Jlc3BvbnNlX3NpemUiKToNCiAgICAgICAgICAgIGNybF9tYXhfcmVzcG9uc2Vfc2l6ZSA9IFN0cmluZ0hlbHBlci50b0ludGVnZXIoY29uZm
 lndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjcmxfbWF4X3Jlc3BvbnNlX3NpemUiKS5nZXRWYWx1ZTIoKSwgY3JsX21heF9yZXNwb25zZV9zaXplKQ0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIElua
 XRpYWxpemF0aW9uLiBDUkwgbWF4IHJlc3BvbnNlIHNpemUgaXMgJyVkJyIgJSBjcmxfbWF4X3Jlc3BvbnNlX3NpemUNCg0KICAgICAgICAjIERlZmluZSBhcnJheSB0byBvcmRlciBtZXRob2RzIGNv
 cnJlY3RseQ0KICAgICAgICBzZWxmLnZhbGlkYXRvcl90eXBlcyA9IFsgJ2dlbmVyaWMnLCAncGF0aCcsICdvY3NwJywgJ2NybCddDQogICAgICAgIHNlbGYudmFsaWRhdG9ycyA9IHsgJ2dlbmVyaWM
 nIDogW0dlbmVyaWNDZXJ0aWZpY2F0ZVZlcmlmaWVyKCksIEZhbHNlXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAncGF0aCcgOiBbUGF0aENlcnRpZmljYXRlVmVyaWZpZXIoRmFsc2UpLC
 BGYWxzZV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ29jc3AnIDogW09DU1BDZXJ0aWZpY2F0ZVZlcmlmaWVyKCksIEZhbHNlXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnY
 3JsJyA6IFtDUkxDZXJ0aWZpY2F0ZVZlcmlmaWVyKGNybF9tYXhfcmVzcG9uc2Vfc2l6ZSksIEZhbHNlXSB9DQoNCiAgICAgICAgZm9yIHR5cGUgaW4gc2VsZi52YWxpZGF0b3JfdHlwZXM6DQogICAg
 ICAgICAgICB2YWxpZGF0b3JfcGFyYW1fbmFtZSA9ICJ1c2VfJXNfdmFsaWRhdG9yIiAlIHR5cGUNCiAgICAgICAgICAgIGlmIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KHZhbGl
 kYXRvcl9wYXJhbV9uYW1lKToNCiAgICAgICAgICAgICAgICB2YWxpZGF0b3Jfc3RhdHVzID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQodmFsaWRhdG
 9yX3BhcmFtX25hbWUpLmdldFZhbHVlMigpLCBGYWxzZSkNCiAgICAgICAgICAgICAgICBzZWxmLnZhbGlkYXRvcnNbdHlwZV1bMV0gPSB2YWxpZGF0b3Jfc3RhdHVzDQoNCiAgICAgICAgICAgIHBya
 W50ICJDZXJ0LiBJbml0aWFsaXphdGlvbi4gVmFsaWRhdGlvbiBtZXRob2QgJyVzJyBzdGF0dXM6ICclcyciICUgKHR5cGUsIHNlbGYudmFsaWRhdG9yc1t0eXBlXVsxXSkNCg0KICAgICAgICBzZWxm
 Lm1hcF91c2VyX2NlcnQgPSBTdHJpbmdIZWxwZXIudG9Cb29sZWFuKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgibWFwX3VzZXJfY2VydCIpLmdldFZhbHVlMigpLCBGYWxzZSkNCiAgICAgICA
 gcHJpbnQgIkNlcnQuIEluaXRpYWxpemF0aW9uLiBtYXBfdXNlcl9jZXJ0OiAnJXMnIiAlIHNlbGYubWFwX3VzZXJfY2VydA0KDQogICAgICAgIHNlbGYuZW5hYmxlZF9yZWNhcHRjaGEgPSBzZWxmLm
 luaXRSZWNhcHRjaGEoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpDQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXphdGlvbi4gZW5hYmxlZF9yZWNhcHRjaGE6ICclcyciICUgc2VsZi5lbmFib
 GVkX3JlY2FwdGNoYQ0KDQogICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYs
 IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNlcnQuIERlc3Ryb3kiDQoNCiAgICAgICAgZm9yIHR5cGUgaW4gc2VsZi52YWxpZGF0b3JfdHlwZXM6DQogICAgICAgICA
 gICBzZWxmLnZhbGlkYXRvcnNbdHlwZV1bMF0uZGVzdHJveSgpDQoNCiAgICAgICAgcHJpbnQgIkNlcnQuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KIC
 AgIGRlZiBnZXRBcGlWZXJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgZGVmIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb
 25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgZGVmIGF1dGhlbnRpY2F0ZShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0
 KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQoNCiAgIC
 AgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIGlmIHN0ZXAgPT0gMToNC
 iAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCiAgICAgICAgICAgIGxvZ2luX2J1dHRvbiA9IFNlcnZlclV0aWwuZ2V0Rmlyc3RWYWx1ZShyZXF1ZXN0UGFy
 YW1ldGVycywgImxvZ2luRm9ybTpsb2dpbkJ1dHRvbiIpDQogICAgICAgICAgICBpZiBTdHJpbmdIZWxwZXIuaXNFbXB0eShsb2dpbl9idXR0b24pOg0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ
 0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRm9ybSB3ZXJlIHN1Ym1pdHRlZCBpbmNvcnJlY3RseSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGlmIHNlbGYuZW
 5hYmxlZF9yZWNhcHRjaGE6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBWYWxpZGF0aW5nIHJlY2FwdGNoYSByZXNwb25zZSINCiAgICAgICAgI
 CAgICAgICByZWNhcHRjaGFfcmVzcG9uc2UgPSBTZXJ2ZXJVdGlsLmdldEZpcnN0VmFsdWUocmVxdWVzdFBhcmFtZXRlcnMsICJnLXJlY2FwdGNoYS1yZXNwb25zZSIpDQoNCiAgICAgICAgICAgICAg
 ICByZWNhcHRjaGFfcmVzdWx0ID0gc2VsZi52YWxpZGF0ZVJlY2FwdGNoYShyZWNhcHRjaGFfcmVzcG9uc2UpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3R
 lcCAxLiByZWNhcHRjaGFfcmVzdWx0OiAnJXMnIiAlIHJlY2FwdGNoYV9yZXN1bHQNCiAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICByZXR1cm4gcmVjYXB0Y2hhX3Jlc3VsdA0KDQogIC
 AgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIHN0ZXAgPT0gMjoNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgI
 yBWYWxpZGF0ZSBpZiB1c2VyIHNlbGVjdGVkIGNlcnRpZmljYXRlDQogICAgICAgICAgICBjZXJ0X3g1MDkgPSBzZWxmLmdldFNlc3Npb25BdHRyaWJ1dGUoImNlcnRfeDUwOSIpDQogICAgICAgICAg
 ICBpZiBjZXJ0X3g1MDkgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFVzZXIgbm90IHNlbGVjdGVkIGFueSBjZXJ0cyINCiAgICA
 gICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF9zZWxlY3RlZCIsIEZhbHNlKQ0KICAgICAgICAgICAgICAgICAgICANCiAgICAgICAgICAgICAgICAjIFJldHVybiBUcnVlIHRvIGluZm9ybSB1c2
 VyIGhvdyB0byByZXNldCB3b3JrZmxvdw0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X3NlbGVjd
 GVkIiwgVHJ1ZSkNCiAgICAgICAgICAgICAgICB4NTA5Q2VydGlmaWNhdGUgPSBzZWxmLmNlcnRGcm9tU3RyaW5nKGNlcnRfeDUwOSkNCg0KICAgICAgICAgICAgc3ViamVjdFg1MDBQcmluY2lwYWwg
 PSB4NTA5Q2VydGlmaWNhdGUuZ2V0U3ViamVjdFg1MDBQcmluY2lwYWwoKQ0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBVc2VyIHNlbGVjdGVkIGNlcnR
 pZmljYXRlIHdpdGggRE4gJyVzJyIgJSBzdWJqZWN0WDUwMFByaW5jaXBhbA0KICAgICAgICAgICAgDQogICAgICAgICAgICAjIFZhbGlkYXRlIGNlcnRpZmljYXRlcyB3aGljaCB1c2VyIHNlbGVjdG
 VkDQogICAgICAgICAgICB2YWxpZCA9IHNlbGYudmFsaWRhdGVDZXJ0aWZpY2F0ZSh4NTA5Q2VydGlmaWNhdGUpDQogICAgICAgICAgICBpZiBub3QgdmFsaWQ6DQogICAgICAgICAgICAgICAgcHJpb
 nQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBDZXJ0aWZpY2F0ZSBETiAnJXMnIGlzIG5vdCB2YWxpZCIgJSBzdWJqZWN0WDUwMFByaW5jaXBhbA0KICAgICAgICAgICAgICAgIGNvbnRl
 eHQuc2V0KCJjZXJ0X3ZhbGlkIiwgRmFsc2UpDQogICAgICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgIyBSZXR1cm4gVHJ1ZSB0byBpbmZvcm0gdXNlciBob3cgdG8gcmVzZXQgd29ya2Zsb3c
 NCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF92YWxpZCIsIFRydWUpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQ2FsY3VsYX
 RlIGNlcnRpZmljYXRlIGZpbmdlcnByaW50DQogICAgICAgICAgICB4NTA5Q2VydGlmaWNhdGVGaW5nZXJwcmludCA9IHNlbGYuY2FsY3VsYXRlQ2VydGlmaWNhdGVGaW5nZXJwcmludCh4NTA5Q2Vyd
 GlmaWNhdGUpDQogICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF94NTA5X2ZpbmdlcnByaW50IiwgeDUwOUNlcnRpZmljYXRlRmluZ2VycHJpbnQpDQogICAgICAgICAgICBwcmludCAiQ2VydC4g
 QXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZpbmdlcnByaW50IGlzICclcycgb2YgY2VydGlmaWNhdGUgd2l0aCBETiAnJXMnIiAlICh4NTA5Q2VydGlmaWNhdGVGaW5nZXJwcmludCwgc3ViamVjdFg
 1MDBQcmluY2lwYWwpDQogICAgICAgICAgICANCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBmaW5kIHVzZXIgYnkgY2VydGlmaWNhdGUgZmluZ2VycHJpbnQNCiAgICAgICAgICAgIGNlcnRfdXNlcl
 9leHRlcm5hbF91aWQgPSAiY2VydDogJXMiICUgeDUwOUNlcnRpZmljYXRlRmluZ2VycHJpbnQNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gQXR0ZW1wd
 GluZyB0byBmaW5kIHVzZXIgYnkgb3hFeHRlcm5hbFVpZCBhdHRyaWJ1dGUgdmFsdWUgJXMiICUgY2VydF91c2VyX2V4dGVybmFsX3VpZA0KDQogICAgICAgICAgICBmaW5kX3VzZXJfYnlfZXh0ZXJu
 YWxfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgY2VydF91c2VyX2V4dGVybmFsX3VpZCkNCiAgICAgICAgICAgIGlmIGZpbmRfdXNlcl9ieV9leHR
 lcm5hbF91aWQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgDQ
 ogICAgICAgICAgICAgICAgaWYgc2VsZi5tYXBfdXNlcl9jZXJ0Og0KICAgICAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIFN0b3JpbmcgY2VydF91c
 2VyX2V4dGVybmFsX3VpZCBmb3Igc3RlcCAzIg0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiY2VydF91c2VyX2V4dGVybmFsX3VpZCIsIGNlcnRfdXNlcl9leHRlcm5hbF91aWQpDQog
 ICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiB
 NYXBwaW5nIGNldCB0byB1c2VyIGFjY291bnQgaXMgbm90IGFsbG93ZWQiDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjZXJ0X2NvdW50X2xvZ2luX3N0ZXBzIiwgMikNCiAgICAgIC
 AgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGZvdW5kVXNlck5hbWUgPSBmaW5kX3VzZXJfYnlfZXh0ZXJuYWxfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICBwcmlud
 CAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGZvdW5kVXNlck5hbWU6ICIgKyBmb3VuZFVzZXJOYW1lDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICB1
 c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICANCiA
 gICAgICAgICAgIHByaW50ICJDZXJ0LiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfY291bnRfbG
 9naW5fc3RlcHMiLCAyKQ0KDQogICAgICAgICAgICByZXR1cm4gbG9nZ2VkX2luDQogICAgICAgIGVsaWYgc3RlcCA9PSAzOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb
 3Igc3RlcCAzIg0KDQogICAgICAgICAgICBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkID0gc2VsZi5nZXRTZXNzaW9uQXR0cmlidXRlKCJjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkIikNCiAgICAgICAgICAg
 IGlmIGNlcnRfdXNlcl9leHRlcm5hbF91aWQgPT0gTm9uZToNCiAgICAgICAgICAgICAgICBwcmludCAiQ2VydC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDMuIGNlcnRfdXNlcl9leHRlcm5hbF91aWQ
 gaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgIC
 AgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICAgICAgICAgI
 CBsb2dnZWRfaW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVz
 ZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICBsb2dnZWRfaW4gPSB1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlcl9uYW1lLCB1c2VyX3Bhc3N3b3JkKQ0KDQogICAgICAgICAgICBpZiA
 obm90IGxvZ2dlZF9pbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICMgRG91YmxlIGNoZWNrIGp1c3QgdG8gbWFrZSBzdXJlLiBXZSBkaWQgY2hlY2tpbmcgaW
 4gcHJldmlvdXMgc3RlcA0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpb
 mcgdXNlciBjZXJ0IHRvIG1vcmUgdGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUo
 Im94RXh0ZXJuYWxVaWQiLCBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkKQ0KICAgICAgICAgICAgaWYgZmluZF91c2VyX2J5X2V4dGVybmFsX3VpZCA9PSBOb25lOg0KICAgICAgICAgICAgICAgICMgQWR
 kIGNlcnRfdXNlcl9leHRlcm5hbF91aWQgdG8gdXNlcidzIGV4dGVybmFsIEdVSUQgbGlzdA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQgPSB1c2VyU2VydmljZS5hZG
 RVc2VyQXR0cmlidXRlKHVzZXJfbmFtZSwgIm94RXh0ZXJuYWxVaWQiLCBjZXJ0X3VzZXJfZXh0ZXJuYWxfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIGZpbmRfdXNlcl9ieV9leHRlcm5hbF91aWQgP
 T0gTm9uZToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAzLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQgdXNlciINCiAgICAgICAgICAgICAg
 ICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICB
 yZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBwcmVwYXJlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMsIHN0ZXApOg0KICAgICAgICBwcmludCAiQ2
 VydC4gUHJlcGFyZSBmb3Igc3RlcCAlZCIgJSBzdGVwDQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICANCiAgICAgICAgaWYgc3RlcCA9PSAxOg0KI
 CAgICAgICAgICAgaWYgc2VsZi5lbmFibGVkX3JlY2FwdGNoYToNCiAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgicmVjYXB0Y2hhX3NpdGVfa2V5Iiwgc2VsZi5yZWNhcHRjaGFfY3JlZHNbJ3Np
 dGVfa2V5J10pDQogICAgICAgIGVsaWYgc3RlcCA9PSAyOg0KICAgICAgICAgICAgIyBTdG9yZSBjZXJ0aWZpY2F0ZSBpbiBzZXNzaW9uDQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb250ZXh
 0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgeDUwOUNlcnRpZmljYXRlcyA9IHJlcXVlc3QuZ2V0QXR0cmlidXRlKCdqYX
 ZheC5zZXJ2bGV0LnJlcXVlc3QuWDUwOUNlcnRpZmljYXRlJykNCiAgICAgICAgICAgIGlmICh4NTA5Q2VydGlmaWNhdGVzICE9IE5vbmUpIGFuZCAobGVuKHg1MDlDZXJ0aWZpY2F0ZXMpID4gMCk6D
 QogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImNlcnRfeDUwOSIsIHNlbGYuY2VydFRvU3RyaW5nKHg1MDlDZXJ0aWZpY2F0ZXMpKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBQcmVw
 YXJlIGZvciBzdGVwIDIuIFN0b3JpbmcgdXNlciBjZXJ0aWZpY2F0ZSINCg0KICAgICAgICBpZiBzdGVwIDwgNDoNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICA
 gICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgcmV0dXJuIEFycm
 F5cy5hc0xpc3QoImNlcnRfc2VsZWN0ZWQiLCAiY2VydF92YWxpZCIsICJjZXJ0X3g1MDkiLCAiY2VydF94NTA5X2ZpbmdlcnByaW50IiwgImNlcnRfY291bnRfbG9naW5fc3RlcHMiLCAiY2VydF91c
 2VyX2V4dGVybmFsX3VpZCIpDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgY2VydF9jb3VudF9sb2dp
 bl9zdGVwcyA9IHNlbGYuZ2V0U2Vzc2lvbkF0dHJpYnV0ZSgiY2VydF9jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIGlmIGNlcnRfY291bnRfbG9naW5fc3RlcHMgIT0gTm9uZToNCiAgICAgICA
 gICAgIHJldHVybiBjZXJ0X2NvdW50X2xvZ2luX3N0ZXBzDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gMw0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYX
 Rpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgc3RlcCA9PSAxOg0KICAgICAgICAgICAgcmV0dXJuICIvYXV0aC9jZXJ0L2xvZ2luLnhodG1sIg0KICAgICAgICBpZiBzdGVwID09IDI6D
 QogICAgICAgICAgICByZXR1cm4gIi9jZXJ0LWxvZ2luLnhodG1sIg0KICAgICAgICBlbGlmIHN0ZXAgPT0gMzoNCiAgICAgICAgICAgIGNlcnRfc2VsZWN0ZWQgPSBzZWxmLmdldFNlc3Npb25BdHRy
 aWJ1dGUoImNlcnRfc2VsZWN0ZWQiKQ0KICAgICAgICAgICAgaWYgVHJ1ZSAhPSBjZXJ0X3NlbGVjdGVkOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2F1dGgvY2VydC9jZXJ0LW5vdC1zZWxlY3R
 lZC54aHRtbCINCg0KICAgICAgICAgICAgY2VydF92YWxpZCA9IHNlbGYuZ2V0U2Vzc2lvbkF0dHJpYnV0ZSgiY2VydF92YWxpZCIpDQogICAgICAgICAgICBpZiBUcnVlICE9IGNlcnRfdmFsaWQ6DQ
 ogICAgICAgICAgICAgICAgcmV0dXJuICIvYXV0aC9jZXJ0L2NlcnQtaW52YWxpZC54aHRtbCINCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuICIvbG9naW4ueGh0bWwiDQoNCiAgICAgI
 CAgcmV0dXJuICIiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYg
 cHJvY2Vzc0Jhc2ljQXV0aGVudGljYXRpb24oc2VsZiwgY3JlZGVudGlhbHMpOg0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICB1c2VyX25hbWU
 gPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgbG9nZ2VkX2luID0gRmFsc2UNCiAgIC
 AgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgI
 GxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgaWYgKG5vdCBsb2dnZWRfaW4pOg0KICAgICAgICAgICAgcmV0dXJu
 IE5vbmUNCg0KICAgICAgICBmaW5kX3VzZXJfYnlfdWlkID0gdXNlclNlcnZpY2UuZ2V0VXNlcih1c2VyX25hbWUpDQogICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICA
 gICAgICAgcHJpbnQgIkNlcnQuIFByb2Nlc3MgYmFzaWMgYXV0aGVudGljYXRpb24uIEZhaWxlZCB0byBmaW5kIHVzZXIgJyVzJyIgJSB1c2VyX25hbWUNCiAgICAgICAgICAgIHJldHVybiBOb25lDQ
 ogICAgICAgIA0KICAgICAgICByZXR1cm4gZmluZF91c2VyX2J5X3VpZA0KDQogICAgZGVmIGdldFNlc3Npb25BdHRyaWJ1dGUoc2VsZiwgYXR0cmlidXRlX25hbWUpOg0KICAgICAgICBjb250ZXh0I
 D0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCg0KICAgICAgICAjIFRyeSB0byBnZXQgYXR0cmlidXRlIHZhbHVlIGZyb20gU2VhbSBldmVudCBjb250ZXh0DQogICAgICAgIGlmIGNvbnRleHQu
 aXNTZXQoYXR0cmlidXRlX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0KGF0dHJpYnV0ZV9uYW1lKQ0KICAgICAgICANCiAgICAgICAgIyBUcnkgdG8gZ2V0IGF0dHJpYnV0ZSB
 mcm9tIHBlcnNpc3RlbnQgc2Vzc2lvbg0KICAgICAgICBzZXNzaW9uX2F0dHJpYnV0ZXMgPSBjb250ZXh0LmdldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKQ0KICAgICAgICBpZiBzZXNzaW9uX2F0dHJpYn
 V0ZXMuY29udGFpbnNLZXkoYXR0cmlidXRlX25hbWUpOg0KICAgICAgICAgICAgcmV0dXJuIHNlc3Npb25fYXR0cmlidXRlcy5nZXQoYXR0cmlidXRlX25hbWUpDQoNCiAgICAgICAgcmV0dXJuIE5vb
 mUNCg0KICAgIGRlZiBjYWxjdWxhdGVDZXJ0aWZpY2F0ZUZpbmdlcnByaW50KHNlbGYsIHg1MDlDZXJ0aWZpY2F0ZSk6DQogICAgICAgIHByaW50ICJDZXJ0LiBDYWxjdWxhdGUgZmluZ2VycHJpbnQg
 Zm9yIGNlcnRpZmljYXRlIEROICclcyciICUgeDUwOUNlcnRpZmljYXRlLmdldFN1YmplY3RYNTAwUHJpbmNpcGFsKCkNCiAgICAgICAgDQogICAgICAgIHB1YmxpY0tleSA9IHg1MDlDZXJ0aWZpY2F
 0ZS5nZXRQdWJsaWNLZXkoKQ0KICAgICAgICANCiAgICAgICAgIyBVc2Ugb3hBdXRoIGltcGxlbWVudGF0aW9uDQogICAgICAgIGZpbmdlcnByaW50ID0gRmluZ2VycHJpbnRIZWxwZXIuZ2V0UHVibG
 ljS2V5U3NoRmluZ2VycHJpbnQocHVibGljS2V5KQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZpbmdlcnByaW50ICAgICAgDQoNCiAgICBkZWYgdmFsaWRhdGVDZXJ0aWZpY2F0ZShzZWxmLCB4N
 TA5Q2VydGlmaWNhdGUpOg0KICAgICAgICBzdWJqZWN0WDUwMFByaW5jaXBhbCA9IHg1MDlDZXJ0aWZpY2F0ZS5nZXRTdWJqZWN0WDUwMFByaW5jaXBhbCgpDQoNCiAgICAgICAgcHJpbnQgIkNlcnQu
 IFZhbGlkYXRpbmcgY2VydGlmaWNhdGUgd2l0aCBETiAnJXMnIiAlIHN1YmplY3RYNTAwUHJpbmNpcGFsDQogICAgICAgIA0KICAgICAgICB2YWxpZGF0aW9uX2RhdGUgPSBqYXZhLnV0aWwuRGF0ZSg
 pDQoNCiAgICAgICAgZm9yIHR5cGUgaW4gc2VsZi52YWxpZGF0b3JfdHlwZXM6DQogICAgICAgICAgICBpZiBzZWxmLnZhbGlkYXRvcnNbdHlwZV1bMV06DQogICAgICAgICAgICAgICAgcmVzdWx0ID
 0gc2VsZi52YWxpZGF0b3JzW3R5cGVdWzBdLnZhbGlkYXRlKHg1MDlDZXJ0aWZpY2F0ZSwgc2VsZi5jaGFpbl9jZXJ0cywgdmFsaWRhdGlvbl9kYXRlKQ0KICAgICAgICAgICAgICAgIHByaW50ICJDZ
 XJ0LiBWYWxpZGF0ZSBjZXJ0aWZpY2F0ZTogJyVzJy4gVmFsaWRhdGlvbiBtZXRob2QgJyVzJyByZXN1bHQ6ICclcyciICUgKHN1YmplY3RYNTAwUHJpbmNpcGFsLCB0eXBlLCByZXN1bHQpDQogICAg
 ICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5nZXRWYWxpZGl0eSgpICE9IFZhbGlkYXRpb25TdGF0dXMuQ2VydGlmaWNhdGVWYWxpZGl0eS5WQUxJRCk6DQogICAgICAgICA
 gICAgICAgICAgIHByaW50ICJDZXJ0LiBDZXJ0aWZpY2F0ZTogJyVzJyBpcyBpbnZhbGlkIiAlIHN1YmplY3RYNTAwUHJpbmNpcGFsDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KIC
 AgICAgICANCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBjZXJ0VG9TdHJpbmcoc2VsZiwgeDUwOUNlcnRpZmljYXRlcyk6DQogICAgICAgIHJldHVybiBiYXNlNjQuYjY0ZW5jb2RlKHg1M
 DlDZXJ0aWZpY2F0ZXNbMF0uZ2V0RW5jb2RlZCgpKQ0KDQogICAgZGVmIGNlcnRGcm9tU3RyaW5nKHNlbGYsIHg1MDlDZXJ0aWZpY2F0ZUVuY29kZWQpOg0KICAgICAgICB4NTA5Q2VydGlmaWNhdGVE
 ZWNvZGVkID0gYmFzZTY0LmI2NGRlY29kZSh4NTA5Q2VydGlmaWNhdGVFbmNvZGVkKQ0KDQogICAgICAgIHJldHVybiBDZXJ0VXRpbC54NTA5Q2VydGlmaWNhdGVGcm9tQnl0ZXMoeDUwOUNlcnRpZml
 jYXRlRGVjb2RlZCkNCg0KICAgIGRlZiBpbml0UmVjYXB0Y2hhKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhIg
 0KICAgICAgICBpZiBub3QgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNyZWRlbnRpYWxzX2ZpbGUiKToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIGNlc
 nRfY3JlZHNfZmlsZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY3JlZGVudGlhbHNfZmlsZSIpLmdldFZhbHVlMigpDQoNCiAgICAgICAgIyBMb2FkIGNyZWRlbnRpYWxzIGZyb20gZmls
 ZQ0KICAgICAgICBmID0gb3BlbihjZXJ0X2NyZWRzX2ZpbGUsICdyJykNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgY3JlZHMgPSBqc29uLmxvYWRzKGYucmVhZCgpKQ0KICAgICAgICBleGNlcHQ
 6DQogICAgICAgICAgICBwcmludCAiQ2VydC4gSW5pdGlhbGl6ZSByZWNhcHRjaGEuIEZhaWxlZCB0byBsb2FkIGNyZWRlbnRpYWxzIGZyb20gZmlsZTogJXMiICUgY2VydF9jcmVkc19maWxlDQogIC
 AgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgcmVjYXB0Y2hhX2NyZ
 WRzID0gY3JlZHNbInJlY2FwdGNoYSJdDQogICAgICAgIGV4Y2VwdDoNCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY2FwdGNoYS4gSW52YWxpZCBjcmVkZW50aWFscyBmaWxl
 ICclcycgZm9ybWF0OiIgJSBjZXJ0X2NyZWRzX2ZpbGUNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICANCiAgICAgICAgc2VsZi5yZWNhcHRjaGFfY3JlZHMgPSBOb25lDQogICAgICA
 gIGlmIHJlY2FwdGNoYV9jcmVkc1siZW5hYmxlZCJdOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhLiBSZWNhcHRjaGEgaXMgZW5hYmxlZCINCg0KICAgICAgIC
 AgICAgc3RyaW5nRW5jcnlwdGVyID0gU3RyaW5nRW5jcnlwdGVyLmRlZmF1bHRJbnN0YW5jZSgpDQoNCiAgICAgICAgICAgIHNpdGVfa2V5ID0gcmVjYXB0Y2hhX2NyZWRzWyJzaXRlX2tleSJdDQogI
 CAgICAgICAgICBzZWNyZXRfa2V5ID0gcmVjYXB0Y2hhX2NyZWRzWyJzZWNyZXRfa2V5Il0NCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIHNpdGVfa2V5ID0gc3RyaW5nRW5jcnlw
 dGVyLmRlY3J5cHQoc2l0ZV9rZXkpDQogICAgICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICAgICAgIyBJZ25vcmUgZXhjZXB0aW9uLiBWYWx1ZSBpcyBub3QgZW5jcnlwdGVkDQogICAgICAgICA
 gICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhLiBBc3N1bWluZyB0aGF0ICdzaXRlX2tleScgaW4gbm90IGVuY3J5cHRlZCINCg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgIC
 AgICAgICAgIHNlY3JldF9rZXkgPSBzdHJpbmdFbmNyeXB0ZXIuZGVjcnlwdChzZWNyZXRfa2V5KQ0KICAgICAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgICAgICMgSWdub3JlIGV4Y2VwdGlvb
 i4gVmFsdWUgaXMgbm90IGVuY3J5cHRlZA0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY2FwdGNoYS4gQXNzdW1pbmcgdGhhdCAnc2VjcmV0X2tleScgaW4gbm90IGVu
 Y3J5cHRlZCINCg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZWxmLnJlY2FwdGNoYV9jcmVkcyA9IHsgJ3NpdGVfa2V5JyA6IHNpdGVfa2V5LCAic2VjcmV0X2tleSIgOiBzZWNyZXRfa2V5IH0
 NCiAgICAgICAgICAgIHByaW50ICJDZXJ0LiBJbml0aWFsaXplIHJlY2FwdGNoYS4gUmVjYXB0Y2hhIGlzIGNvbmZpZ3VyZWQgY29ycmVjdGx5Ig0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KIC
 AgICAgICBlbHNlOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIEluaXRpYWxpemUgcmVjYXB0Y2hhLiBSZWNhcHRjaGEgaXMgZGlzYWJsZWQiDQoNCiAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgI
 CBkZWYgdmFsaWRhdGVSZWNhcHRjaGEoc2VsZiwgcmVjYXB0Y2hhX3Jlc3BvbnNlKToNCiAgICAgICAgcHJpbnQgIkNlcnQuIFZhbGlkYXRlIHJlY2FwdGNoYSByZXNwb25zZSINCg0KICAgICAgICBy
 ZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICByZW1vdGVpcCA9IHJlcXVlc3QuZ2V0SGVhZGV
 yKCJYLUZPUldBUkRFRC1GT1IiKQ0KICAgICAgICBpZiByZW1vdGVpcCA9PSBOb25lOg0KICAgICAgICAgICAgcmVtb3RlaXAgPSByZXF1ZXN0LmdldFJlbW90ZUFkZHIoKQ0KICAgICAgICBwcmludC
 AiQ2VydC4gVmFsaWRhdGUgcmVjYXB0Y2hhIHJlc3BvbnNlLiByZW1vdGVpcDogJyVzJyIgJSByZW1vdGVpcA0KDQogICAgICAgIGh0dHBTZXJ2aWNlID0gSHR0cFNlcnZpY2UuaW5zdGFuY2UoKTsNC
 g0KICAgICAgICBodHRwX2NsaWVudCA9IGh0dHBTZXJ2aWNlLmdldEh0dHBzQ2xpZW50KCk7DQogICAgICAgIGh0dHBfY2xpZW50X3BhcmFtcyA9IGh0dHBfY2xpZW50LmdldFBhcmFtcygpOw0KICAg
 ICAgICBodHRwX2NsaWVudF9wYXJhbXMuc2V0SW50UGFyYW1ldGVyKENvcmVDb25uZWN0aW9uUE5hbWVzLkNPTk5FQ1RJT05fVElNRU9VVCwgMTUgKiAxMDAwKTsNCiAgICAgICAgDQogICAgICAgIHJ
 lY2FwdGNoYV92YWxpZGF0aW9uX3VybCA9ICJodHRwczovL3d3dy5nb29nbGUuY29tL3JlY2FwdGNoYS9hcGkvc2l0ZXZlcmlmeSINCiAgICAgICAgcmVjYXB0Y2hhX3ZhbGlkYXRpb25fcmVxdWVzdC
 A9IHVybGxpYi51cmxlbmNvZGUoeyAic2VjcmV0IiA6IHNlbGYucmVjYXB0Y2hhX2NyZWRzWydzZWNyZXRfa2V5J10sICJyZXNwb25zZSIgOiByZWNhcHRjaGFfcmVzcG9uc2UsICJyZW1vdGVpcCIgO
 iByZW1vdGVpcCB9KQ0KICAgICAgICByZWNhcHRjaGFfdmFsaWRhdGlvbl9oZWFkZXJzID0geyAiQ29udGVudC10eXBlIiA6ICJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQiLCAiQWNj
 ZXB0IiA6ICJhcHBsaWNhdGlvbi9qc29uIiB9DQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZVBvc3QoaHR0cF9jbGl
 lbnQsIHJlY2FwdGNoYV92YWxpZGF0aW9uX3VybCwgTm9uZSwgcmVjYXB0Y2hhX3ZhbGlkYXRpb25faGVhZGVycywgcmVjYXB0Y2hhX3ZhbGlkYXRpb25fcmVxdWVzdCkNCiAgICAgICAgICAgIGh0dH
 BfcmVzcG9uc2UgPSBodHRwX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR0cFJlc3BvbnNlKCkNCiAgICAgICAgZXhjZXB0Og0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIFZhbGlkYXRlIHJlY2FwdGNoY
 SByZXNwb25zZS4gRXhjZXB0aW9uOiAiLCBzeXMuZXhjX2luZm8oKVsxXQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgdHJ5Og0KICAgICAgICAgICAgaWYgbm90IGh0dHBTZXJ2
 aWNlLmlzUmVzcG9uc2VTdGFzdHVzQ29kZU9rKGh0dHBfcmVzcG9uc2UpOg0KICAgICAgICAgICAgICAgIHByaW50ICJDZXJ0LiBWYWxpZGF0ZSByZWNhcHRjaGEgcmVzcG9uc2UuIEdldCBpbnZhbGl
 kIHJlc3BvbnNlIGZyb20gdmFsaWRhdGlvbiBzZXJ2ZXI6ICIsIHN0cihodHRwX3Jlc3BvbnNlLmdldFN0YXR1c0xpbmUoKS5nZXRTdGF0dXNDb2RlKCkpDQogICAgICAgICAgICAgICAgaHR0cFNlcn
 ZpY2UuY29uc3VtZShodHRwX3Jlc3BvbnNlKQ0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgIA0KICAgICAgICAgICAgcmVzcG9uc2VfYnl0ZXMgPSBodHRwU2VydmljZS5nZXRSZXNwb
 25zZUNvbnRlbnQoaHR0cF9yZXNwb25zZSkNCiAgICAgICAgICAgIHJlc3BvbnNlX3N0cmluZyA9IGh0dHBTZXJ2aWNlLmNvbnZlcnRFbnRpdHlUb1N0cmluZyhyZXNwb25zZV9ieXRlcykNCiAgICAg
 ICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaHR0cF9yZXNwb25zZSkNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZS5jbG9zZUNvbm5lY3Rpb24oKQ0
 KDQogICAgICAgIGlmIHJlc3BvbnNlX3N0cmluZyA9PSBOb25lOg0KICAgICAgICAgICAgcHJpbnQgIkNlcnQuIFZhbGlkYXRlIHJlY2FwdGNoYSByZXNwb25zZS4gR2V0IGVtcHR5IHJlc3BvbnNlIG
 Zyb20gdmFsaWRhdGlvbiBzZXJ2ZXIiDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgIHJlc3BvbnNlID0ganNvbi5sb2FkcyhyZXNwb25zZV9zdHJpbmcpDQogICAgI
 CAgIA0KICAgICAgICByZXR1cm4gcmVzcG9uc2VbInN1Y2Nlc3MiXQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!14AF.A70C,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: CAS authentication module
displayName: cas
gluuStatus: false
inum: %(inumOrg)s!0011!14AF.A70C
oxConfigurationProperty: {"value1":"cas_map_user","value2":"true","description":""}
oxConfigurationProperty: {"value1":"cas_renew_opt","value2":"false","description":""}
oxConfigurationProperty: {"value1":"cas_host","value2":"https://%(hostname)s/cas","description":""}
oxLevel: 30
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KaW1wb3J0IHN5cw0KDQpmcm9tIG9yZy5qYm9zcy5zZWFtLmNvbnRleHRzIGltcG9ydCBD
 b250ZXh0cw0KZnJvbSBvcmcuamJvc3Muc2VhbS5zZWN1cml0eSBpbXBvcnQgSWRlbnRpdHkNCmZyb20gamF2YXguZmFjZXMuY29udGV4dCBpbXBvcnQgRmFjZXNDb250ZXh0DQpmcm9tIG9yZy54ZGk
 ubW9kZWwuY3VzdG9tLnNjcmlwdC50eXBlLmF1dGggaW1wb3J0IFBlcnNvbkF1dGhlbnRpY2F0aW9uVHlwZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBVc2VyU2VydmljZQ0KZn
 JvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlIGltcG9ydCBBdXRoZW50aWNhdGlvblNlcnZpY2UNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZS5uZXQgaW1wb3J0IEh0dHBTZXJ2aWNlDQpmcm9tI
 G9yZy54ZGkudXRpbCBpbXBvcnQgU3RyaW5nSGVscGVyDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgQXJyYXlIZWxwZXINCmZyb20gb3JnLmFwYWNoZS5odHRwLnBhcmFtcyBpbXBvcnQgQ29yZUNv
 bm5lY3Rpb25QTmFtZXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMNCmZyb20gamF2YS51dGlsIGltcG9ydCBIYXNoTWFwDQoNCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29
 uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaW
 xsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkNBUzIuIEluaXRpYWxpemF0aW9uIg0KICAgICAgICBwcmludCAiQ0FTMi4gS
 W5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGRlc3Ryb3koc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmlu
 dCAiQ0FTMi4gRGVzdHJveSINCiAgICAgICAgcHJpbnQgIkNBUzIuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWx
 mKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIH
 ByaW50ICJDQVMyLiBSZXN0IEFQSSBhdXRoZW50aWNhdGUgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kIg0KDQogICAgICAgIGlmIChub3QgKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRha
 W5zS2V5KCJjYXNfdmFsaWRhdGlvbl91cmkiKSBhbmQNCiAgICAgICAgICAgIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmNvbnRhaW5zS2V5KCJjYXNfdmFsaWRhdGlvbl9wYXR0ZXJuIikgYW5kDQog
 ICAgICAgICAgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX3ZhbGlkYXRpb25fdGltZW91dCIpKSk6DQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgICAgIGN
 hc192YWxpZGF0aW9uX3VyaSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fdXJpIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgY2FzX3ZhbGlkYXRpb25fcGF0dGVybi
 A9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX3ZhbGlkYXRpb25fcGF0dGVybiIpLmdldFZhbHVlMigpDQogICAgICAgIGNhc192YWxpZGF0aW9uX3RpbWVvdXQgPSBpbnQoY29uZmlnd
 XJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfdmFsaWRhdGlvbl90aW1lb3V0IikuZ2V0VmFsdWUyKCkpICogMTAwMA0KDQogICAgICAgIGh0dHBTZXJ2aWNlID0gSHR0cFNlcnZpY2UuaW5zdGFuY2Uo
 KTsNCg0KICAgICAgICBodHRwX2NsaWVudCA9IGh0dHBTZXJ2aWNlLmdldEh0dHBzQ2xpZW50KCk7DQogICAgICAgIGh0dHBfY2xpZW50X3BhcmFtcyA9IGh0dHBfY2xpZW50LmdldFBhcmFtcygpOw0
 KICAgICAgICBodHRwX2NsaWVudF9wYXJhbXMuc2V0SW50UGFyYW1ldGVyKENvcmVDb25uZWN0aW9uUE5hbWVzLkNPTk5FQ1RJT05fVElNRU9VVCwgY2FzX3ZhbGlkYXRpb25fdGltZW91dCk7DQoNCi
 AgICAgICAgdHJ5Og0KICAgICAgICAgICAgaHR0cF9zZXJ2aWNlX3Jlc3BvbnNlID0gaHR0cFNlcnZpY2UuZXhlY3V0ZUdldChodHRwX2NsaWVudCwgY2FzX3ZhbGlkYXRpb25fdXJpKQ0KICAgICAgI
 CAgICAgaHR0cF9yZXNwb25zZSA9IGh0dHBfc2VydmljZV9yZXNwb25zZS5nZXRIdHRwUmVzcG9uc2UoKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gUmVzdCBBUEkg
 YXV0aGVudGljYXRlIGlzVmFsaWRBdXRoZW50aWNhdGlvbk1ldGhvZC4gRXhjZXB0aW9uOiAiLCBzeXMuZXhjX2luZm8oKVsxXQ0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgdHJ
 5Og0KICAgICAgICAgICAgaWYgKGh0dHBfcmVzcG9uc2UuZ2V0U3RhdHVzTGluZSgpLmdldFN0YXR1c0NvZGUoKSAhPSAyMDApOg0KICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBSZXN0IEFQSS
 BhdXRoZW50aWNhdGUgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kLiBHZXQgaW52YWxpZCByZXNwb25zZSBmcm9tIENBUzIgc2VydmVyOiAiLCBzdHIoaHR0cF9yZXNwb25zZS5nZXRTdGF0dXNMa
 W5lKCkuZ2V0U3RhdHVzQ29kZSgpKQ0KICAgICAgICAgICAgICAgIGh0dHBTZXJ2aWNlLmNvbnN1bWUoaHR0cF9yZXNwb25zZSkNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICANCiAg
 ICAgICAgICAgIHZhbGlkYXRpb25fcmVzcG9uc2VfYnl0ZXMgPSBodHRwU2VydmljZS5nZXRSZXNwb25zZUNvbnRlbnQoaHR0cF9yZXNwb25zZSkNCiAgICAgICAgICAgIHZhbGlkYXRpb25fcmVzcG9
 uc2Vfc3RyaW5nID0gaHR0cFNlcnZpY2UuY29udmVydEVudGl0eVRvU3RyaW5nKHZhbGlkYXRpb25fcmVzcG9uc2VfYnl0ZXMpDQogICAgICAgICAgICBodHRwU2VydmljZS5jb25zdW1lKGh0dHBfcm
 VzcG9uc2UpDQogICAgICAgIGZpbmFsbHk6DQogICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICBpZiAodmFsaWRhdGlvbl9yZXNwb25zZ
 V9zdHJpbmcgPT0gTm9uZSBvciB2YWxpZGF0aW9uX3Jlc3BvbnNlX3N0cmluZy5maW5kKGNhc192YWxpZGF0aW9uX3BhdHRlcm4pID09IC0xKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBSZXN0
 IEFQSSBhdXRoZW50aWNhdGUgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kLiBHZXQgaW52YWxpZCBsb2dpbiBwYWdlIGZyb20gQ0FTMiBzZXJ2ZXI6Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHN
 lDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRlZiBnZXRBbHRlcm5hdGl2ZUF1dGhlbnRpY2F0aW9uTWV0aG9kKHNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg
 0KICAgICAgICBjYXNfYWx0X2F1dGhfbW9kZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2FsdF9hdXRoX21vZGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICByZXR1cm4gY2FzX2Fsd
 F9hdXRoX21vZGUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENv
 bnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0
 gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlKCk7DQoNCiAgICAgICAgY2FzX2hvc3QgPSBjb25maWd1cmF0aW9uQXR0cmlidX
 Rlcy5nZXQoImNhc19ob3N0IikuZ2V0VmFsdWUyKCkNCiAgICAgICAgY2FzX21hcF91c2VyID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc19tY
 XBfdXNlciIpLmdldFZhbHVlMigpLCBGYWxzZSkNCiAgICAgICAgY2FzX3JlbmV3X29wdCA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJjYXNfcmVu
 ZXdfb3B0IikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgIGNhc19leHRyYV9vcHRzID0gTm9uZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImN
 hc19leHRyYV9vcHRzIikpOg0KICAgICAgICAgICAgY2FzX2V4dHJhX29wdHMgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc19leHRyYV9vcHRzIikuZ2V0VmFsdWUyKCkNCg0KICAgIC
 AgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCiAgICAgICAgICAgIHRpY2tldF9hcnJheSA9IHJlcXVlc3RQYXJhbWV0Z
 XJzLmdldCgidGlja2V0IikNCiAgICAgICAgICAgIGlmIEFycmF5SGVscGVyLmlzRW1wdHkodGlja2V0X2FycmF5KToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZv
 ciBzdGVwIDEuIHRpY2tldCBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgdGlja2V0ID0gdGlja2V0X2FycmF5WzBdDQogICAgICAgICAgICBwcml
 udCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHRpY2tldDogIiArIHRpY2tldA0KDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHlTdHJpbmcodGlja2V0KSk6DQogIC
 AgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB0aWNrZXQgaXMgaW52YWxpZCINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgIyBWYWxpZGF0ZSB0aWNrZXQNCiAgICAgICAgICAgIHJlcXVlc3QgPSBGYWNlc0NvbnRleHQuZ2V0Q3VycmVudEluc3RhbmNlKCkuZ2V0RXh0ZXJuYWxDb250ZXh0KCkuZ2V0UmVxdWVzdCgpDQoN
 CiAgICAgICAgICAgIHBhcmFtZXRlcnNNYXAgPSBIYXNoTWFwKCkNCiAgICAgICAgICAgIHBhcmFtZXRlcnNNYXAucHV0KCJzZXJ2aWNlIiwgaHR0cFNlcnZpY2UuY29uc3RydWN0U2VydmVyVXJsKHJ
 lcXVlc3QpICsgIi9wb3N0bG9naW4iKQ0KICAgICAgICAgICAgaWYgKGNhc19yZW5ld19vcHQpOg0KICAgICAgICAgICAgICAgIHBhcmFtZXRlcnNNYXAucHV0KCJyZW5ldyIsICJ0cnVlIikNCiAgIC
 AgICAgICAgIHBhcmFtZXRlcnNNYXAucHV0KCJ0aWNrZXQiLCB0aWNrZXQpDQogICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5wYXJhbWV0Z
 XJzQXNTdHJpbmcocGFyYW1ldGVyc01hcCkNCiAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gY2FzX2hvc3QgKyAiL3NlcnZpY2VWYWxpZGF0ZT8iICsgY2FzX3NlcnZpY2VfcmVx
 dWVzdF91cmkNCiAgICAgICAgICAgIGlmIChjYXNfZXh0cmFfb3B0cyAhPSBOb25lKToNCiAgICAgICAgICAgICAgICBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSA9IGNhc19zZXJ2aWNlX3JlcXVlc3R
 fdXJpICsgIiYiICsgY2FzX2V4dHJhX29wdHMNCg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaTogIiArIGNhc1
 9zZXJ2aWNlX3JlcXVlc3RfdXJpDQoNCiAgICAgICAgICAgIGh0dHBfY2xpZW50ID0gaHR0cFNlcnZpY2UuZ2V0SHR0cHNDbGllbnQoKTsNCiAgICAgICAgICAgIGh0dHBfc2VydmljZV9yZXNwb25zZ
 SA9IGh0dHBTZXJ2aWNlLmV4ZWN1dGVHZXQoaHR0cF9jbGllbnQsIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAg
 dmFsaWRhdGlvbl9jb250ZW50ID0gaHR0cFNlcnZpY2UuY29udmVydEVudGl0eVRvU3RyaW5nKGh0dHBTZXJ2aWNlLmdldFJlc3BvbnNlQ29udGVudChodHRwX3NlcnZpY2VfcmVzcG9uc2UuZ2V0SHR
 0cFJlc3BvbnNlKCkpKQ0KICAgICAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgICAgICBodHRwX3NlcnZpY2VfcmVzcG9uc2UuY2xvc2VDb25uZWN0aW9uKCkNCg0KICAgICAgICAgICAgcHJpbn
 QgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiB2YWxpZGF0aW9uX2NvbnRlbnQ6ICIgKyB2YWxpZGF0aW9uX2NvbnRlbnQNCiAgICAgICAgICAgIGlmIFN0cmluZ0hlbHBlci5pc0VtcHR5K
 HZhbGlkYXRpb25fY29udGVudCk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBUaWNrZXQgdmFsaWRhdGlvbiByZXNwb25zZSBpcyBpbnZhbGlk
 Ig0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBjYXMyX2F1dGhfZmFpbHVyZSA9IHNlbGYucGFyc2VfdGFnKHZhbGlkYXRpb25fY29udGVudCwgImNhczphdXRoZW5
 0aWNhdGlvbkZhaWx1cmUiKQ0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBjYXMyX2F1dGhfZmFpbHVyZTogIiwgY2FzMl9hdXRoX2ZhaWx1cmUNCg0KIC
 AgICAgICAgICAgY2FzMl91c2VyX3VpZCA9IHNlbGYucGFyc2VfdGFnKHZhbGlkYXRpb25fY29udGVudCwgImNhczp1c2VyIikNCiAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZ
 m9yIHN0ZXAgMS4gY2FzMl91c2VyX3VpZDogIiwgY2FzMl91c2VyX3VpZA0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoKGNhczJfYXV0aF9mYWlsdXJlICE9IE5vbmUpIG9yIChjYXMyX3Vz
 ZXJfdWlkID09IE5vbmUpKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFRpY2tldCBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHV
 ybiBGYWxzZQ0KDQogICAgICAgICAgICBpZiAoY2FzX21hcF91c2VyKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZm
 luZCB1c2VyIGJ5IG94RXh0ZXJuYWxVaWQ6IGNhczI6IiArIGNhczJfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgY2FzMl91c
 2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiY2FzMjoiICsgY2FzMl91c2VyX3Vp
 ZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZ
 haWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJDQVMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgIC
 AgICAgICAgICAgICBjb250ZXh0LnNldCgiY2FzMl9jb3VudF9sb2dpbl9zdGVwcyIsIDIpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjYXMyX3VzZXJfdWlkIiwgY2FzMl91c2VyX
 3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAg
 ICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZTogIiArIGZvdW5kX3VzZXJfbmFtZQ0KDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbHM
 gPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICBjcmVkZW50aWFscy5zZXRVc2VybmFtZShmb3VuZF91c2VyX25hbWUpDQogICAgICAgICAgICAgIC
 AgY3JlZGVudGlhbHMuc2V0VXNlcihmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0a
 W5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImNhczJfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAg
 ICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSB1aWQ6IiArIGNhczJfdXN
 lcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgY2FzMl91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPS
 B1c2VyU2VydmljZS5nZXRVc2VyKGNhczJfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJDQ
 VMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2Vy
 X25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkNBUzIuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6ICIgKyB
 mb3VuZF91c2VyX25hbWUNCg0KICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICAgICAgY3JlZGVudGlhbH
 Muc2V0VXNlcm5hbWUoZm91bmRfdXNlcl9uYW1lKQ0KICAgICAgICAgICAgICAgIGNyZWRlbnRpYWxzLnNldFVzZXIoZmluZF91c2VyX2J5X3VpZCkNCg0KICAgICAgICAgICAgICAgIHByaW50ICJDQ
 VMyLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAxIg0KICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJjYXMyX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkN
 Cg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQoNCiA
 gICAgICAgICAgIHNlc3Npb25BdHRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNzaW9uQXR0cmlidXRlcyA9PSBOb25lKSBvciBub3
 Qgc2Vzc2lvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImNhczJfdXNlcl91aWQiKToNCiAgICAgICAgICAgICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGNhczJfdXNlc
 l91aWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGNhczJfdXNlcl91aWQgPSBzZXNzaW9uQXR0cmlidXRlcy5nZXQoImNhczJfdXNlcl91aWQi
 KQ0KICAgICAgICAgICAgcGFzc2VkX3N0ZXAxID0gU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcoY2FzMl91c2VyX3VpZCkNCiAgICAgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiA
 gICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbm
 FtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9I
 EZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkp
 Og0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2l
 uKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBjYXMyX3VzZXJfdWlkDQogICAgICAgICAgICAjIE
 F2b2lkIG1hcHBpbmcgQ0FTMiBhY2NvdW50IHRvIG1vcmUgdGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRya
 WJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiY2FzMjoiICsgY2FzMl91c2VyX3VpZCkNCg0KICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgIyBB
 ZGQgY2FzMl91c2VyX3VpZCB0byB1c2VyIG9uZSBpZCBVSURzDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodXNlcl9uYW1lLCA
 ib3hFeHRlcm5hbFVpZCIsICJjYXMyOiIgKyBjYXMyX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcm
 ludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY3VycmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgI
 CAgICAgIHJldHVybiBUcnVlDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNCiAgICAgICAgICAg
 ICAgICBwcmludCAiQ0FTMi4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIGZvdW5kX3VzZXJfbmFtZTogIiArIGZvdW5kX3VzZXJfbmFtZQ0KICAgIA0KICAgICAgICAgICAgICAgIGlmIFN0cmluZ0h
 lbHBlci5lcXVhbHModXNlcl9uYW1lLCBmb3VuZF91c2VyX25hbWUpOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KIC
 AgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzL
 CBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0
 YW5jZSgpDQogICAgICAgIGh0dHBTZXJ2aWNlID0gSHR0cFNlcnZpY2UuaW5zdGFuY2UoKTsNCg0KICAgICAgICBjYXNfaG9zdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2hvc3Q
 iKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBjYXNfcmVuZXdfb3B0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImNhc19yZW5ld19vcHQiKS5nZXRWYW
 x1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgY2FzX2V4dHJhX29wdHMgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiY2FzX2V4dHJhX29wdHMiK
 Sk6DQogICAgICAgICAgICBjYXNfZXh0cmFfb3B0cyA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiY2FzX2V4dHJhX29wdHMiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIGlmIChzdGVwID09
 IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFByZXBhcmUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgcmVxdWVzdCA9IEZhY2VzQ29udGV4dC5nZXRDdXJyZW50SW5zdGFuY2UoKS5nZXR
 FeHRlcm5hbENvbnRleHQoKS5nZXRSZXF1ZXN0KCkNCiAgICAgICAgICAgIHBhcmFtZXRlcnNNYXAgPSBIYXNoTWFwKCkNCiAgICAgICAgICAgIHBhcmFtZXRlcnNNYXAucHV0KCJzZXJ2aWNlIiwgaH
 R0cFNlcnZpY2UuY29uc3RydWN0U2VydmVyVXJsKHJlcXVlc3QpICsgIi9wb3N0bG9naW4iKQ0KICAgICAgICAgICAgaWYgKGNhc19yZW5ld19vcHQpOg0KICAgICAgICAgICAgICAgIHBhcmFtZXRlc
 nNNYXAucHV0KCJyZW5ldyIsICJ0cnVlIikNCiAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gYXV0aGVudGljYXRpb25TZXJ2aWNlLnBhcmFtZXRlcnNBc1N0cmluZyhwYXJhbWV0
 ZXJzTWFwKQ0KICAgICAgICAgICAgY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgPSBjYXNfaG9zdCArICIvbG9naW4/IiArIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpDQogICAgICAgICAgICBpZiBjYXN
 fZXh0cmFfb3B0cyAhPSBOb25lOg0KICAgICAgICAgICAgICAgIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpID0gY2FzX3NlcnZpY2VfcmVxdWVzdF91cmkgKyAiJiIgKyBjYXNfZXh0cmFfb3B0cw0KDQ
 ogICAgICAgICAgICBwcmludCAiQ0FTMi4gUHJlcGFyZSBmb3Igc3RlcCAxLiBjYXNfc2VydmljZV9yZXF1ZXN0X3VyaTogIiArIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpDQoNCiAgICAgICAgICAgI
 GNvbnRleHQuc2V0KCJjYXNfc2VydmljZV9yZXF1ZXN0X3VyaSIsIGNhc19zZXJ2aWNlX3JlcXVlc3RfdXJpKQ0KDQogICAgICAgICAgICByZXR1cm4gVHJ1ZQ0KICAgICAgICBlbGlmIChzdGVwID09
 IDIpOg0KICAgICAgICAgICAgcHJpbnQgIkNBUzIuIFByZXBhcmUgZm9yIHN0ZXAgMiINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiB
 GYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgIC
 AgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJjYXMyX3VzZXJfdWlkIikNCiAgICAgICAgDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q291bnRBdXRoZW50aWNhdGlvblN0ZXBzK
 HNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGlmIChjb250ZXh0LmlzU2V0KCJjYXMyX2Nv
 dW50X2xvZ2luX3N0ZXBzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ2V0KCJjYXMyX2NvdW50X2xvZ2luX3N0ZXBzIikNCiAgICAgICAgDQogICAgICAgIHJldHVybiAyDQoNCiAgICB
 kZWYgZ2V0UGFnZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHJldHVybiAiL2F1dGgvY2FzMi
 9jYXMybG9naW4ueGh0bWwiDQogICAgICAgIHJldHVybiAiL2F1dGgvY2FzMi9jYXMycG9zdGxvZ2luLnhodG1sIg0KDQogICAgZGVmIHBhcnNlX3RhZyhzZWxmLCBzdHIsIHRhZyk6DQogICAgICAgI
 HRhZzFfcG9zMSA9IHN0ci5maW5kKCI8IiArIHRhZykNCiAgICAgICAgIyAgTm8gdGFnIGZvdW5kLCByZXR1cm4gZW1wdHkgc3RyaW5nLg0KICAgICAgICBpZiB0YWcxX3BvczEgPT0gLTE6IHJldHVy
 biBOb25lDQogICAgICAgIHRhZzFfcG9zMiA9IHN0ci5maW5kKCI+IiwgdGFnMV9wb3MxKQ0KICAgICAgICBpZiB0YWcxX3BvczIgPT0gLTE6IHJldHVybiBOb25lDQogICAgICAgIHRhZzJfcG9zMSA
 9IHN0ci5maW5kKCI8LyIgKyB0YWcsIHRhZzFfcG9zMikNCiAgICAgICAgaWYgdGFnMl9wb3MxID09IC0xOiByZXR1cm4gTm9uZQ0KDQogICAgICAgIHJldHVybiBzdHJbdGFnMV9wb3MyKzE6dGFnMl
 9wb3MxXS5zdHJpcCgpDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHJldHVybiBUcnVlDQo=
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!7523.8F2D,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Google+ authentication module
displayName: gplus
gluuStatus: false
inum: %(inumOrg)s!0011!7523.8F2D
oxConfigurationProperty: {"value1":"gplus_client_secrets_file","value2":"/et
 c/certs/gplus_client_secrets.json","description":""}
oxConfigurationProperty: {"value1":"gplus_deployment_type","value2":"enroll"
 ,"description":""}
oxConfigurationProperty: {"value1":"gplus_remote_attributes_list","value2":"
 email, email, name, family_name, given_name, locale","description":""}
oxConfigurationProperty: {"value1":"gplus_local_attributes_list","value2":"u
 id, mail, givenName, sn, cn, preferredLanguage","description":""}
oxLevel: 40
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4
 dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGV
 sLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudF
 NlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsI
 EFycmF5TGlzdCwgSGFzaE1hcCwgSWRlbnRpdHlIYXNoTWFwDQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcnQgVXNlcg0KZnJvbSBvcmcueGRpLm94YXV0aC5jbGllbnQgaW1w
 b3J0IFRva2VuQ2xpZW50LCBUb2tlblJlcXVlc3QsIFVzZXJJbmZvQ2xpZW50DQpmcm9tIG9yZy54ZGkub3hhdXRoLm1vZGVsLmNvbW1vbiBpbXBvcnQgR3JhbnRUeXBlLCBBdXRoZW50aWNhdGlvbk1
 ldGhvZA0KZnJvbSBvcmcueGRpLm94YXV0aC5tb2RlbC5qd3QgaW1wb3J0IEp3dCwgSnd0Q2xhaW1OYW1lDQoNCmltcG9ydCBqYXZhDQoNCnRyeToNCiAgICBpbXBvcnQganNvbg0KZXhjZXB0IEltcG
 9ydEVycm9yOg0KICAgIGltcG9ydCBzaW1wbGVqc29uIGFzIGpzb24NCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X
 18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRp
 b25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgaWYgKG5vdCBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3B
 sdXNfY2xpZW50X3NlY3JldHNfZmlsZSIpKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgZ3BsdXNfY2xpZW50X3NlY3JldHNfZmlsZSBpcy
 BlbXB0eSINCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgIGNsaWVudFNlY3JldHNGaWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19jb
 GllbnRfc2VjcmV0c19maWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgc2VsZi5jbGllbnRTZWNyZXRzID0gc2VsZi5sb2FkQ2xpZW50U2VjcmV0cyhjbGllbnRTZWNyZXRzRmlsZSkNCiAgICAgICAg
 aWYgKHNlbGYuY2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEluaXRpYWxpemF0aW9uLiBGaWxlIHdpdGggR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBzaG9
 1bGQgYmUgbm90IGVtcHR5Ig0KICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdH
 RyaWJ1dGVzLmNvbnRhaW5zS2V5KCJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0IikgYW5kDQogICAgICAgICAgICBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfb
 G9jYWxfYXR0cmlidXRlc19saXN0IikpOg0KDQogICAgICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfcmVtb3RlX2F0dHJpYnV0
 ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkocmVtb3RlQXR0cmlidXRlc0xpc3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2x
 lKyBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5IGdwbHVzX3JlbW90ZV9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlICAgIA0KDQogICAgIC
 AgICAgICBsb2NhbEF0dHJpYnV0ZXNMaXN0ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c19sb2NhbF9hdHRyaWJ1dGVzX2xpc3QiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAga
 WYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KGxvY2FsQXR0cmlidXRlc0xpc3QpKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gVGhlIHByb3BlcnR5IGdwbHVz
 X2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgc2VsZi5hdHRyaWJ1dGVzTWFwcGluZyA9IHNlbGYucHJlcGF
 yZUF0dHJpYnV0ZXNNYXBwaW5nKHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCBsb2NhbEF0dHJpYnV0ZXNMaXN0KQ0KICAgICAgICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk6DQ
 ogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFRoZSBhdHRyaWJ1dGVzIG1hcHBpbmcgaXNuJ3QgdmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QoNCiAgICAgICAgc2VsZi5leHRlbnNpb25Nb2R1bGUgPSBOb25lDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZXh0ZW5zaW9uX21vZHVsZSIpKToNCiAg
 ICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZU5hbWUgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoImV4dGVuc2lvbl9tb2R1bGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgdHJ5Og0KICA
 gICAgICAgICAgICAgIHNlbGYuZXh0ZW5zaW9uTW9kdWxlID0gX19pbXBvcnRfXyhleHRlbnNpb25Nb2R1bGVOYW1lKQ0KICAgICAgICAgICAgICAgIGV4dGVuc2lvbk1vZHVsZUluaXRSZXN1bHQgPS
 BzZWxmLmV4dGVuc2lvbk1vZHVsZS5pbml0KGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3QgZXh0ZW5zaW9uTW9kdWxlSW5pdFJlc3VsdCk6DQogICAgICAgI
 CAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IEltcG9ydEVycm9yLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXphdGlvbi4gRmFp
 bGVkIHRvIGxvYWQgZ3BsdXNfZXh0ZW5zaW9uX21vZHVsZToiLCBleHRlbnNpb25Nb2R1bGVOYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgSW5pdGlhbGl6YXRpb24uIFVuZXhwZWN
 0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICBwcmludCAiR29vZ2xlKyBJbml0aWFsaXplZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybi
 BUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBhdXRoQ29uZmlndXJhdGlvbik6DQogICAgICAgIHByaW50ICJHb29nbGUrIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJHb29nbGUrIERlc
 3Ryb3llZCBzdWNjZXNzZnVsbHkiDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2Vs
 ZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB
 1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIH
 JlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY
 2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KDQogICAgICAgIG1hcFVzZXJEZXBsb3ltZW50ID0gRmFsc2UNCiAgICAg
 ICAgZW5yb2xsVXNlckRlcGxveW1lbnQgPSBGYWxzZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoImdwbHVzX2RlcGxveW1lbnRfdHlwZSIpKToNCiAgICA
 gICAgICAgIGRlcGxveW1lbnRUeXBlID0gU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfZGVwbG95bWVudF90eXBlIikuZ2V0VmFsdWUyKC
 kpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgIm1hcCIpKToNCiAgICAgICAgICAgICAgICBtYXBVc2VyR
 GVwbG95bWVudCA9IFRydWUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShkZXBsb3ltZW50VHlwZSwgImVucm9sbCIpKToNCiAgICAgICAgICAgICAgICBlbnJv
 bGxVc2VyRGVwbG95bWVudCA9IFRydWUNCg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxIg0KIA0KICAgICA
 gICAgICAgZ3BsdXNBdXRoQ29kZUFycmF5ID0gcmVxdWVzdFBhcmFtZXRlcnMuZ2V0KCJncGx1c19hdXRoX2NvZGUiKQ0KICAgICAgICAgICAgZ3BsdXNBdXRoQ29kZSA9IGdwbHVzQXV0aENvZGVBcn
 JheVswXQ0KDQogICAgICAgICAgICAjIENoZWNrIGlmIHVzZXIgdXNlcyBiYXNpYyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBGYWxzZQ0KICAgICAgICAgICAga
 WYgKFN0cmluZ0hlbHBlci5pc0VtcHR5U3RyaW5nKGdwbHVzQXV0aENvZGUpKToNCiAgICAgICAgICAgICAgICB1c2VCYXNpY0F1dGggPSBUcnVlDQoNCiAgICAgICAgICAgICMgVXNlIGJhc2ljIG1l
 dGhvZCB0byBsb2cgaW4NCiAgICAgICAgICAgIGlmICh1c2VCYXNpY0F1dGgpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBCYXNpYyBhdXR
 oZW50aWNhdGlvbiINCiAgICAgICAgDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCiAgICAgICAgDQogICAgICAgICAgICAgICAgY3JlZG
 VudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgICAgICB1c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgI
 CAgICB1c2VyUGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQogICAgICAgIA0KICAgICAgICAgICAgICAgIGxvZ2dlZEluID0gRmFsc2UNCiAgICAgICAgICAgICAgICBpZiAoU3Ry
 aW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlck5hbWUpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh1c2VyUGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICAgICAgdXNlclN
 lcnZpY2UgPSBVc2VyU2VydmljZS5pbnN0YW5jZSgpDQogICAgICAgICAgICAgICAgICAgIGxvZ2dlZEluID0gdXNlclNlcnZpY2UuYXV0aGVudGljYXRlKHVzZXJOYW1lLCB1c2VyUGFzc3dvcmQpDQ
 ogICAgICAgIA0KICAgICAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkSW4pOg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgDQogICAgICAgICAgICAgICAgcmV0dXJuI
 FRydWUNCg0KICAgICAgICAgICAgIyBVc2UgR29vZ2xlKyBtZXRob2QgdG8gbG9nIGluDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gZ3BsdXNBdXRo
 Q29kZToiLCBncGx1c0F1dGhDb2RlDQoNCiAgICAgICAgICAgIGN1cnJlbnRDbGllbnRTZWNyZXRzID0gc2VsZi5nZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZ
 pZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50Q2xpZW50U2VjcmV0cyA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiR2
 9vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQ2xpZW50IHNlY3JldHMgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgI
 CAgDQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBnZXRzIHRva2VucyINCiAgICAgICAgICAgIHRva2VuUmVzcG9uc2UgPSBz
 ZWxmLmdldFRva2Vuc0J5Q29kZShzZWxmLmNsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBncGx1c0F1dGhDb2RlKTsNCiAgICAgICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA
 9PSBOb25lKSBvciAodG9rZW5SZXNwb25zZS5nZXRJZFRva2VuKCkgPT0gTm9uZSkgb3IgKHRva2VuUmVzcG9uc2UuZ2V0QWNjZXNzVG9rZW4oKSA9PSBOb25lKSk6DQogICAgICAgICAgICAgICAgcH
 JpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdG9rZW5zIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZWxzZToNCiAgI
 CAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdG9rZW5zIg0KDQogICAgICAgICAgICBqd3QgPSBKd3QucGFyc2UodG9r
 ZW5SZXNwb25zZS5nZXRJZFRva2VuKCkpDQogICAgICAgICAgICAjIFRPRE86IFZhbGlkYXRlIElEIFRva2VuIFNpZ25hdHVyZSAgDQoNCiAgICAgICAgICAgIGdwbHVzVXNlclVpZCA9IGp3dC5nZXR
 DbGFpbXMoKS5nZXRDbGFpbUFzU3RyaW5nKEp3dENsYWltTmFtZS5TVUJKRUNUX0lERU5USUZJRVIpOw0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIE
 ZvdW5kIEdvb2dsZSB1c2VyIElEIGluIHRoZSBJRCB0b2tlbjogIiwgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChtYXBVc2VyRGVwbG95bWVudCk6DQogICAgICAgI
 CAgICAgICAgIyBVc2UgbWFwcGluZyB0byBsb2NhbCBJRFAgdXNlcg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZp
 bmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBncGx1czoiLCBncGx1c1VzZXJVaWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aXRoIHNwZWNpZmllZCBncGx1c1V
 zZXJVaWQNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclVpZCkNCg0KIC
 AgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZ
 CB1c2VyIg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0KICAgICAgICAgICAgICAgICAg
 ICBjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAyKQ0KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgiZ3BsdXNfdXNlcl91aWQiLCBncGx1c1VzZXJVaWQpDQogICA
 gICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNCiAgICAgICAgICAgICAgICBmb3VuZFVzZXJOYW1lID0gZm91bmRVc2VyLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2
 dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kVXNlck5hbWU6IiwgZm91bmRVc2VyTmFtZQ0KICAgICAgICAgICAgICAgIA0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdGVkI
 D0gYXV0aGVudGljYXRpb25TZXJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgICAg
 ICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0
 KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgIC
 Bjb250ZXh0LnNldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhd
 GlvbkF0dHJpYnV0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJl
 c3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICAgICAgZWxpZiAoZW5yb2xsVXNlckRlcGxveW1lbnQpOg0KICAgICAgICAgICAgICAgICMgVXNlIGF
 1dG8gZW5yb2xsbWVudCB0byBsb2NhbCBJRFANCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgb3
 hFeHRlcm5hbFVpZDogZ3BsdXM6IiwgZ3BsdXNVc2VyVWlkDQogDQogICAgICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdpdGggc3BlY2lmaWVkIGdwbHVzVXNlclVpZA0KICAgI
 CAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXJCeUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAg
 ICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICMgQXV0byB1c2VyIGVucm9sbGVtbnQNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGV
 udGljYXRlIGZvciBzdGVwIDEuIFRoZXJlIGlzIG5vIHVzZXIgaW4gTERBUC4gQWRkaW5nIHVzZXIgdG8gbG9jYWwgTERBUCINCg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdX
 RoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBnZXRzIHVzZXIgaW5mbyINCiAgICAgICAgICAgICAgICAgICAgdXNlckluZm9SZXNwb25zZSA9IHNlbGYuZ2V0VXNlckluZm8oY3Vyc
 mVudENsaWVudFNlY3JldHMsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB0b2tlblJlc3BvbnNlLmdldEFjY2Vzc1Rva2VuKCkpDQogICAgICAgICAgICAgICAgICAgIGlmICgodXNlckluZm9SZXNw
 b25zZSA9PSBOb25lKSBvciAodXNlckluZm9SZXNwb25zZS5nZXRDbGFpbXMoKS5zaXplKCkgPT0gMCkpOg0KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXR
 lIGZvciBzdGVwIDEuIEZhaWxlZCB0byBnZXQgdXNlciBpbmZvIg0KICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIGVsc2U6DQogICAgICAgIC
 AgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU3VjY2Vzc2Z1bGx5IGdldHMgdXNlciBpbmZvIg0KICAgICAgICAgICAgICAgICAgICANCiAgICAgI
 CAgICAgICAgICAgICAgZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZXMgPSB1c2VySW5mb1Jlc3BvbnNlLmdldENsYWltcygpDQogDQogICAgICAgICAgICAgICAgICAgICMgQ29udmVydCBHb29nbGUrIHVz
 ZXIgY2xhaW1zIHRvIGxvdmVyIGNhc2UNCiAgICAgICAgICAgICAgICAgICAgZ3BsdXNSZXNwb25zZU5vcm1hbGl6ZWRBdHRyaWJ1dGVzID0gSGFzaE1hcCgpDQogICAgICAgICAgICAgICAgICAgIGZ
 vciBncGx1c1Jlc3BvbnNlQXR0cmlidXRlRW50cnkgaW4gZ3BsdXNSZXNwb25zZUF0dHJpYnV0ZXMuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGdwbHVzUmVzcG9uc2VOb3JtYW
 xpemVkQXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKGdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRLZXkoKSksI
 GdwbHVzUmVzcG9uc2VBdHRyaWJ1dGVFbnRyeS5nZXRWYWx1ZSgpKQ0KIA0KICAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLmdldEN1cnJlbnRBdHRyaWJ1
 dGVzTWFwcGluZyhzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGU
 rIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBVc2luZyBuZXh0IGF0dHJpYnV0ZXMgbWFwcGluZyIsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KIA0KICAgICAgICAgICAgICAgICAgICBuZXdVc2
 VyID0gVXNlcigpDQogICAgICAgICAgICAgICAgICAgIGZvciBhdHRyaWJ1dGVzTWFwcGluZ0VudHJ5IGluIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy5lbnRyeVNldCgpOg0KICAgICAgICAgICAgI
 CAgICAgICAgICAgcmVtb3RlQXR0cmlidXRlID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRLZXkoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBhdHRyaWJ1dGVz
 TWFwcGluZ0VudHJ5LmdldFZhbHVlKCkNCiANCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBncGx1c1Jlc3BvbnNlTm9ybWFsaXplZEF0dHJpYnV0ZXMuZ2V0KHJ
 lbW90ZUF0dHJpYnV0ZSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2NhbEF0dHJpYnV0ZSAhPSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0dH
 JpYnV0ZShsb2NhbEF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGVWYWx1ZSkNCiANCiAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1VzZXIuZ2V0QXR0cmlidXRlKCJzbiIpID09IE5vbmUpOg0KICAgI
 CAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXRBdHRyaWJ1dGUoInNuIiwgZ3BsdXNVc2VyVWlkKQ0KIA0KICAgICAgICAgICAgICAgICAgICBpZiAobmV3VXNlci5nZXRBdHRyaWJ1dGUoImNu
 IikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgICAgICBuZXdVc2VyLnNldEF0dHJpYnV0ZSgiY24iLCBncGx1c1VzZXJVaWQpDQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlci5zZXR
 BdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAiZ3BsdXM6IiArIGdwbHVzVXNlclVpZCkNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIE
 F0dGVtcHRpbmcgdG8gYWRkIHVzZXIiLCBncGx1c1VzZXJVaWQsICIgd2l0aCBuZXh0IGF0dHJpYnV0ZXMiLCBuZXdVc2VyLmdldEN1c3RvbUF0dHJpYnV0ZXMoKQ0KIA0KICAgICAgICAgICAgICAgI
 CAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBB
 ZGRlZCBuZXcgdXNlciB3aXRoIFVJRCIsIGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KDQogICAgICAgICAgICAgICAgZm91bmRVc2VyTmFtZSA9IGZvdW5kVXNlci5nZXRVc2VySWQoKQ0KICAgICAgICA
 gICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZFVzZXJOYW1lOiIsIGZvdW5kVXNlck5hbWUNCg0KICAgICAgICAgICAgICAgIHVzZXJBdXRoZW50aWNhdG
 VkID0gYXV0aGVudGljYXRpb25TZXJ2aWNlLmF1dGhlbnRpY2F0ZShmb3VuZFVzZXJOYW1lKQ0KICAgICAgICAgICAgICAgIGlmICh1c2VyQXV0aGVudGljYXRlZCA9PSBGYWxzZSk6DQogICAgICAgI
 CAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxz
 ZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFNldHRpbmcgY291bnQgc3RlcHMgdG8gMSINCiAgICAgICAgICAgICAgICBjb250ZXh0LnN
 ldCgiZ3BsdXNfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdExvZ2luUmVzdWx0ID0gc2VsZi5leHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYn
 V0ZXMsIGZvdW5kVXNlcikNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gcG9zdExvZ2luUmVzdWx0OiIsIHBvc3RMb2dpblJlc3VsdA0KDQogI
 CAgICAgICAgICAgICAgcmV0dXJuIHBvc3RMb2dpblJlc3VsdA0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICAjIENoZWNrIGlmIHRoZXJlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQg
 Z3BsdXNVc2VyVWlkDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2VyIGJ5IHVpZDoiLCBncGx1c1VzZXJ
 VaWQNCg0KICAgICAgICAgICAgICAgIGZvdW5kVXNlciA9IHVzZXJTZXJ2aWNlLmdldFVzZXIoZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogIC
 AgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gZmluZCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNC
 g0KICAgICAgICAgICAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlcklkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4g
 Zm91bmRVc2VyTmFtZToiLCBmb3VuZFVzZXJOYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyQXV0aGVudGljYXRlZCA9IGF1dGhlbnRpY2F0aW9uU2VydmljZS5hdXRoZW50aWNhdGUoZm91bmRVc2V
 yTmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlckF1dGhlbnRpY2F0ZWQgPT0gRmFsc2UpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZX
 AgMS4gRmFpbGVkIHRvIGF1dGhlbnRpY2F0ZSB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0Z
 SBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAg
 ICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSs
 gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHBvc3RMb2dpblJlc3VsdDoiLCBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgZW
 xpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBzZXNzaW9uQXR0cmlidXRlc
 yA9IGNvbnRleHQuZ2V0KCJzZXNzaW9uQXR0cmlidXRlcyIpDQogICAgICAgICAgICBpZiAoc2Vzc2lvbkF0dHJpYnV0ZXMgPT0gTm9uZSkgb3Igbm90IHNlc3Npb25BdHRyaWJ1dGVzLmNvbnRhaW5z
 S2V5KCJncGx1c191c2VyX3VpZCIpOg0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBncGx1c191c2VyX3VpZCBpcyBlbXB0eSINCiAgICAgICA
 gICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgZ3BsdXNVc2VyVWlkID0gc2Vzc2lvbkF0dHJpYnV0ZXMuZ2V0KCJncGx1c191c2VyX3VpZCIpDQogICAgICAgICAgICBwYXNzZWRfc3
 RlcDEgPSBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyhncGx1c1VzZXJVaWQpDQogICAgICAgICAgICBpZiAobm90IHBhc3NlZF9zdGVwMSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhb
 HNlDQoNCiAgICAgICAgICAgIGNyZWRlbnRpYWxzID0gSWRlbnRpdHkuaW5zdGFuY2UoKS5nZXRDcmVkZW50aWFscygpDQogICAgICAgICAgICB1c2VyTmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJu
 YW1lKCkNCiAgICAgICAgICAgIHVzZXJQYXNzd29yZCA9IGNyZWRlbnRpYWxzLmdldFBhc3N3b3JkKCkNCg0KICAgICAgICAgICAgbG9nZ2VkSW4gPSBGYWxzZQ0KICAgICAgICAgICAgaWYgKFN0cml
 uZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJOYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlclBhc3N3b3JkKSk6DQogICAgICAgICAgICAgICAgbG9nZ2VkSW4gPS
 B1c2VyU2VydmljZS5hdXRoZW50aWNhdGUodXNlck5hbWUsIHVzZXJQYXNzd29yZCkNCg0KICAgICAgICAgICAgaWYgKG5vdCBsb2dnZWRJbik6DQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlD
 QoNCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlcmUgaXMgdXNlciB3aGljaCBoYXMgZ3BsdXNVc2VyVWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgR29vZ2xlIGFjY291bnQgdG8gbW9y
 ZSB0aGFuIG9uZSBJRFAgYWNjb3VudA0KICAgICAgICAgICAgZm91bmRVc2VyID0gdXNlclNlcnZpY2UuZ2V0VXNlckJ5QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgImdwbHVzOiIgKyBncGx1c1V
 zZXJVaWQpDQoNCiAgICAgICAgICAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgIyBBZGQgZ3BsdXNVc2VyVWlkIHRvIHVzZXIgb25lIGlkIFVJRHMNCiAgICAgICAgIC
 AgICAgICBmb3VuZFVzZXIgPSB1c2VyU2VydmljZS5hZGRVc2VyQXR0cmlidXRlKHVzZXJOYW1lLCAib3hFeHRlcm5hbFVpZCIsICJncGx1czoiICsgZ3BsdXNVc2VyVWlkKQ0KICAgICAgICAgICAgI
 CAgIGlmIChmb3VuZFVzZXIgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBGYWlsZWQgdG8gdXBkYXRlIGN1cnJlbnQg
 dXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvblBvc3RMb2dpbihjb25maWd1cmF0aW9
 uQXR0cmlidXRlcywgZm91bmRVc2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bHQ6IiwgcG9zdExvZ2luUmVzdW
 x0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdExvZ2luUmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIGZvdW5kVXNlck5hbWUgPSBmb3VuZFVzZXIuZ2V0VXNlc
 klkKCkNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMi4gZm91bmRVc2VyTmFtZToiLCBmb3VuZFVzZXJOYW1lDQogICAgDQogICAgICAgICAgICAg
 ICAgaWYgU3RyaW5nSGVscGVyLmVxdWFscyh1c2VyTmFtZSwgZm91bmRVc2VyTmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RMb2dpblJlc3VsdCA9IHNlbGYuZXh0ZW5zaW9uUG9zdExvZ2l
 uKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmb3VuZFVzZXIpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAyLiBwb3N0TG9naW5SZXN1bH
 Q6IiwgcG9zdExvZ2luUmVzdWx0DQogICAgDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgI
 CAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3Rl
 cCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2U
 oKQ0KDQogICAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBjdXJyZW50Q2
 xpZW50U2VjcmV0cyA9IHNlbGYuZ2V0Q3VycmVudENsaWVudFNlY3JldHMoc2VsZi5jbGllbnRTZWNyZXRzLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgI
 CAgICAgICBpZiAoY3VycmVudENsaWVudFNlY3JldHMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZSBmb3Igc3RlcCAxLiBHb29nbGUrIGNsaWVudCBjb25m
 aWd1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJncGx1c19jbGllbnRfaWQiLCBjdXJ
 yZW50Q2xpZW50U2VjcmV0c1sid2ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICAgICAgY29udGV4dC5zZXQoImdwbHVzX2NsaWVudF9zZWNyZXQiLCBjdXJyZW50Q2xpZW50U2VjcmV0c1sid2ViIl
 1bImNsaWVudF9zZWNyZXQiXSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmUgZm9yI
 HN0ZXAgMiINCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAo
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICBpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHJldHVybiBBcnJheXMuYXNMaXN0KCJncGx1c191c2VyX3VpZCI
 pDQoNCiAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID
 0gQ29udGV4dHMuZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoImdwbHVzX2NvdW50X2xvZ2luX3N0ZXBzIikpOg0KICAgICAgICAgICAgcmV0dXJuIGNvbnRleHQuZ
 2V0KCJncGx1c19jb3VudF9sb2dpbl9zdGVwcyIpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gMg0KDQogICAgZGVmIGdldFBhZ2VGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVz
 LCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogICAgICAgICAgICByZXR1cm4gIi9hdXRoL2dwbHVzL2dwbHVzbG9naW4ueGh0bWwiDQoNCiAgICAgICAgcmV0dXJuICIvYXV0aC9ncGx
 1cy9ncGx1c3Bvc3Rsb2dpbi54aHRtbCINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgIyBUT0RPIFJldm
 9rZSB0b2tlbg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGxvYWRDbGllbnRTZWNyZXRzKHNlbGYsIGNsaWVudFNlY3JldHNGaWxlKToNCiAgICAgICAgY2xpZW50U2VjcmV0cyA9IE5vb
 mUNCg0KICAgICAgICAjIExvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlDQogICAgICAgIGYgPSBvcGVuKGNsaWVudFNlY3JldHNGaWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIGNs
 aWVudFNlY3JldHMgPSBqc29uLmxvYWRzKGYucmVhZCgpKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiRmFpbGVkIHRvIGxvYWQgR29vZ2xlKyBjbGllbnQgc2VjcmV0cyBmcm9
 tIGZpbGU6IiwgY2xpZW50U2VjcmV0cw0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dX
 JuIGNsaWVudFNlY3JldHMNCg0KICAgIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR
 2V0IGNsaWVudCBjb25maWd1cmF0aW9uDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgiZ3BsdXNfY2xpZW50X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlIikp
 Og0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbkF0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgiZ3BsdXNfY2xpZW50X2NvbmZpZ3VyYXRpb25fYXR0cmlidXRlIik
 uZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhdHRyaWJ1dGU6IiwgY2xpZW50Q29uZmlndXJhdGlvbkF0dH
 JpYnV0ZQ0KDQogICAgICAgICAgICBpZiAocmVxdWVzdFBhcmFtZXRlcnMgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50SWQgPSBOb25lD
 QogICAgICAgICAgICANCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pbmUgY2xpZW50X2lkIGZyb20gcmVxdWVzdA0KICAgICAgICAgICAgY2xpZW50SWRBcnJheSA9IHJlcXVlc3RQYXJh
 bWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5pc05vdEVtcHR5KGNsaWVudElkQXJyYXkpIGFuZCBTdHJpbmdIZWxwZXIuaXNOb3RFbXB0eVN0cmluZyh
 jbGllbnRJZEFycmF5WzBdKSk6DQogICAgICAgICAgICAgICAgY2xpZW50SWQgPSBjbGllbnRJZEFycmF5WzBdDQoNCiAgICAgICAgICAgICMgQXR0ZW1wdCB0byBkZXRlcm1pbmUgY2xpZW50X2lkIG
 Zyb20gZXZlbnQgY29udGV4dA0KICAgICAgICAgICAgaWYgKGNsaWVudElkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpD
 QogICAgICAgICAgICAgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgICAgICAgICAgICAgICAgIGNsaWVudElkID0gZXZlbnRDb250ZXh0LmdldCgi
 c2Vzc2lvbkF0dHJpYnV0ZXMiKS5nZXQoImNsaWVudF9pZCIpDQoNCiAgICAgICAgICAgIGlmIChjbGllbnRJZCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGl
 lbnRDb25maWd1cmF0aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW
 5zdGFuY2UoKQ0KICAgICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50SWQpDQogICAgICAgICAgICBpZiAoY2xpZW50ID09IE5vbmUpOg0KICAgICAgICAgICAgI
 CAgIHByaW50ICJHb29nbGUrIEdldENsaWVudENvbmZpZ3VyYXRpb24uIEZhaWxlZCB0byBmaW5kIGNsaWVudCIsIGNsaWVudElkLCAiIGluIGxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0
 dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgY2xpZW50Q29uZmlndXJhdGlvbkF0dHJpYnV
 0ZSkNCiAgICAgICAgICAgIGlmICgoY2xpZW50Q29uZmlndXJhdGlvbiA9PSBOb25lKSBvciBTdHJpbmdIZWxwZXIuaXNFbXB0eShjbGllbnRDb25maWd1cmF0aW9uLmdldFZhbHVlKCkpKToNCiAgIC
 AgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdHRyaWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlL
 CAiIGlzIGVtcHR5Ig0KICAgICAgICAgICAgZWxzZToNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBHZXRDbGllbnRDb25maWd1cmF0aW9uLiBDbGllbnQiLCBjbGllbnRJZCwgIiBhdHRy
 aWJ1dGUiLCBjbGllbnRDb25maWd1cmF0aW9uQXR0cmlidXRlLCAiIGlzIiwgY2xpZW50Q29uZmlndXJhdGlvbg0KICAgICAgICAgICAgICAgIHJldHVybiBjbGllbnRDb25maWd1cmF0aW9uDQoNCiA
 gICAgICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDdXJyZW50Q2xpZW50U2VjcmV0cyhzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3
 RQYXJhbWV0ZXJzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlc
 nMpDQogICAgICAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRDbGllbnRTZWNyZXRzDQogICAgICAgIA0KICAgICAgICBjbGllbnRD
 b25maWd1cmF0aW9uVmFsdWUgPSBqc29uLmxvYWRzKGNsaWVudENvbmZpZ3VyYXRpb24uZ2V0VmFsdWUoKSkNCg0KICAgICAgICByZXR1cm4gY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1cyJ
 dDQoNCiAgICBkZWYgZ2V0Q3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nKHNlbGYsIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZX
 JzKToNCiAgICAgICAgY2xpZW50Q29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZmlndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgI
 CAgIGlmIChjbGllbnRDb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgICAgcmV0dXJuIGN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZw0KDQogICAgICAgIGNsaWVudENvbmZpZ3VyYXRpb25W
 YWx1ZSA9IGpzb24ubG9hZHMoY2xpZW50Q29uZmlndXJhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID0gc2VsZi5wcmVwYXJlQXR0cmlidXRlc01hcHB
 pbmcoY2xpZW50Q29uZmlndXJhdGlvblZhbHVlWyJncGx1c19yZW1vdGVfYXR0cmlidXRlc19saXN0Il0sIGNsaWVudENvbmZpZ3VyYXRpb25WYWx1ZVsiZ3BsdXNfbG9jYWxfYXR0cmlidXRlc19saX
 N0Il0pDQogICAgICAgIGlmIChjbGllbnRBdHRyaWJ1dGVzTWFwcGluZyA9PSBOb25lKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIEdldEN1cnJlbnRBdHRyaWJ1dGVzTWFwcGluZy4gQ2xpZ
 W50IGF0dHJpYnV0ZXMgbWFwcGluZyBpcyBpbnZhbGlkLiBVc2luZyBkZWZhdWx0IG9uZSINCiAgICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICByZXR1
 cm4gY2xpZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgIGRlZiBwcmVwYXJlQXR0cmlidXRlc01hcHBpbmcoc2VsZiwgcmVtb3RlQXR0cmlidXRlc0xpc3QsIGxvY2FsQXR0cmlidXRlc0xpc3QpOg0
 KICAgICAgICByZW1vdGVBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHJlbW90ZUF0dHJpYnV0ZXNMaXN0LCAiLCIpDQogICAgICAgIGlmIChBcnJheUhlbHBlci5pc0VtcH
 R5KHJlbW90ZUF0dHJpYnV0ZXNMaXN0QXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXRlcyBzcGVja
 WZpZWQgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgbG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5ID0gU3Ry
 aW5nSGVscGVyLnNwbGl0KGxvY2FsQXR0cmlidXRlc0xpc3QsICIsIikNCiAgICAgICAgaWYgKEFycmF5SGVscGVyLmlzRW1wdHkobG9jYWxBdHRyaWJ1dGVzTGlzdEFycmF5KSk6DQogICAgICAgICA
 gICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIGxvY2FsQXR0cmlidXRlc0xpc3QgcHJvcGVydHkiDQogIC
 AgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGlmIChsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkgIT0gbGVuKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJheSkpOg0KICAgICAgICAgI
 CAgcHJpbnQgIkdvb2dsZSsgUHJlcGFyZUF0dHJpYnV0ZXNNYXBwaW5nLiBUaGUgbnVtYmVyIG9mIGF0dHJpYnV0ZXMgaW4gcmVtb3RlQXR0cmlidXRlc0xpc3QgYW5kIGxvY2FsQXR0cmlidXRlc0xp
 c3QgaXNuJ3QgZXF1YWwiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KICAgICAgICANCiAgICAgICAgYXR0cmlidXRlTWFwcGluZyA9IElkZW50aXR5SGFzaE1hcCgpDQogICAgICAgIGNvbnRhaW5
 zVWlkID0gRmFsc2UNCiAgICAgICAgaSA9IDANCiAgICAgICAgY291bnQgPSBsZW4ocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICAgICAgIC
 AgICByZW1vdGVBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UocmVtb3RlQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gU3RyaW5nS
 GVscGVyLnRvTG93ZXJDYXNlKGxvY2FsQXR0cmlidXRlc0xpc3RBcnJheVtpXSkNCiAgICAgICAgICAgIGF0dHJpYnV0ZU1hcHBpbmcucHV0KHJlbW90ZUF0dHJpYnV0ZSwgbG9jYWxBdHRyaWJ1dGUp
 DQoNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShsb2NhbEF0dHJpYnV0ZSwgInVpZCIpKToNCiAgICAgICAgICAgICAgICBjb250YWluc1VpZCA9IFRydWUNCg0
 KICAgICAgICAgICAgaSA9IGkgKyAxDQoNCiAgICAgICAgaWYgKG5vdCBjb250YWluc1VpZCk6DQogICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZX
 JlIGlzIG5vIG1hcHBpbmcgdG8gbWFuZGF0b3J5ICd1aWQnIGF0dHJpYnV0ZSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICByZXR1cm4gYXR0cmlidXRlTWFwcGluZ
 w0KDQogICAgZGVmIGdldFRva2Vuc0J5Q29kZShzZWxmLCBjdXJyZW50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGNvZGUpOg0KICAgICAgICB0b2tlblJlcXVlc3QgPSBU
 b2tlblJlcXVlc3QoR3JhbnRUeXBlLkNMSUVOVF9DUkVERU5USUFMUykNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhlbnRpY2F0aW9uTWV0aG9kKEF1dGhlbnRpY2F0aW9uTWV0aG9kLkNMSUV
 OVF9TRUNSRVRfUE9TVCkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldENvZGUoY29kZSkNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEF1dGhVc2VybmFtZShjdXJyZW50Q2xpZW50U2VjcmV0c1sid2
 ViIl1bImNsaWVudF9pZCJdKQ0KICAgICAgICB0b2tlblJlcXVlc3Quc2V0QXV0aFBhc3N3b3JkKGN1cnJlbnRDbGllbnRTZWNyZXRzWyJ3ZWIiXVsiY2xpZW50X3NlY3JldCJdKQ0KICAgICAgICB0b
 2tlblJlcXVlc3Quc2V0UmVkaXJlY3RVcmkoInBvc3RtZXNzYWdlIikNCiAgICAgICAgdG9rZW5SZXF1ZXN0LnNldEdyYW50VHlwZShHcmFudFR5cGUuQVVUSE9SSVpBVElPTl9DT0RFKQ0KDQogICAg
 ICAgIHRva2VuQ2xpZW50ID0gVG9rZW5DbGllbnQoY3VycmVudENsaWVudFNlY3JldHNbIndlYiJdWyJ0b2tlbl91cmkiXSkNCiAgICAgICAgdG9rZW5DbGllbnQuc2V0UmVxdWVzdCh0b2tlblJlcXV
 lc3QpDQogICAgICAgIA0KICAgICAgICB0b2tlblJlc3BvbnNlID0gdG9rZW5DbGllbnQuZXhlYygpDQogICAgICAgIGlmICgodG9rZW5SZXNwb25zZSA9PSBOb25lKSBvciAodG9rZW5SZXNwb25zZS
 5nZXRTdGF0dXMoKSAhPSAyMDApKToNCiAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgcmV0dXJuIHRva2VuUmVzcG9uc2UNCg0KICAgIGRlZiBnZXRVc2VySW5mbyhzZWxmLCBjdXJyZ
 W50Q2xpZW50U2VjcmV0cywgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGFjY2Vzc1Rva2VuKToNCiAgICAgICAgdXNlckluZm9DbGllbnQgPSBVc2VySW5mb0NsaWVudCgiaHR0cHM6Ly93d3cuZ29v
 Z2xlYXBpcy5jb20vcGx1cy92MS9wZW9wbGUvbWUvb3BlbklkQ29ubmVjdCIpDQoNCiAgICAgICAgdXNlckluZm9SZXNwb25zZSA9IHVzZXJJbmZvQ2xpZW50LmV4ZWNVc2VySW5mbyhhY2Nlc3NUb2t
 lbikNCiAgICAgICAgaWYgKCh1c2VySW5mb1Jlc3BvbnNlID09IE5vbmUpIG9yICh1c2VySW5mb1Jlc3BvbnNlLmdldFN0YXR1cygpICE9IDIwMCkpOg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg
 0KICAgICAgICByZXR1cm4gdXNlckluZm9SZXNwb25zZQ0KDQogICAgZGVmIGV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgdXNlcik6DQogICAgICAgIGlmI
 ChzZWxmLmV4dGVuc2lvbk1vZHVsZSAhPSBOb25lKToNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBwb3N0TG9naW5SZXN1bHQgPSBzZWxmLmV4dGVuc2lvbk1vZHVsZS5wb3N0TG9n
 aW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHVzZXIpDQogICAgICAgICAgICAgICAgcHJpbnQgIkdvb2dsZSsgUG9zdExvZ2luIHJlc3VsdDoiLCBwb3N0TG9naW5SZXN1bHQNCg0KICAgICAgICA
 gICAgICAgIHJldHVybiBwb3N0TG9naW5SZXN1bHQNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJHb29nbGUrIFBvc3RMb2dpbi4gRmFpbG
 VkIHRvIGV4ZWN1dGUgcG9zdExvZ2luIG1ldGhvZCINCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIFVuZXhwZWN0ZWQgZXJyb3I6IiwgZXgNCiAgICAgICAgICAgICAgI
 CByZXR1cm4gRmFsc2UNCiAgICAgICAgICAgIGV4Y2VwdCBqYXZhLmxhbmcuVGhyb3dhYmxlLCBleDoNCiAgICAgICAgICAgICAgICBwcmludCAiR29vZ2xlKyBQb3N0TG9naW4uIEZhaWxlZCB0byBl
 eGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRTdGFja1RyYWNlKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICA
 gIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!D40C.1CA3,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Saml authentication module
displayName: saml
gluuStatus: false
inum: %(inumOrg)s!0011!D40C.1CA3
oxConfigurationProperty: {"value1":"saml_certificate_file","value2":"/etc/ce
 rts/saml.pem","description":""}
oxConfigurationProperty: {"value1":"saml_deployment_type","value2":"enroll",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_attributes_list","value2":"http
 ://schemas.xmlsoap.org/ws/2005/05/identity/claims/name, http://schemas.xmls
 oap.org/ws/2005/05/identity/claims/emailaddress, http://schemas.xmlsoap.org
 /ws/2005/05/identity/claims/givenname, http://schemas.xmlsoap.org/ws/2005/0
 5/identity/claims/surname, http://schemas.xmlsoap.org/ws/2005/05/identity/c
 laims/surname","description":""}
oxConfigurationProperty: {"value1":"saml_local_attributes_list","value2":"ui
 d, mail, givenName, sn, cn","description":""}
oxConfigurationProperty: {"value1":"saml_name_identifier_format","value2":"u
 rn:oasis:names:tc:SAML:2.0:nameid-format:persistent","description":""}
oxConfigurationProperty: {"value1":"saml_use_authn_context","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_validate_response","value2":"true",
 "description":""}
oxConfigurationProperty: {"value1":"saml_idp_sso_target_url","value2":"https
 ://idp.gluu.info/idp/profile/SAML2/Redirect/SSO","description":""}
oxConfigurationProperty: {"value1":"saml_issuer","value2":"https://sp.gluu.i
 nfo/shibboleth","description":""}
oxLevel: 50
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4NCiMNCg0KZnJvbSBvcmcuamJvc3Muc2VhbS5jb250ZXh0cyBpbXBvcnQgQ29udGV4dCwgQ29udGV4
 dHMNCmZyb20gb3JnLmpib3NzLnNlYW0uc2VjdXJpdHkgaW1wb3J0IElkZW50aXR5DQpmcm9tIGphdmF4LmZhY2VzLmNvbnRleHQgaW1wb3J0IEZhY2VzQ29udGV4dA0KZnJvbSBvcmcueGRpLm1vZGV
 sLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXBvcnQgVXNlclNlcnZpY2UsIENsaWVudF
 NlcnZpY2UsIEF1dGhlbnRpY2F0aW9uU2VydmljZSwgQXR0cmlidXRlU2VydmljZQ0KZnJvbSBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLm5ldCBpbXBvcnQgSHR0cFNlcnZpY2UNCmZyb20gb3JnLnhka
 S51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBBcnJheUhlbHBlcg0KZnJvbSBvcmcuZ2x1dS5zYW1sIGltcG9ydCBTYW1sQ29uZmlndXJhdGlvbiwgQXV0
 aFJlcXVlc3QsIFJlc3BvbnNlDQpmcm9tIGphdmEudXRpbCBpbXBvcnQgQXJyYXlzLCBBcnJheUxpc3QsIEhhc2hNYXAsIElkZW50aXR5SGFzaE1hcA0KZnJvbSBvcmcueGRpLm94YXV0aC5tb2RlbC5
 jb21tb24gaW1wb3J0IFVzZXINCmZyb20gb3JnLnhkaS5sZGFwLm1vZGVsIGltcG9ydCBDdXN0b21BdHRyaWJ1dGUNCg0KaW1wb3J0IGphdmENCg0KdHJ5Og0KICAgIGltcG9ydCBqc29uDQpleGNlcH
 QgSW1wb3J0RXJyb3I6DQogICAgaW1wb3J0IHNpbXBsZWpzb24gYXMganNvbg0KDQpjbGFzcyBQZXJzb25BdXRoZW50aWNhdGlvbihQZXJzb25BdXRoZW50aWNhdGlvblR5cGUpOg0KICAgIGRlZiBfX
 2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHNlbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaXQoc2VsZiwgY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2FtbC4gSW5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gY29uZmlndXJhdGlvbkF0dHJpYnV
 0ZXMuZ2V0KCJzYW1sX2NlcnRpZmljYXRlX2ZpbGUiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF
 9pZHBfc3NvX3RhcmdldF91cmwiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBzYW1sX2lzc3VlciA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9pc3N1ZXIiKS5nZXRWYWx1ZTIoKQ0KI
 CAgICAgICBzYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlX2F1dGhuX2NvbnRleHQiKS5nZXRW
 YWx1ZTIoKSwgVHJ1ZSkNCiAgICAgICAgaWYgKHNhbWxfdXNlX2F1dGhuX2NvbnRleHQpOg0KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gY29uZmlndXJhdGlvbkF0dHJ
 pYnV0ZXMuZ2V0KCJzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQiKS5nZXRWYWx1ZTIoKQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgc2FtbF9uYW1lX2lkZW50aWZpZXJfZm9ybWF0ID0gTm
 9uZQ0KDQogICAgICAgIHNhbWxfY2VydGlmaWNhdGUgPSBzZWxmLmxvYWRDZXJpdGlmaWNhdGUoc2FtbF9jZXJ0aWZpY2F0ZV9maWxlKQ0KICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc
 2FtbF9jZXJ0aWZpY2F0ZSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBGaWxlIHdpdGggeDUwOSBjZXJ0aWZpY2F0ZSBzaG91bGQgYmUgbm90IGVtcHR5Ig0KICAg
 ICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24gPSBTYW1sQ29uZmlndXJhdGlvbigpDQoNCiAgICAgICAgIyBTZXQgdGhlIGlzc3VlciBvZiB0aGUgYXV0aGV
 udGljYXRpb24gcmVxdWVzdC4gVGhpcyB3b3VsZCB1c3VhbGx5IGJlIHRoZSBVUkwgb2YgdGhlIGlzc3Vpbmcgd2ViIGFwcGxpY2F0aW9uDQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldElzc3
 VlcihzYW1sX2lzc3VlcikNCg0KICAgICAgICAjIFRlbGxzIHRoZSBJZFAgdG8gcmV0dXJuIGEgcGVyc2lzdGVudCBpZGVudGlmaWVyIGZvciB0aGUgdXNlcg0KICAgICAgICBzYW1sQ29uZmlndXJhd
 Glvbi5zZXROYW1lSWRlbnRpZmllckZvcm1hdChzYW1sX25hbWVfaWRlbnRpZmllcl9mb3JtYXQpDQogIA0KICAgICAgICAjIFRoZSBVUkwgYXQgdGhlIElkZW50aXR5IFByb3ZpZGVyIHdoZXJlIHRv
 IHRoZSBhdXRoZW50aWNhdGlvbiByZXF1ZXN0IHNob3VsZCBiZSBzZW50DQogICAgICAgIHNhbWxDb25maWd1cmF0aW9uLnNldElkcFNzb1RhcmdldFVybChzYW1sX2lkcF9zc29fdGFyZ2V0X3VybCk
 NCg0KICAgICAgICAjIEVuYWJsZWRpYWJsZSBSZXF1ZXN0ZWRBdXRobkNvbnRleHQNCiAgICAgICAgc2FtbENvbmZpZ3VyYXRpb24uc2V0VXNlUmVxdWVzdGVkQXV0aG5Db250ZXh0KHNhbWxfdXNlX2
 F1dGhuX2NvbnRleHQpDQogICAgICAgIA0KICAgICAgICAjIExvYWQgeDUwOSBjZXJ0aWZpY2F0ZQ0KICAgICAgICBzYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3RyaW5nKHNhb
 WxfY2VydGlmaWNhdGUpDQogICAgICAgIA0KICAgICAgICBzZWxmLnNhbWxDb25maWd1cmF0aW9uID0gc2FtbENvbmZpZ3VyYXRpb24NCg0KICAgICAgICBzZWxmLmF0dHJpYnV0ZXNNYXBwaW5nID0g
 Tm9uZQ0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCIpIGFuZA0KICAgICAgICAgICAgY29uZmlndXJhdGlvbkF
 0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IikpOg0KDQogICAgICAgICAgICBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QgPSBjb25maWd1cmF0aW9uQXR0cm
 lidXRlcy5nZXQoInNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCIpLmdldFZhbHVlMigpDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0K
 Sk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0IGlzIGVtcHR5Ig0KICAgICAgICAgICAgICAg
 IHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3Q
 iKS5nZXRWYWx1ZTIoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc0VtcHR5KHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0KSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIE
 luaXRpYWxpemF0aW9uLiBUaGUgcHJvcGVydHkgc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNlb
 GYuYXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0KQ0KICAgICAg
 ICAgICAgaWYgKHNlbGYuYXR0cmlidXRlc01hcHBpbmcgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBUaGUgYXR0cmlidXRlcyBtYXBwaW5nIGl
 zbid0IHZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgIHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZSA9IE5vbmUNCiAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb25BdH
 RyaWJ1dGVzLmNvbnRhaW5zS2V5KCJzYW1sX2V4dGVuc2lvbl9tb2R1bGUiKSk6DQogICAgICAgICAgICBzYW1sX2V4dGVuc2lvbl9tb2R1bGVfbmFtZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzL
 mdldCgic2FtbF9leHRlbnNpb25fbW9kdWxlIikuZ2V0VmFsdWUyKCkNCiAgICAgICAgICAgIHRyeToNCiAgICAgICAgICAgICAgICBzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgPSBfX2ltcG9ydF9f
 KHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9uYW1lKQ0KICAgICAgICAgICAgICAgIHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9pbml0X3Jlc3VsdCA9IHNlbGYuc2FtbEV4dGVuc2lvbk1vZHVsZS5pbml0KGN
 vbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKQ0KICAgICAgICAgICAgICAgIGlmIChub3Qgc2FtbF9leHRlbnNpb25fbW9kdWxlX2luaXRfcmVzdWx0KToNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE
 ZhbHNlDQogICAgICAgICAgICBleGNlcHQgSW1wb3J0RXJyb3IsIGV4Og0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBJbml0aWFsaXphdGlvbi4gRmFpbGVkIHRvIGxvYWQgc2FtbF9leHRlb
 nNpb25fbW9kdWxlOiIsIHNhbWxfZXh0ZW5zaW9uX21vZHVsZV9uYW1lDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemF0aW9uLiBVbmV4cGVjdGVkIGVycm9yOiIsIGV4DQog
 ICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgcHJpbnQgIlNhbWwuIEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiB
 kZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIlNhbWwuIERlc3Ryb3kiDQogICAgICAgIHByaW50ICJTYW1sLiBEZXN0cm95ZWQgc3VjY2Vzc2Z1bG
 x5Ig0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgaXNWYWxpZEF1dGhlbnRpY2F0aW9uTWV0aG9kK
 HNlbGYsIHVzYWdlVHlwZSwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFsdGVybmF0aXZlQXV0aGVudGljYXRpb25NZXRob2Qoc2Vs
 ZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgYXV0aGVudGljYXRlKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGV
 zLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGNvbnRleHQgPSBDb250ZXh0cy5nZXRFdmVudENvbnRleHQoKQ0KICAgICAgICBhdXRoZW50aWNhdGlvblNlcnZpY2UgPSBBdXRoZW
 50aWNhdGlvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICB1c2VyU2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBzYW1sX21hcF91c2VyID0gRmFsc2UNCiAgICAgI
 CAgc2FtbF9lbnJvbGxfdXNlciA9IEZhbHNlDQogICAgICAgIHNhbWxfZW5yb2xsX2FsbF91c2VyX2F0dHIgPSBGYWxzZQ0KICAgICAgICAjIFVzZSBzYW1sX2RlcGxveW1lbnRfdHlwZSBvbmx5IGlm
 IHRoZXJlIGlzIG5vIGF0dHJpYnV0ZXMgbWFwcGluZw0KICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfZGVwbG95bWVudF90eXBlIikpOg0KICAgICA
 gICAgICAgc2FtbF9kZXBsb3ltZW50X3R5cGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2UoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX2RlcGxveW1lbnRfdHlwZSIpLmdldFZhbH
 VlMigpKQ0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2Uoc2FtbF9kZXBsb3ltZW50X3R5cGUsICJtYXAiKSk6DQogICAgICAgICAgICAgI
 CAgc2FtbF9tYXBfdXNlciA9IFRydWUNCg0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcmVDYXNlKHNhbWxfZGVwbG95bWVudF90eXBlLCAiZW5yb2xsIikpOg0KICAgICAg
 ICAgICAgICAgIHNhbWxfZW5yb2xsX3VzZXIgPSBUcnVlDQoNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShzYW1sX2RlcGxveW1lbnRfdHlwZSwgImVucm9sbF9
 hbGxfYXR0ciIpKToNCiAgICAgICAgICAgICAgICBzYW1sX2Vucm9sbF9hbGxfdXNlcl9hdHRyID0gVHJ1ZQ0KDQogICAgICAgIHNhbWxfYWxsb3dfYmFzaWNfbG9naW4gPSBGYWxzZQ0KICAgICAgIC
 BpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFpbnNLZXkoInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICBzYW1sX2FsbG93X2Jhc2ljX2xvZ2luID0gU3RyaW5nS
 GVscGVyLnRvQm9vbGVhbihjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZXQoInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKS5nZXRWYWx1ZTIoKSwgRmFsc2UpDQoNCiAgICAgICAgdXNlX2Jhc2ljX2F1
 dGggPSBGYWxzZQ0KICAgICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgICAgICAjIERldGVjdCBpZiB1c2VyIHVzZWQgYmFzaWMgYXV0aG5ldGljYXRpb24gbWV0aG9kDQo
 gICAgICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KDQogICAgICAgICAgICB1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZS
 gpDQogICAgICAgICAgICB1c2VyX3Bhc3N3b3JkID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHVzZXJfbmFtZSkgYW5kI
 FN0cmluZ0hlbHBlci5pc05vdEVtcHR5KHVzZXJfcGFzc3dvcmQpKToNCiAgICAgICAgICAgICAgICB1c2VfYmFzaWNfYXV0aCA9IFRydWUNCg0KICAgICAgICBpZiAoKHN0ZXAgPT0gMSkgYW5kIHNh
 bWxfYWxsb3dfYmFzaWNfbG9naW4gYW5kIHVzZV9iYXNpY19hdXRoKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQmFzaWMgYXV0aGVudGljYXRpb24
 iDQoNCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX2NvdW50X2xvZ2luX3N0ZXBzIiwgMSkNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZW
 RlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdldFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZ
 CgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlz
 Tm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIHVzZXJTZXJ2aWNlID0gVXNlclNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICAgICAgICAgIGxvZ2dlZF9pbiA
 9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgICByZXR1cm4gRm
 Fsc2UNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICBpZiAoc3RlcCA9PSAxKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KI
 CAgICAgICAgICAgY3VycmVudFNhbWxDb25maWd1cmF0aW9uID0gc2VsZi5nZXRDdXJyZW50U2FtbENvbmZpZ3VyYXRpb24oc2VsZi5zYW1sQ29uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJp
 YnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAgaWYgKGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbiA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGF
 yZSBmb3Igc3RlcCAxLiBDbGllbnQgc2FtbCBjb25maWd1cmF0aW9uIGlzIGludmFsaWQiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfcmVzcG9uc2VfYX
 JyYXkgPSByZXF1ZXN0UGFyYW1ldGVycy5nZXQoIlNBTUxSZXNwb25zZSIpDQogICAgICAgICAgICBpZiBBcnJheUhlbHBlci5pc0VtcHR5KHNhbWxfcmVzcG9uc2VfYXJyYXkpOg0KICAgICAgICAgI
 CAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gc2FtbF9yZXNwb25zZSBpcyBlbXB0eSINCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAg
 c2FtbF9yZXNwb25zZSA9IHNhbWxfcmVzcG9uc2VfYXJyYXlbMF0NCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBzYW1sX3Jlc3BvbnNlOiIsIHNhbWx
 fcmVzcG9uc2UNCg0KICAgICAgICAgICAgc2FtbFJlc3BvbnNlID0gUmVzcG9uc2UoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgc2FtbFJlc3BvbnNlLmxvYWRYbWxGcm9tQm
 FzZTY0KHNhbWxfcmVzcG9uc2UpDQogICAgICAgICAgICANCiAgICAgICAgICAgIHNhbWxfdmFsaWRhdGVfcmVzcG9uc2UgPSBUcnVlDQogICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpY
 nV0ZXMuY29udGFpbnNLZXkoInNhbWxfdmFsaWRhdGVfcmVzcG9uc2UiKSk6DQogICAgICAgICAgICAgICAgc2FtbF92YWxpZGF0ZV9yZXNwb25zZSA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29u
 ZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJzYW1sX3ZhbGlkYXRlX3Jlc3BvbnNlIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgICAgICBpZiAoc2FtbF92YWxpZGF0ZV9yZXNwb25zZSk
 6DQogICAgICAgICAgICAgICAgaWYgKG5vdCBzYW1sUmVzcG9uc2UuaXNWYWxpZCgpKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBzYW
 1sX3Jlc3BvbnNlIGlzbid0IHZhbGlkIg0KDQogICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25hbWVfaWQgPSBzYW1sUmVzcG9uc2UuZ2V0TmFtZUlkKCkNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZ
 WxwZXIuaXNFbXB0eShzYW1sX3Jlc3BvbnNlX25hbWVfaWQpKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmFtZV9p
 ZCBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIHNhbWxfcmVzcG9uc2VfbmF
 tZV9pZDoiLCBzYW1sX3Jlc3BvbnNlX25hbWVfaWQNCg0KICAgICAgICAgICAgc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVzID0gc2FtbFJlc3BvbnNlLmdldEF0dHJpYnV0ZXMoKQ0KICAgICAgICAgIC
 AgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBhdHRyaWJ1dGVzOiAiLCBzYW1sX3Jlc3BvbnNlX2F0dHJpYnV0ZXMNCg0KICAgICAgICAgICAgIyBVc2UgcGVyc2lzdGVudCBJZ
 CBhcyBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICBzYW1sX3VzZXJfdWlkID0gc2FtbF9yZXNwb25zZV9uYW1lX2lkDQogICAgICAgICAgICANCiAgICAgICAgICAgIGlmIChzYW1sX21hcF91c2Vy
 KToNCiAgICAgICAgICAgICAgICAjIFVzZSBtYXBwaW5nIHRvIGxvY2FsIElEUCB1c2VyDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBBdHRlbXB
 0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZW
 Qgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2Ftb
 F91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBz
 dGVwIDEuIEZhaWxlZCB0byBmaW5kIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gU2V0dGluZyBjb3VudCBzdGVwcyB0byAyIg0
 KICAgICAgICAgICAgICAgICAgICBjb250ZXh0LnNldCgic2FtbF9jb3VudF9sb2dpbl9zdGVwcyIsIDIpDQogICAgICAgICAgICAgICAgICAgIGNvbnRleHQuc2V0KCJzYW1sX3VzZXJfdWlkIiwgc2
 FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgICAgICAgICAgICAgIGZvdW5kX3VzZXJfbmFtZSA9IGZpbmRfdXNlcl9ieV91aWQuZ2V0VXNlcklkKCkNC
 iAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIGZvdW5kX3VzZXJfbmFtZToiLCBmb3VuZF91c2VyX25hbWUNCiAgICAgICAgICAgICAgICANCiAgICAg
 ICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXR
 oZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogIC
 AgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50I
 HN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxm
 LnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3I
 gc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbGlmIChzYW
 1sX2Vucm9sbF91c2VyKToNCiAgICAgICAgICAgICAgICAjIFVzZSBhdXRvIGVucm9sbG1lbnQgdG8gbG9jYWwgSURQDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb
 3Igc3RlcCAxLiBBdHRlbXB0aW5nIHRvIGZpbmQgdXNlciBieSBveEV4dGVybmFsVWlkOiBzYW1sOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVz
 ZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQ
 iLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAjIEF1dG8gdXNlciBlbn
 JvbGxlbW50DQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gVGhlcmUgaXMgbm8gdXNlciBpbiBMREFQLiBBZGRpbmcgdXNlciB0byBsb2Nhb
 CBMREFQIg0KDQogICAgICAgICAgICAgICAgICAgICMgQ29udmVydCBzYW1sIHJlc3VsdCBhdHRyaWJ1dGVzIGtleXMgdG8gbG92ZXIgY2FzZQ0KICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3Bv
 bnNlX25vcm1hbGl6ZWRfYXR0cmlidXRlcyA9IEhhc2hNYXAoKQ0KICAgICAgICAgICAgICAgICAgICBmb3Igc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVfZW50cnkgaW4gc2FtbF9yZXNwb25zZV9hdHR
 yaWJ1dGVzLmVudHJ5U2V0KCk6DQogICAgICAgICAgICAgICAgICAgICAgICBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cmlidXRlcy5wdXQoDQogICAgICAgICAgICAgICAgICAgICAgICAgIC
 AgU3RyaW5nSGVscGVyLnRvTG93ZXJDYXNlKHNhbWxfcmVzcG9uc2VfYXR0cmlidXRlX2VudHJ5LmdldEtleSgpKSwgc2FtbF9yZXNwb25zZV9hdHRyaWJ1dGVfZW50cnkuZ2V0VmFsdWUoKSkNCg0KI
 CAgICAgICAgICAgICAgICAgICBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVDdXJyZW50QXR0cmlidXRlc01hcHBpbmcoc2VsZi5hdHRyaWJ1dGVzTWFwcGluZywgY29uZmln
 dXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIFVzaW5nIG5leHQgYXR0cml
 idXRlcyBtYXBwaW5nIiwgY3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nDQoNCiAgICAgICAgICAgICAgICAgICAgbmV3VXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICAgICBmb3IgYXR0cmlidX
 Rlc01hcHBpbmdFbnRyeSBpbiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcuZW50cnlTZXQoKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGlkcEF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNNYXBwaW5nR
 W50cnkuZ2V0S2V5KCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsQXR0cmlidXRlID0gYXR0cmlidXRlc01hcHBpbmdFbnRyeS5nZXRWYWx1ZSgpDQoNCiAgICAgICAgICAgICAgICAgICAg
 ICAgIGxvY2FsQXR0cmlidXRlVmFsdWUgPSBzYW1sX3Jlc3BvbnNlX25vcm1hbGl6ZWRfYXR0cmlidXRlcy5nZXQoaWRwQXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F
 sQXR0cmlidXRlICE9IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKGxvY2FsQXR0cmlidXRlLCBsb2NhbEF0dHJpYnV0ZVZhbHVlKQ0KDQogIC
 AgICAgICAgICAgICAgICAgIG5ld1VzZXIuc2V0QXR0cmlidXRlKCJveEV4dGVybmFsVWlkIiwgInNhbWw6IiArIHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sL
 iBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBhZGQgdXNlciIsIHNhbWxfdXNlcl91aWQsICIgd2l0aCBuZXh0IGF0dHJpYnV0ZXMiLCBuZXdVc2VyLmdldEN1c3RvbUF0dHJp
 YnV0ZXMoKQ0KDQogICAgICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyKG5ld1VzZXIsIFRydWUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJ
 TYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2
 VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZ
 m91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAg
 ICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8
 gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZX
 R0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZ
 XN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhl
 bnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICA
 gICBlbGlmIChzYW1sX2Vucm9sbF9hbGxfdXNlcl9hdHRyKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEF0dGVtcHRpbmcgdG8gZmluZCB1c2
 VyIGJ5IG94RXh0ZXJuYWxVaWQ6IHNhbWw6IiArIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZ
 A0KICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQiLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0K
 ICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDEuIEZhaWxlZCB
 0byBmaW5kIHVzZXIiDQoNCiAgICAgICAgICAgICAgICAgICAgdXNlciA9IFVzZXIoKQ0KICAgICAgICAgICAgICAgICAgICBjdXN0b21BdHRyaWJ1dGVzID0gQXJyYXlMaXN0KCkNCiAgICAgICAgIC
 AgICAgICAgICAgZm9yIGtleSBpbiBhdHRyaWJ1dGVzLmtleVNldCgpOg0KICAgICAgICAgICAgICAgICAgICAgICAgbGRhcEF0dHJpYnV0ZXMgPSBhdHRyaWJ1dGVTZXJ2aWNlLmdldEFsbEF0dHJpY
 nV0ZXMoKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxkYXBBdHRyaWJ1dGUgaW4gbGRhcEF0dHJpYnV0ZXM6DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtbDJVcmkgPSBsZGFw
 QXR0cmlidXRlLmdldFNhbWwyVXJpKCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzYW1sMlVyaSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtbDJ
 VcmkgPSBhdHRyaWJ1dGVTZXJ2aWNlLmdldERlZmF1bHRTYW1sMlVyaShsZGFwQXR0cmlidXRlLmdldE5hbWUoKSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihzYW1sMlVyaSA9PSBrZX
 kpOg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdHRyaWJ1dGUgPSBDdXN0b21BdHRyaWJ1dGUobGRhcEF0dHJpYnV0ZS5nZXROYW1lKCkpDQogICAgICAgICAgICAgICAgICAgICAgI
 CAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZXMoYXR0cmlidXRlcy5nZXQoa2V5KSkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cmlidXRl
 KQ0KDQogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgib3hFeHRlcm5hbFVpZCIpDQogICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZSgic2F
 tbDoiICsgc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cmlidXRlKQ0KICAgICAgICAgICAgICAgICAgICB1c2VyLnNldEN1c3RvbUF0dH
 JpYnV0ZXMoY3VzdG9tQXR0cmlidXRlcykNCg0KICAgICAgICAgICAgICAgICAgICBpZih1c2VyLmdldEF0dHJpYnV0ZSgic24iKSA9PSBOb25lKToNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0d
 HJpYnV0ZSA9IEN1c3RvbUF0dHJpYnV0ZSgic24iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlLnNldFZhbHVlKHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgICAgICAg
 ICBjdXN0b21BdHRyaWJ1dGVzLmFkZChhdHRyaWJ1dGUpDQoNCiAgICAgICAgICAgICAgICAgICAgaWYodXNlci5nZXRBdHRyaWJ1dGUoImNuIikgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgICA
 gICAgICBhdHRyaWJ1dGUgPSBDdXN0b21BdHRyaWJ1dGUoImNuIikNCiAgICAgICAgICAgICAgICAgICAgICAgIGF0dHJpYnV0ZS5zZXRWYWx1ZShzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgIC
 AgICAgICAgICAgY3VzdG9tQXR0cmlidXRlcy5hZGQoYXR0cmlidXRlKQ0KDQogICAgICAgICAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5hZGRVc2VyKHVzZXIsIFRyd
 WUpDQogICAgICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQWRkZWQgbmV3IHVzZXIgd2l0aCBVSUQiLCBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJ
 ZCgpDQoNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSB
 mb3Igc3RlcCAxLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aG
 VudGljYXRlKGZvdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1d
 GhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNh
 bWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0
 KDQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogIC
 AgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0d
 XJuIHBvc3RfbG9naW5fcmVzdWx0DQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIGlzIHVzZXIgd2l0aCBzcGVjaWZpZWQgc2FtbF91c2VyX3VpZA0KICAg
 ICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gQXR0ZW1wdGluZyB0byBmaW5kIHVzZXIgYnkgdWlkOiIsIHNhbWxfdXNlcl91aWQNCg0KICAgICAgICAgICA
 gICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyKHNhbWxfdXNlcl91aWQpDQogICAgICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgIC
 AgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMS4gRmFpbGVkIHRvIGZpbmQgdXNlciINCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgI
 CAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAx
 LiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQoNCiAgICAgICAgICAgICAgICB1c2VyX2F1dGhlbnRpY2F0ZWQgPSBhdXRoZW50aWNhdGlvblNlcnZpY2UuYXV0aGVudGljYXRlKGZ
 vdW5kX3VzZXJfbmFtZSkNCiAgICAgICAgICAgICAgICBpZiAodXNlcl9hdXRoZW50aWNhdGVkID09IEZhbHNlKToNCiAgICAgICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZS
 Bmb3Igc3RlcCAxLiBGYWlsZWQgdG8gYXV0aGVudGljYXRlIHVzZXIiDQogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlb
 nRpY2F0ZSBmb3Igc3RlcCAxLiBTZXR0aW5nIGNvdW50IHN0ZXBzIHRvIDEiDQogICAgICAgICAgICAgICAgY29udGV4dC5zZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiLCAxKQ0KDQogICAgICAg
 ICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxFeHRlbnNpb25Qb3N0TG9naW4oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIGZpbmRfdXNlcl9ieV91aWQpDQogICAgICAgICAgICA
 gICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0ZSBmb3Igc3RlcCAxLiBwb3N0X2xvZ2luX3Jlc3VsdDoiLCBwb3N0X2xvZ2luX3Jlc3VsdA0KDQogICAgICAgICAgICAgICAgcmV0dXJuIHBvc3RfbG
 9naW5fcmVzdWx0DQogICAgICAgIGVsaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIiDQoNCiAgICAgICAgICAgIHNlc3Npb25Bd
 HRyaWJ1dGVzID0gY29udGV4dC5nZXQoInNlc3Npb25BdHRyaWJ1dGVzIikNCiAgICAgICAgICAgIGlmIChzZXNzaW9uQXR0cmlidXRlcyA9PSBOb25lKSBvciBub3Qgc2Vzc2lvbkF0dHJpYnV0ZXMu
 Y29udGFpbnNLZXkoInNhbWxfdXNlcl91aWQiKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHNhbWxfdXNlcl91aWQgaXMgZW1wdHkiDQogICA
 gICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHNhbWxfdXNlcl91aWQgPSBzZXNzaW9uQXR0cmlidXRlcy5nZXQoInNhbWxfdXNlcl91aWQiKQ0KICAgICAgICAgICAgcGFzc2
 VkX3N0ZXAxID0gU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcoc2FtbF91c2VyX3VpZCkNCiAgICAgICAgICAgIGlmIChub3QgcGFzc2VkX3N0ZXAxKToNCiAgICAgICAgICAgICAgICByZXR1c
 m4gRmFsc2UNCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRpYWxzKCkNCiAgICAgICAgICAgIHVzZXJfbmFtZSA9IGNyZWRlbnRpYWxzLmdl
 dFVzZXJuYW1lKCkNCiAgICAgICAgICAgIHVzZXJfcGFzc3dvcmQgPSBjcmVkZW50aWFscy5nZXRQYXNzd29yZCgpDQoNCiAgICAgICAgICAgIGxvZ2dlZF9pbiA9IEZhbHNlDQogICAgICAgICAgICB
 pZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9uYW1lKSBhbmQgU3RyaW5nSGVscGVyLmlzTm90RW1wdHlTdHJpbmcodXNlcl9wYXNzd29yZCkpOg0KICAgICAgICAgICAgICAgIG
 xvZ2dlZF9pbiA9IHVzZXJTZXJ2aWNlLmF1dGhlbnRpY2F0ZSh1c2VyX25hbWUsIHVzZXJfcGFzc3dvcmQpDQoNCiAgICAgICAgICAgIGlmIChub3QgbG9nZ2VkX2luKToNCiAgICAgICAgICAgICAgI
 CByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgIyBDaGVjayBpZiB0aGVyZSBpcyB1c2VyIHdoaWNoIGhhcyBzYW1sX3VzZXJfdWlkDQogICAgICAgICAgICAjIEF2b2lkIG1hcHBpbmcgU2FtbCBh
 Y2NvdW50IHRvIG1vcmUgdGhhbiBvbmUgSURQIGFjY291bnQNCiAgICAgICAgICAgIGZpbmRfdXNlcl9ieV91aWQgPSB1c2VyU2VydmljZS5nZXRVc2VyQnlBdHRyaWJ1dGUoIm94RXh0ZXJuYWxVaWQ
 iLCAic2FtbDoiICsgc2FtbF91c2VyX3VpZCkNCg0KICAgICAgICAgICAgaWYgKGZpbmRfdXNlcl9ieV91aWQgPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgIyBBZGQgc2FtbF91c2VyX3VpZCB0by
 B1c2VyIG9uZSBpZCBVSURzDQogICAgICAgICAgICAgICAgZmluZF91c2VyX2J5X3VpZCA9IHVzZXJTZXJ2aWNlLmFkZFVzZXJBdHRyaWJ1dGUodXNlcl9uYW1lLCAib3hFeHRlcm5hbFVpZCIsICJzY
 W1sOiIgKyBzYW1sX3VzZXJfdWlkKQ0KICAgICAgICAgICAgICAgIGlmIChmaW5kX3VzZXJfYnlfdWlkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGlj
 YXRlIGZvciBzdGVwIDIuIEZhaWxlZCB0byB1cGRhdGUgY3VycmVudCB1c2VyIg0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmV
 zdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZXJfYnlfdWlkKQ0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBBdXRoZW
 50aWNhdGUgZm9yIHN0ZXAgMi4gcG9zdF9sb2dpbl9yZXN1bHQ6IiwgcG9zdF9sb2dpbl9yZXN1bHQNCg0KICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICAgI
 CAgZWxzZToNCiAgICAgICAgICAgICAgICBmb3VuZF91c2VyX25hbWUgPSBmaW5kX3VzZXJfYnlfdWlkLmdldFVzZXJJZCgpDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEF1dGhlbnRpY2F0
 ZSBmb3Igc3RlcCAyLiBmb3VuZF91c2VyX25hbWU6IiwgZm91bmRfdXNlcl9uYW1lDQogICAgDQogICAgICAgICAgICAgICAgaWYgU3RyaW5nSGVscGVyLmVxdWFscyh1c2VyX25hbWUsIGZvdW5kX3V
 zZXJfbmFtZSk6DQogICAgICAgICAgICAgICAgICAgIHBvc3RfbG9naW5fcmVzdWx0ID0gc2VsZi5zYW1sRXh0ZW5zaW9uUG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBmaW5kX3VzZX
 JfYnlfdWlkKQ0KICAgICAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQXV0aGVudGljYXRlIGZvciBzdGVwIDIuIHBvc3RfbG9naW5fcmVzdWx0OiIsIHBvc3RfbG9naW5fcmVzdWx0DQogICAgD
 QogICAgICAgICAgICAgICAgICAgIHJldHVybiBwb3N0X2xvZ2luX3Jlc3VsdA0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICBlbHNlOg0KICAgICAgICAgICAgcmV0
 dXJuIEZhbHNlDQoNCiAgICBkZWYgcHJlcGFyZUZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgY29udGV4dCA9IEN
 vbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgIGF1dGhlbnRpY2F0aW9uU2VydmljZSA9IEF1dGhlbnRpY2F0aW9uU2VydmljZS5pbnN0YW5jZSgpDQoNCiAgICAgICAgaWYgKHN0ZXAgPT
 0gMSk6DQogICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSBmb3Igc3RlcCAxIg0KICAgICAgICAgICAgDQogICAgICAgICAgICBodHRwU2VydmljZSA9IEh0dHBTZXJ2aWNlLmluc3RhbmNlK
 Ck7DQogICAgICAgICAgICByZXF1ZXN0ID0gRmFjZXNDb250ZXh0LmdldEN1cnJlbnRJbnN0YW5jZSgpLmdldEV4dGVybmFsQ29udGV4dCgpLmdldFJlcXVlc3QoKQ0KICAgICAgICAgICAgYXNzZXJ0
 aW9uQ29uc3VtZXJTZXJ2aWNlVXJsID0gaHR0cFNlcnZpY2UuY29uc3RydWN0U2VydmVyVXJsKHJlcXVlc3QpICsgIi9wb3N0bG9naW4iDQogICAgICAgICAgICBwcmludCAiU2FtbC4gUHJlcGFyZSB
 mb3Igc3RlcCAxLiBQcmVwYXJlZCBhc3NlcnRpb25Db25zdW1lclNlcnZpY2VVcmw6IiwgYXNzZXJ0aW9uQ29uc3VtZXJTZXJ2aWNlVXJsDQogICAgICAgICAgICANCiAgICAgICAgICAgIGN1cnJlbn
 RTYW1sQ29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9uKHNlbGYuc2FtbENvbmZpZ3VyYXRpb24sIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyY
 W1ldGVycykNCiAgICAgICAgICAgIGlmIChjdXJyZW50U2FtbENvbmZpZ3VyYXRpb24gPT0gTm9uZSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gQ2xp
 ZW50IHNhbWwgY29uZmlndXJhdGlvbiBpcyBpbnZhbGlkIg0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KDQogICAgICAgICAgICAjIEdlbmVyYXRlIGFuIEF1dGhSZXF1ZXN0IGFuZCBzZW5
 kIGl0IHRvIHRoZSBpZGVudGl0eSBwcm92aWRlcg0KICAgICAgICAgICAgc2FtbEF1dGhSZXF1ZXN0ID0gQXV0aFJlcXVlc3QoY3VycmVudFNhbWxDb25maWd1cmF0aW9uKQ0KICAgICAgICAgICAgZX
 h0ZXJuYWxfYXV0aF9yZXF1ZXN0X3VyaSA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5nZXRJZHBTc29UYXJnZXRVcmwoKSArICI/U0FNTFJlcXVlc3Q9IiArIHNhbWxBdXRoUmVxdWVzdC5nZXRSZ
 XF1ZXN0KFRydWUsIGFzc2VydGlvbkNvbnN1bWVyU2VydmljZVVybCkNCg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmUgZm9yIHN0ZXAgMS4gZXh0ZXJuYWxfYXV0aF9yZXF1ZXN0X3Vy
 aToiLCBleHRlcm5hbF9hdXRoX3JlcXVlc3RfdXJpDQogICAgICAgICAgICANCiAgICAgICAgICAgIGNvbnRleHQuc2V0KCJleHRlcm5hbF9hdXRoX3JlcXVlc3RfdXJpIiwgZXh0ZXJuYWxfYXV0aF9
 yZXF1ZXN0X3VyaSkNCg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxpZiAoc3RlcCA9PSAyKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlIGZvciBzdGVwIDIiDQ
 oNCiAgICAgICAgICAgIHJldHVybiBUcnVlDQogICAgICAgIGVsc2U6DQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCg0KICAgIGRlZiBnZXRFeHRyYVBhcmFtZXRlcnNGb3JTdGVwKHNlbGYsIGNvb
 mZpZ3VyYXRpb25BdHRyaWJ1dGVzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMik6DQogICAgICAgICAgICByZXR1cm4gQXJyYXlzLmFzTGlzdCgic2FtbF91c2VyX3VpZCIpDQoNCiAgICAg
 ICAgcmV0dXJuIE5vbmUNCg0KICAgIGRlZiBnZXRDb3VudEF1dGhlbnRpY2F0aW9uU3RlcHMoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBjb250ZXh0ID0gQ29udGV4dHM
 uZ2V0RXZlbnRDb250ZXh0KCkNCiAgICAgICAgaWYgKGNvbnRleHQuaXNTZXQoInNhbWxfY291bnRfbG9naW5fc3RlcHMiKSk6DQogICAgICAgICAgICByZXR1cm4gY29udGV4dC5nZXQoInNhbWxfY2
 91bnRfbG9naW5fc3RlcHMiKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIDINCg0KICAgIGRlZiBnZXRQYWdlRm9yU3RlcChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgc3RlcCk6DQogI
 CAgICAgIGlmIChzdGVwID09IDEpOg0KICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9IEZhbHNlDQogICAgICAgICAgICBpZiAoY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuY29udGFp
 bnNLZXkoInNhbWxfYWxsb3dfYmFzaWNfbG9naW4iKSk6DQogICAgICAgICAgICAgICAgc2FtbF9hbGxvd19iYXNpY19sb2dpbiA9IFN0cmluZ0hlbHBlci50b0Jvb2xlYW4oY29uZmlndXJhdGlvbkF
 0dHJpYnV0ZXMuZ2V0KCJzYW1sX2FsbG93X2Jhc2ljX2xvZ2luIikuZ2V0VmFsdWUyKCksIEZhbHNlKQ0KDQogICAgICAgICAgICBpZiAoc2FtbF9hbGxvd19iYXNpY19sb2dpbik6DQogICAgICAgIC
 AgICAgICAgcmV0dXJuICIvbG9naW4ueGh0bWwiDQogICAgICAgICAgICBlbHNlOg0KICAgICAgICAgICAgICAgIHJldHVybiAiL2F1dGgvc2FtbC9zYW1sbG9naW4ueGh0bWwiDQoNCiAgICAgICAgc
 mV0dXJuICIvYXV0aC9zYW1sL3NhbWxwb3N0bG9naW4ueGh0bWwiDQoNCiAgICBkZWYgbG9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAg
 ICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgaXNQYXNzZWRTdGVwMSgpOg0KICAgICAgICBjcmVkZW50aWFscyA9IElkZW50aXR5Lmluc3RhbmNlKCkuZ2V0Q3JlZGVudGlhbHMoKQ0KICAgICAgICB
 1c2VyX25hbWUgPSBjcmVkZW50aWFscy5nZXRVc2VybmFtZSgpDQogICAgICAgIHBhc3NlZF9zdGVwMSA9IFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKHVzZXJfbmFtZSkNCg0KICAgICAgIC
 ByZXR1cm4gcGFzc2VkX3N0ZXAxDQoNCiAgICBkZWYgbG9hZENlcml0aWZpY2F0ZShzZWxmLCBzYW1sX2NlcnRpZmljYXRlX2ZpbGUpOg0KICAgICAgICBzYW1sX2NlcnRpZmljYXRlID0gTm9uZQ0KD
 QogICAgICAgICMgTG9hZCBjZXJ0aWZpY2F0ZSBmcm9tIGZpbGUNCiAgICAgICAgZiA9IG9wZW4oc2FtbF9jZXJ0aWZpY2F0ZV9maWxlLCAncicpDQogICAgICAgIHRyeToNCiAgICAgICAgICAgIHNh
 bWxfY2VydGlmaWNhdGUgPSBmLnJlYWQoKQ0KICAgICAgICBleGNlcHQ6DQogICAgICAgICAgICBwcmludCAiRmFpbGVkIHRvIGxvYWQgY2VydGlmaWNhdGUgZnJvbSBmaWxlOiIsIHNhbWxfY2VydGl
 maWNhdGVfZmlsZQ0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgZmluYWxseToNCiAgICAgICAgICAgIGYuY2xvc2UoKQ0KICAgICAgICANCiAgICAgICAgcmV0dXJuIHNhbWxfY2VydG
 lmaWNhdGUNCg0KICAgIGRlZiBnZXRDbGllbnRDb25maWd1cmF0aW9uKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgICMgR2V0IGNsaWVud
 CBjb25maWd1cmF0aW9uDQogICAgICAgIGlmIChjb25maWd1cmF0aW9uQXR0cmlidXRlcy5jb250YWluc0tleSgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKSk6DQogICAgICAg
 ICAgICBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSA9IGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLmdldCgic2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1dGUiKS5nZXR
 WYWx1ZTIoKQ0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIFVzaW5nIGNsaWVudCBhdHRyaWJ1dGU6Iiwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdH
 RyaWJ1dGUNCg0KICAgICAgICAgICAgaWYgKHJlcXVlc3RQYXJhbWV0ZXJzID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHJldHVybiBOb25lDQoNCiAgICAgICAgICAgIGNsaWVudF9pZCA9IE5vb
 mUNCiAgICAgICAgICAgIGNsaWVudF9pZF9hcnJheSA9IHJlcXVlc3RQYXJhbWV0ZXJzLmdldCgiY2xpZW50X2lkIikNCiAgICAgICAgICAgIGlmIChBcnJheUhlbHBlci5pc05vdEVtcHR5KGNsaWVu
 dF9pZF9hcnJheSkgYW5kIFN0cmluZ0hlbHBlci5pc05vdEVtcHR5U3RyaW5nKGNsaWVudF9pZF9hcnJheVswXSkpOg0KICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGNsaWVudF9pZF9hcnJheVs
 wXQ0KDQogICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIGV2ZW50Q29udGV4dCA9IENvbnRleHRzLmdldEV2ZW50Q29udGV4dCgpDQogICAgICAgICAgIC
 AgICAgaWYgKGV2ZW50Q29udGV4dC5pc1NldCgic2Vzc2lvbkF0dHJpYnV0ZXMiKSk6DQogICAgICAgICAgICAgICAgICAgIGNsaWVudF9pZCA9IGV2ZW50Q29udGV4dC5nZXQoInNlc3Npb25BdHRya
 WJ1dGVzIikuZ2V0KCJjbGllbnRfaWQiKQ0KDQogICAgICAgICAgICBpZiAoY2xpZW50X2lkID09IE5vbmUpOg0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBHZXRDbGllbnRDb25maWd1cmF0
 aW9uLiBjbGllbnRfaWQgaXMgZW1wdHkiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KICAgICAgICAgICAgY2xpZW50U2VydmljZSA9IENsaWVudFNlcnZpY2UuaW5zdGFuY2UoKQ0KICA
 gICAgICAgICAgY2xpZW50ID0gY2xpZW50U2VydmljZS5nZXRDbGllbnQoY2xpZW50X2lkKQ0KICAgICAgICAgICAgaWYgKGNsaWVudCA9PSBOb25lKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2
 FtbC4gR2V0Q2xpZW50Q29uZmlndXJhdGlvbi4gRmFpbGVkIHRvIGZpbmQgY2xpZW50IiwgY2xpZW50X2lkLCAiIGluIGxvY2FsIExEQVAiDQogICAgICAgICAgICAgICAgcmV0dXJuIE5vbmUNCg0KI
 CAgICAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IGNsaWVudFNlcnZpY2UuZ2V0Q3VzdG9tQXR0cmlidXRlKGNsaWVudCwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl9hdHRyaWJ1
 dGUpDQogICAgICAgICAgICBpZiAoKHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24gPT0gTm9uZSkgb3IgU3RyaW5nSGVscGVyLmlzRW1wdHkoc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbi5nZXRWYWx
 1ZSgpKSk6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsIGNsaWVudF9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maW
 d1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpcyBlbXB0eSINCiAgICAgICAgICAgIGVsc2U6DQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEdldENsaWVudENvbmZpZ3VyYXRpb24uIENsaWVudCIsI
 GNsaWVudF9pZCwgIiBhdHRyaWJ1dGUiLCBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX2F0dHJpYnV0ZSwgIiBpcyIsIHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb24NCiAgICAgICAgICAgICAgICBy
 ZXR1cm4gc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbg0KDQogICAgICAgIHJldHVybiBOb25lDQoNCiAgICBkZWYgZ2V0Q3VycmVudFNhbWxDb25maWd1cmF0aW9uKHNlbGYsIGN1cnJlbnRTYW1sQ29
 uZmlndXJhdGlvbiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKToNCiAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbiA9IHNlbGYuZ2V0Q2xpZW50Q29uZm
 lndXJhdGlvbihjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFBhcmFtZXRlcnMpDQogICAgICAgIGlmIChzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uID09IE5vbmUpOg0KICAgICAgICAgI
 CAgcmV0dXJuIGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbg0KICAgICAgICANCiAgICAgICAgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZSA9IGpzb24ubG9hZHMoc2FtbF9jbGllbnRfY29u
 ZmlndXJhdGlvbi5nZXRWYWx1ZSgpKQ0KDQogICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gTm9uZSAgICAgIA0KICAgICAgICBjbGllbnRfc2FtbF9jZXJ0aWZpY2F0ZV9maWxlID0gc2F
 tbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZVsic2FtbF9jZXJ0aWZpY2F0ZV9maWxlIl0NCiAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5pc05vdEVtcHR5KGNsaWVudF9zYW1sX2NlcnRpZmljYX
 RlX2ZpbGUpKToNCiAgICAgICAgICAgIGNsaWVudF9zYW1sX2NlcnRpZmljYXRlID0gc2VsZi5sb2FkQ2VyaXRpZmljYXRlKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlX2ZpbGUpDQogICAgICAgICAgI
 CBpZiAoU3RyaW5nSGVscGVyLmlzRW1wdHkoY2xpZW50X3NhbWxfY2VydGlmaWNhdGUpKToNCiAgICAgICAgICAgICAgICBwcmludCAiU2FtbC4gQnVpbGRDbGllbnRTYW1sQ29uZmlndXJhdGlvbi4g
 RmlsZSB3aXRoIHg1MDkgY2VydGlmaWNhdGUgc2hvdWxkIGJlIG5vdCBlbXB0eS4gVXNpbmcgZGVmYXVsdCBjb25maWd1cmF0aW9uIg0KICAgICAgICAgICAgICAgIHJldHVybiBjdXJyZW50U2FtbEN
 vbmZpZ3VyYXRpb24NCg0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbiA9IGN1cnJlbnRTYW1sQ29uZmlndXJhdGlvbi5jbG9uZSgpDQogICAgICAgIA0KICAgICAgICBpZiAoY2xpZW50X3
 NhbWxfY2VydGlmaWNhdGUgIT0gTm9uZSk6DQogICAgICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5sb2FkQ2VydGlmaWNhdGVGcm9tU3RyaW5nKGNsaWVudF9zYW1sX2NlcnRpZmljYXRlK
 Q0KDQogICAgICAgIGNsaWVudF9zYW1sX2lzc3VlciA9IHNhbWxfY2xpZW50X2NvbmZpZ3VyYXRpb25fdmFsdWVbInNhbWxfaXNzdWVyIl0NCiAgICAgICAgY2xpZW50U2FtbENvbmZpZ3VyYXRpb24u
 c2V0SXNzdWVyKGNsaWVudF9zYW1sX2lzc3VlcikNCiAgICAgICAgDQogICAgICAgIHNhbWxfdXNlX2F1dGhuX2NvbnRleHQgPSBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJzYW1sX3V
 zZV9hdXRobl9jb250ZXh0Il0NCiAgICAgICAgY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0ID0gU3RyaW5nSGVscGVyLnRvQm9vbGVhbihzYW1sX3VzZV9hdXRobl9jb250ZXh0LCBUcn
 VlKQ0KICAgICAgICBjbGllbnRTYW1sQ29uZmlndXJhdGlvbi5zZXRVc2VSZXF1ZXN0ZWRBdXRobkNvbnRleHQoY2xpZW50X3VzZV9zYW1sX3VzZV9hdXRobl9jb250ZXh0KQ0KDQogICAgICAgIHJld
 HVybiBjbGllbnRTYW1sQ29uZmlndXJhdGlvbg0KDQogICAgZGVmIHByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZyhzZWxmLCBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QsIHNhbWxfbG9jYWxfYXR0cmli
 dXRlc19saXN0KToNCiAgICAgICAgc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5ID0gU3RyaW5nSGVscGVyLnNwbGl0KHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICB
 pZiAoQXJyYXlIZWxwZXIuaXNFbXB0eShzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZX
 JlIGlzIG5vIGF0dHJpYnV0ZXMgc3BlY2lmaWVkIGluIHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdCBwcm9wZXJ0eSINCiAgICAgICAgICAgIHJldHVybiBOb25lDQogICAgICAgIA0KICAgICAgICBzY
 W1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSA9IFN0cmluZ0hlbHBlci5zcGxpdChzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdCwgIiwiKQ0KICAgICAgICBpZiAoQXJyYXlIZWxwZXIuaXNF
 bXB0eShzYW1sX2xvY2FsX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gYXR0cmlidXR
 lcyBzcGVjaWZpZWQgaW4gc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3QgcHJvcGVydHkiDQogICAgICAgICAgICByZXR1cm4gTm9uZQ0KDQogICAgICAgIGlmIChsZW4oc2FtbF9pZHBfYXR0cmlidX
 Rlc19saXN0X2FycmF5KSAhPSBsZW4oc2FtbF9sb2NhbF9hdHRyaWJ1dGVzX2xpc3RfYXJyYXkpKToNCiAgICAgICAgICAgIHByaW50ICJTYW1sLiBQcmVwYXJlQXR0cmlidXRlc01hcHBpbmcuIFRoZ
 SBudW1iZXIgb2YgYXR0cmlidXRlcyBpbiBzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QgYW5kIHNhbWxfbG9jYWxfYXR0cmlidXRlc19saXN0IGlzbid0IGVxdWFsIg0KICAgICAgICAgICAgcmV0dXJu
 IE5vbmUNCiAgICAgICAgDQogICAgICAgIGF0dHJpYnV0ZU1hcHBpbmcgPSBJZGVudGl0eUhhc2hNYXAoKQ0KICAgICAgICBjb250YWluc1VpZCA9IEZhbHNlDQogICAgICAgIGkgPSAwDQogICAgICA
 gIGNvdW50ID0gbGVuKHNhbWxfaWRwX2F0dHJpYnV0ZXNfbGlzdF9hcnJheSkNCiAgICAgICAgd2hpbGUgKGkgPCBjb3VudCk6DQogICAgICAgICAgICBpZHBBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZX
 IudG9Mb3dlckNhc2Uoc2FtbF9pZHBfYXR0cmlidXRlc19saXN0X2FycmF5W2ldKQ0KICAgICAgICAgICAgbG9jYWxBdHRyaWJ1dGUgPSBTdHJpbmdIZWxwZXIudG9Mb3dlckNhc2Uoc2FtbF9sb2Nhb
 F9hdHRyaWJ1dGVzX2xpc3RfYXJyYXlbaV0pDQogICAgICAgICAgICBhdHRyaWJ1dGVNYXBwaW5nLnB1dChpZHBBdHRyaWJ1dGUsIGxvY2FsQXR0cmlidXRlKQ0KDQogICAgICAgICAgICBpZiAoU3Ry
 aW5nSGVscGVyLmVxdWFsc0lnbm9yZUNhc2UobG9jYWxBdHRyaWJ1dGUsICJ1aWQiKSk6DQogICAgICAgICAgICAgICAgY29udGFpbnNVaWQgPSBUcnVlDQoNCiAgICAgICAgICAgIGkgPSBpICsgMQ0
 KDQogICAgICAgIGlmIChub3QgY29udGFpbnNVaWQpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVBdHRyaWJ1dGVzTWFwcGluZy4gVGhlcmUgaXMgbm8gbWFwcGluZyB0byBtYW5kYX
 RvcnkgJ3VpZCcgYXR0cmlidXRlIg0KICAgICAgICAgICAgcmV0dXJuIE5vbmUNCiAgICAgICAgDQogICAgICAgIHJldHVybiBhdHRyaWJ1dGVNYXBwaW5nDQoNCiAgICBkZWYgcHJlcGFyZUN1cnJlb
 nRBdHRyaWJ1dGVzTWFwcGluZyhzZWxmLCBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6DQogICAgICAgIHNhbWxfY2xp
 ZW50X2NvbmZpZ3VyYXRpb24gPSBzZWxmLmdldENsaWVudENvbmZpZ3VyYXRpb24oY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzKQ0KICAgICAgICBpZiAoc2FtbF9jbGl
 lbnRfY29uZmlndXJhdGlvbiA9PSBOb25lKToNCiAgICAgICAgICAgIHJldHVybiBjdXJyZW50QXR0cmlidXRlc01hcHBpbmcNCg0KICAgICAgICBzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbH
 VlID0ganNvbi5sb2FkcyhzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uLmdldFZhbHVlKCkpDQoNCiAgICAgICAgY2xpZW50QXR0cmlidXRlc01hcHBpbmcgPSBzZWxmLnByZXBhcmVBdHRyaWJ1dGVzT
 WFwcGluZyhzYW1sX2NsaWVudF9jb25maWd1cmF0aW9uX3ZhbHVlWyJzYW1sX2lkcF9hdHRyaWJ1dGVzX2xpc3QiXSwgc2FtbF9jbGllbnRfY29uZmlndXJhdGlvbl92YWx1ZVsic2FtbF9sb2NhbF9h
 dHRyaWJ1dGVzX2xpc3QiXSkNCiAgICAgICAgaWYgKGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nID09IE5vbmUpOg0KICAgICAgICAgICAgcHJpbnQgIlNhbWwuIFByZXBhcmVDdXJyZW50QXR0cmlidXR
 lc01hcHBpbmcuIENsaWVudCBhdHRyaWJ1dGVzIG1hcHBpbmcgaXMgaW52YWxpZC4gVXNpbmcgZGVmYXVsdCBvbmUiDQogICAgICAgICAgICByZXR1cm4gY3VycmVudEF0dHJpYnV0ZXNNYXBwaW5nDQ
 oNCiAgICAgICAgcmV0dXJuIGNsaWVudEF0dHJpYnV0ZXNNYXBwaW5nDQoNCiAgICBkZWYgc2FtbEV4dGVuc2lvblBvc3RMb2dpbihzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgdXNlcik6D
 QogICAgICAgIGlmIChzZWxmLnNhbWxFeHRlbnNpb25Nb2R1bGUgIT0gTm9uZSk6DQogICAgICAgICAgICB0cnk6DQogICAgICAgICAgICAgICAgcG9zdF9sb2dpbl9yZXN1bHQgPSBzZWxmLnNhbWxF
 eHRlbnNpb25Nb2R1bGUucG9zdExvZ2luKGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCB1c2VyKQ0KICAgICAgICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4gcmVzdWx0OiI
 sIHBvc3RfbG9naW5fcmVzdWx0DQoNCiAgICAgICAgICAgICAgICByZXR1cm4gcG9zdF9sb2dpbl9yZXN1bHQNCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24sIGV4Og0KICAgICAgICAgICAgIC
 AgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgcHJpbnQgIlNhbWwuIEV4dGVuc2lvblBvc
 3Rsb2dpbi4gVW5leHBlY3RlZCBlcnJvcjoiLCBleA0KICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQ0KICAgICAgICAgICAgZXhjZXB0IGphdmEubGFuZy5UaHJvd2FibGUsIGV4Og0KICAgICAg
 ICAgICAgICAgIHByaW50ICJTYW1sLiBFeHRlbnNpb25Qb3N0bG9naW4uIEZhaWxlZCB0byBleGVjdXRlIHBvc3RMb2dpbiBtZXRob2QiDQogICAgICAgICAgICAgICAgZXgucHJpbnRTdGFja1RyYWN
 lKCkgDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQogICAgICAgICAgICAgICAgICAgIA0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: person_authentication
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B788,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Client Registration script
displayName: client_registration
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B788
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5jbGllbnQgaW1wb
 3J0IENsaWVudFJlZ2lzdHJhdGlvblR5cGUNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJp
 bmdIZWxwZXIsIEFycmF5SGVscGVyDQpmcm9tIG9yZy54ZGkub3hhdXRoLnNlcnZpY2UgaW1wb3J
 0IFNjb3BlU2VydmljZQ0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJyYXlMaXN0DQ
 oNCmltcG9ydCBqYXZhDQoNCmNsYXNzIENsaWVudFJlZ2lzdHJhdGlvbihDbGllbnRSZWdpc3RyY
 XRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0K
 ICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICA
 gIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbn
 QgIkNsaWVudCByZWdpc3RyYXRpb24uIEluaXRpYWxpemF0aW9uIg0KDQogICAgICAgIHNlbGYuc
 2NvcGVTZXJ2aWNlID0gU2NvcGVTZXJ2aWNlLmluc3RhbmNlKCkNCg0KICAgICAgICBwcmludCAi
 Q2xpZW50IHJlZ2lzdHJhdGlvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICA
 gIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQX
 R0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJDbGllbnQgcmVnaXN0cmF0aW9uLiBEZXN0cm95I
 g0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzdHJhdGlvbi4gRGVzdHJveWVkIHN1Y2Nlc3Nm
 dWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgICMgVXBkYXRlIGNsaWVudCBlbnR
 yeSBiZWZvcmUgcGVyc2lzdGVudCBpdA0KICAgICMgICByZWdpc3RlclJlcXVlc3QgaXMgb3JnLn
 hkaS5veGF1dGguY2xpZW50LlJlZ2lzdGVyUmVxdWVzdA0KICAgICMgICBjbGllbnQgaXMgb3JnL
 nhkaS5veGF1dGgubW9kZWwucmVnaXN0cmF0aW9uLkNsaWVudA0KICAgICMgICBjb25maWd1cmF0
 aW9uQXR0cmlidXRlcyBpcyBqYXZhLnV0aWwuTWFwPFN0cmluZywgU2ltcGxlQ3VzdG9tUHJvcGV
 ydHk+DQogICAgZGVmIHVwZGF0ZUNsaWVudChzZWxmLCByZWdpc3RlclJlcXVlc3QsIGNsaWVudC
 wgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiQ2xpZW50IHJlZ2lzd
 HJhdGlvbi4gVXBkYXRlQ2xpZW50IG1ldGhvZCINCg0KICAgICAgICByZWRpcmVjdFVyaXMgPSBj
 bGllbnQuZ2V0UmVkaXJlY3RVcmlzKCkNCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXR
 pb24uIFJlZGlyZWN0IFVyaXM6IiwgcmVkaXJlY3RVcmlzDQoNCiAgICAgICAgYWRkQWRkcmVzc1
 Njb3BlID0gRmFsc2UNCiAgICAgICAgZm9yIHJlZGlyZWN0VXJpIGluIHJlZGlyZWN0VXJpczoNC
 iAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2FzZShyZWRpcmVjdFVy
 aSwgImh0dHBzOi8vY2xpZW50LmV4YW1wbGUuY29tL2V4YW1wbGUxIikpOg0KICAgICAgICAgICA
 gICAgIGFkZEFkZHJlc3NTY29wZSA9IFRydWUNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgIC
 AgICANCiAgICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIElzIGFkZCBhZGRyZXNzI
 HNjb3BlOiIsIGFkZEFkZHJlc3NTY29wZQ0KDQogICAgICAgIGlmIChhZGRBZGRyZXNzU2NvcGUp
 Og0KICAgICAgICAgICAgY3VycmVudFNjb3BlcyA9IGNsaWVudC5nZXRTY29wZXMoKQ0KICAgICA
 gICAgICAgcHJpbnQgIkNsaWVudCByZWdpc3RyYXRpb24uIEN1cnJlbnQgc2NvcGVzOiIsIGN1cn
 JlbnRTY29wZXMNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgYWRkcmVzc1Njb3BlID0gc2VsZ
 i5zY29wZVNlcnZpY2UuZ2V0U2NvcGVCeURpc3BsYXlOYW1lKCJhZGRyZXNzIikNCiAgICAgICAg
 ICAgIG5ld1Njb3BlcyA9IEFycmF5SGVscGVyLmFkZEl0ZW1Ub1N0cmluZ0FycmF5KGN1cnJlbnR
 TY29wZXMsIGFkZHJlc3NTY29wZS5nZXREbigpKQ0KICAgIA0KICAgICAgICAgICAgcHJpbnQgIk
 NsaWVudCByZWdpc3RyYXRpb24uIFJlc3VsdCBzY29wZXM6IiwgbmV3U2NvcGVzDQogICAgICAgI
 CAgICBjbGllbnQuc2V0U2NvcGVzKG5ld1Njb3BlcykNCg0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
 DQogICAgZGVmIGxvZ291dChzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcywgcmVxdWVzdFB
 hcmFtZXRlcnMpOg0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGdldEFwaVZlcnNpb2
 4oc2VsZik6DQogICAgICAgIHJldHVybiAxDQo=
oxScriptType: client_registration
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!DAA9.B789,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Application Session script
displayName: application_session
gluuStatus: false
inum: %(inumOrg)s!0011!DAA9.B789
oxLevel: 100
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zZXNzaW9uIGltc
 G9ydCBBcHBsaWNhdGlvblNlc3Npb25UeXBlDQpmcm9tIG9yZy54ZGkudXRpbCBpbXBvcnQgU3Ry
 aW5nSGVscGVyLCBBcnJheUhlbHBlcg0KZnJvbSBqYXZhLnV0aWwgaW1wb3J0IEFycmF5cywgQXJ
 yYXlMaXN0DQoNCmltcG9ydCBqYXZhDQoNCmNsYXNzIEFwcGxpY2F0aW9uU2Vzc2lvbihBcHBsaW
 NhdGlvblNlc3Npb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNa
 WxsaXMpOg0KICAgICAgICBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxs
 aXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcHJpbnQgIkFwcGxpY2F0aW9uIHNlc3Npb24uIEluaXRpYWxpemF0aW9uIg0KICAgICAgIC
 BwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gSW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KD
 QogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1
 cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiB
 EZXN0cm95Ig0KICAgICAgICBwcmludCAiQXBwbGljYXRpb24gc2Vzc2lvbi4gRGVzdHJveWVkIH
 N1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICAgIGRlZiBnZXRBcGlWZ
 XJzaW9uKHNlbGYpOg0KICAgICAgICByZXR1cm4gMQ0KDQogICAgIyBBcHBsaWNhdGlvbiBjYWxs
 cyBpdCBhdCBlbmQgc2Vzc2lvbiByZXF1ZXN0IHRvIGFsbG93IG5vdGlmeSAzcmQgcGFydCBzeXN
 0ZW1zDQogICAgIyAgIGh0dHBSZXF1ZXN0IGlzIGphdmF4LnNlcnZsZXQuaHR0cC5IdHRwU2Vydm
 xldFJlcXVlc3QNCiAgICAjICAgYXV0aG9yaXphdGlvbkdyYW50IGlzIG9yZy54ZGkub3hhdXRoL
 m1vZGVsLmNvbW1vbi5BdXRob3JpemF0aW9uR3JhbnQNCiAgICAjICAgY29uZmlndXJhdGlvbkF0
 dHJpYnV0ZXMgaXMgamF2YS51dGlsLk1hcDxTdHJpbmcsIFNpbXBsZUN1c3RvbVByb3BlcnR5Pg0
 KICAgIGRlZiBlbmRTZXNzaW9uKHNlbGYsIGh0dHBSZXF1ZXN0LCBhdXRob3JpemF0aW9uR3Jhbn
 QsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkFwcGxpY2F0aW9uI
 HNlc3Npb24uIFN0YXJ0aW5nIGV4dGVybmFsIHNlc3Npb24gZW5kIg0KDQogICAgICAgIHByaW50
 ICJBcHBsaWNhdGlvbiBzZXNzaW9uLiBFeHRlcm5hbCBzZXNzaW9uIGVuZGVkIHN1Y2Nlc3NmdWx
 seSINCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: application_session
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!031C.5621,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample Dynamic Scope script
displayName: dynamic_scope
gluuStatus: false
inum: %(inumOrg)s!0011!031C.5621
oxLevel: 100
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwO
 CkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQu
 DQojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4
 NCiMNCg0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY29wZSBpbXBvcn
 QgRHluYW1pY1Njb3BlVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlc
 iwgQXJyYXlIZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0K
 DQppbXBvcnQgamF2YQ0KDQpjbGFzcyBEeW5hbWljU2NvcGUoRHluYW1pY1Njb3BlVHlwZSk6DQo
 gICAgZGVmIF9faW5pdF9fKHNlbGYsIGN1cnJlbnRUaW1lTWlsbGlzKToNCiAgICAgICAgc2VsZi
 5jdXJyZW50VGltZU1pbGxpcyA9IGN1cnJlbnRUaW1lTWlsbGlzDQoNCiAgICBkZWYgaW5pdChzZ
 WxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJEeW5hbWljIHNj
 b3BlLiBJbml0aWFsaXphdGlvbiINCg0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29wZS4gSW5
 pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5Ig0KDQogICAgICAgIHJldHVybiBUcnVlICAgDQoNCiAgIC
 BkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHBya
 W50ICJEeW5hbWljIHNjb3BlLiBEZXN0cm95Ig0KICAgICAgICBwcmludCAiRHluYW1pYyBzY29w
 ZS4gRGVzdHJveWVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0dXJuIFRydWUgICANCg0KICA
 gICMgVXBkYXRlIEpzb24gV2ViIHRva2VuIGJlZm9yZSBzaWduaW5nL2VuY3J5cHJpbmcgaXQNCi
 AgICAjICAgZHluYW1pY1Njb3BlQ29udGV4dCBpcyBvcmcueGRpLm94YXV0aC5zZXJ2aWNlLmV4d
 GVybmFsLmNvbnRleHQuRHluYW1pY1Njb3BlRXh0ZXJuYWxDb250ZXh0DQogICAgIyAgIGNvbmZp
 Z3VyYXRpb25BdHRyaWJ1dGVzIGlzIGphdmEudXRpbC5NYXA8U3RyaW5nLCBTaW1wbGVDdXN0b21
 Qcm9wZXJ0eT4NCiAgICBkZWYgdXBkYXRlKHNlbGYsIGR5bmFtaWNTY29wZUNvbnRleHQsIGNvbm
 ZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIFVwZ
 GF0ZSBtZXRob2QiDQoNCiAgICAgICAgZHluYW1pY1Njb3BlcyA9IGR5bmFtaWNTY29wZUNvbnRl
 eHQuZ2V0RHluYW1pY1Njb3BlcygpDQogICAgICAgIGF1dGhvcml6YXRpb25HcmFudCA9IGR5bmF
 taWNTY29wZUNvbnRleHQuZ2V0QXV0aG9yaXphdGlvbkdyYW50KCkNCiAgICAgICAgdXNlciA9IG
 R5bmFtaWNTY29wZUNvbnRleHQuZ2V0VXNlcigpDQogICAgICAgIGpzb25XZWJSZXNwb25zZSA9I
 GR5bmFtaWNTY29wZUNvbnRleHQuZ2V0SnNvbldlYlJlc3BvbnNlKCkNCiAgICAgICAgY2xhaW1z
 ID0ganNvbldlYlJlc3BvbnNlLmdldENsYWltcygpDQoNCiAgICAgICAgIyBJdGVyYXRlIHRocm9
 1Z2ggbGlzdCBvZiBkeW5hbWljIHNjb3BlcyBpbiBvcmRlciB0byBhZGQgY3VzdG9tIHNjb3Blcy
 BpZiBuZWVkZWQNCiAgICAgICAgcHJpbnQgIkR5bmFtaWMgc2NvcGUuIER5bmFtaWMgc2NvcGVzO
 iIsIGR5bmFtaWNTY29wZXMNCiAgICAgICAgZm9yIGR5bmFtaWNTY29wZSBpbiBkeW5hbWljU2Nv
 cGVzOg0KICAgICAgICAgICAgIyBBZGQgb3JnYW5pemF0aW9uIG5hbWUgaWYgdGhlcmUgaXMgc2N
 vcGUgPSBvcmdfbmFtZQ0KICAgICAgICAgICAgaWYgKFN0cmluZ0hlbHBlci5lcXVhbHNJZ25vcm
 VDYXNlKGR5bmFtaWNTY29wZSwgIm9yZ19uYW1lIikpOg0KICAgICAgICAgICAgICAgIGNsYWltc
 y5zZXRDbGFpbSgib3JnX25hbWUiLCAiR2x1dSwgSW5jLiIpDQogICAgICAgICAgICAgICAgY29u
 dGludWUNCg0KICAgICAgICAgICAgIyBBZGQgd29yayBwaG9uZSBpZiB0aGVyZSBpcyBzY29wZSA
 9IHdvcmtfcGhvbmUNCiAgICAgICAgICAgIGlmIChTdHJpbmdIZWxwZXIuZXF1YWxzSWdub3JlQ2
 FzZShkeW5hbWljU2NvcGUsICJ3b3JrX3Bob25lIikpOg0KICAgICAgICAgICAgICAgIHdvcmtQa
 G9uZSA9IHVzZXIuZ2V0QXR0cmlidXRlKCJ0ZWxlcGhvbmVOdW1iZXIiKTsNCiAgICAgICAgICAg
 ICAgICBpZiAoU3RyaW5nSGVscGVyLmlzTm90RW1wdHkod29ya1Bob25lKSk6DQogICAgICAgICA
 gICAgICAgICAgIGNsYWltcy5zZXRDbGFpbSgid29ya19waG9uZSIsIHdvcmtQaG9uZSkNCiAgIC
 AgICAgICAgICAgICBjb250aW51ZQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgb
 G9nb3V0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycyk6
 DQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToNCiA
 gICAgICAgcmV0dXJuIDENCg==
oxScriptType: dynamic_scope
programmingLanguage: python

version: 1
dn: inum=%(inumOrg)s!0011!A910.56AB,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: oxCustomScript
objectClass: top
description: Sample script for SCIM events
displayName: scim_event_handler
gluuStatus: false
inum: %(inumOrg)s!0011!A910.56AB
oxConfigurationProperty: {"value1":"testProp1","value2":"Test value 1","description":""}
oxConfigurationProperty: {"value1":"testProp2","value2":"Test value 2","description":""}
oxLevel: 100
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""}
oxRevision: 1
oxScript:: ZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5zY2ltIGltcG9yd
 CBTY2ltVHlwZQ0KZnJvbSBvcmcueGRpLnV0aWwgaW1wb3J0IFN0cmluZ0hlbHBlciwgQXJyYXlI
 ZWxwZXINCmZyb20gamF2YS51dGlsIGltcG9ydCBBcnJheXMsIEFycmF5TGlzdA0KZnJvbSBvcmc
 uZ2x1dS5veHRydXN0LmxkYXAuc2VydmljZSBpbXBvcnQgSVBlcnNvblNlcnZpY2UsIFBlcnNvbl
 NlcnZpY2UNCmZyb20gb3JnLmdsdXUub3h0cnVzdC5tb2RlbCBpbXBvcnQgR2x1dUN1c3RvbVBlc
 nNvbg0KDQppbXBvcnQgamF2YQ0KDQpjbGFzcyBTY2ltRXZlbnRIYW5kbGVyKFNjaW1UeXBlKToN
 Cg0KICAgIGRlZiBfX2luaXRfXyhzZWxmLCBjdXJyZW50VGltZU1pbGxpcyk6DQogICAgICAgIHN
 lbGYuY3VycmVudFRpbWVNaWxsaXMgPSBjdXJyZW50VGltZU1pbGxpcw0KDQogICAgZGVmIGluaX
 Qoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2NpbUV2Z
 W50SGFuZGxlciAoaW5pdCk6IEluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseSINCiAgICAgICAgcmV0
 dXJuIFRydWUgICANCg0KICAgIGRlZiBkZXN0cm95KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ
 1dGVzKToNCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGRlc3Ryb3kpOiBEZXN0cm
 95ZWQgc3VjY2Vzc2Z1bGx5Ig0KICAgICAgICByZXR1cm4gVHJ1ZSAgIA0KDQogICAgZGVmIGdld
 EFwaVZlcnNpb24oc2VsZik6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgY3JlYXRlVXNl
 cihzZWxmLCB1c2VyLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQoNCiAgICAgICAgcHJpbnQ
 gIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiBDdXJyZW50IGlkID0gIiArIHVzZXIuZ2
 V0VWlkKCkNCg0KICAgICAgICB0ZXN0UHJvcDEgPSBjb25maWd1cmF0aW9uQXR0cmlidXRlcy5nZ
 XQoInRlc3RQcm9wMSIpLmdldFZhbHVlMigpDQogICAgICAgIHRlc3RQcm9wMiA9IGNvbmZpZ3Vy
 YXRpb25BdHRyaWJ1dGVzLmdldCgidGVzdFByb3AyIikuZ2V0VmFsdWUyKCkNCg0KICAgICAgICB
 wcmludCAiU2NpbUV2ZW50SGFuZGxlciAoY3JlYXRlVXNlcik6IHRlc3RQcm9wMSA9ICIgKyB0ZX
 N0UHJvcDENCiAgICAgICAgcHJpbnQgIlNjaW1FdmVudEhhbmRsZXIgKGNyZWF0ZVVzZXIpOiB0Z
 XN0UHJvcDIgPSAiICsgdGVzdFByb3AyDQoNCiAgICAgICAgcmV0dXJuIFRydWUNCg0KICAgIGRl
 ZiB1cGRhdGVVc2VyKHNlbGYsIHVzZXIsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICA
 gICAgcGVyc29uU2VydmljZSA9IFBlcnNvblNlcnZpY2UuaW5zdGFuY2UoKQ0KICAgICAgICBvbG
 RVc2VyID0gcGVyc29uU2VydmljZS5nZXRQZXJzb25CeVVpZCh1c2VyLmdldFVpZCgpKQ0KICAgI
 CAgICBwcmludCAiU2NpbUV2ZW50SGFuZGxlciAodXBkYXRlVXNlcik6IE9sZCBkaXNwbGF5TmFt
 ZSA9ICIgKyBvbGRVc2VyIC5nZXREaXNwbGF5TmFtZSgpDQogICAgICAgIHByaW50ICJTY2ltRXZ
 lbnRIYW5kbGVyICh1cGRhdGVVc2VyKTogTmV3IGRpc3BsYXlOYW1lID0gIiArIHVzZXIuZ2V0RG
 lzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGRlbGV0ZVVzZXIoc
 2VsZiwgdXNlciwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMpOg0KICAgICAgICBwcmludCAiU2Np
 bUV2ZW50SGFuZGxlciAoZGVsZXRlVXNlcik6IEN1cnJlbnQgaWQgPSAiICsgdXNlci5nZXRVaWQ
 oKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIGNyZWF0ZUdyb3VwKHNlbGYsIGdyb3
 VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50ICJTY2ltRXZlbnRIY
 W5kbGVyIChjcmVhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0
 RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVmIHVwZGF0ZUdyb3V
 wKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHByaW50IC
 JTY2ltRXZlbnRIYW5kbGVyICh1cGRhdGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiI
 CsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0KDQogICAgZGVm
 IGRlbGV0ZUdyb3VwKHNlbGYsIGdyb3VwLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICA
 gICAgIHByaW50ICJTY2ltRXZlbnRIYW5kbGVyIChkZWxldGVHcm91cCk6IEN1cnJlbnQgZGlzcGxheU5hbWUgPSAiICsgZ3JvdXAuZ2V0RGlzcGxheU5hbWUoKQ0KICAgICAgICByZXR1cm4gVHJ1ZQ0K
oxScriptType: scim
programmingLanguage: python

dn: inum=%(inumOrg)s!0011!24FD.B96E,ou=scripts,o=%(inumOrg)s,o=gluu
objectClass: top
objectClass: oxCustomScript
description: OTP Validation of passwords using Yubicloud
displayName: yubicloud
gluuStatus: false
inum: %(inumOrg)s!0011!24FD.B96E
oxConfigurationProperty: {"value1":"yubicloud_uri","value2":"api.yubico.com"
 ,"description":""}
oxConfigurationProperty: {"value1":"yubicloud_api_key","value2":"","descript
 ion":""}
oxConfigurationProperty: {"value1":"yubicloud_id","value2":"","description":
 ""}
oxLevel: 90
oxModuleProperty: {"value1":"usage_type","value2":"interactive","description
 ":""}
oxModuleProperty: {"value1":"location_type","value2":"ldap","description":""
 }
oxRevision: 1
oxScript:: IyBveEF1dGggaXMgYXZhaWxhYmxlIHVuZGVyIHRoZSBNSVQgTGljZW5zZSAoMjAwOCkuIFNlZSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUIGZvciBmdWxsIHRleHQuD
 QojIENvcHlyaWdodCAoYykgMjAxNiwgR2x1dQ0KIw0KIyBBdXRob3I6IFl1cml5IE1vdmNoYW4sIEFydW5tb3poaQ0KIw0KDQpmcm9tIG9yZy5qYm9zcy5zZWFtLnNlY3VyaXR5IGltcG9ydCBJZGVu
 dGl0eQ0KZnJvbSBvcmcueGRpLm1vZGVsLmN1c3RvbS5zY3JpcHQudHlwZS5hdXRoIGltcG9ydCBQZXJzb25BdXRoZW50aWNhdGlvblR5cGUNCmZyb20gb3JnLnhkaS5veGF1dGguc2VydmljZSBpbXB
 vcnQgVXNlclNlcnZpY2UNCmZyb20gb3JnLnhkaS51dGlsIGltcG9ydCBTdHJpbmdIZWxwZXINCg0KaW1wb3J0IGphdmENCg0KaW1wb3J0IHVybGxpYjINCmltcG9ydCB1cmxsaWINCmltcG9ydCB1dW
 lkDQoNCg0KY2xhc3MgUGVyc29uQXV0aGVudGljYXRpb24oUGVyc29uQXV0aGVudGljYXRpb25UeXBlKToNCiAgICBkZWYgX19pbml0X18oc2VsZiwgY3VycmVudFRpbWVNaWxsaXMpOg0KICAgICAgI
 CBzZWxmLmN1cnJlbnRUaW1lTWlsbGlzID0gY3VycmVudFRpbWVNaWxsaXMNCg0KICAgIGRlZiBpbml0KHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcHJpbnQgIll1Ymlj
 bG91ZC4gSW5pdGlhbGl6YXRpb24iDQoNCiAgICAgICAgc2VsZi5hcGlfc2VydmVyID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ5dWJpY2xvdWRfdXJpIikuZ2V0VmFsdWUyKCkNCiAgICA
 gICAgc2VsZi5hcGlfa2V5ID0gY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ5dWJpY2xvdWRfYXBpX2tleSIpLmdldFZhbHVlMigpDQogICAgICAgIHNlbGYuY2xpZW50X2lkID0gY29uZmlndX
 JhdGlvbkF0dHJpYnV0ZXMuZ2V0KCJ5dWJpY2xvdWRfaWQiKS5nZXRWYWx1ZTIoKQ0KDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZGVzdHJveShzZWxmLCBjb25maWd1cmF0aW9uQXR0c
 mlidXRlcyk6DQogICAgICAgIHByaW50ICJZdWJpY2xvdWQuIERlc3Ryb3llZCBzdWNjZXNzZnVsbHkiDQogICAgICAgIHJldHVybiBUcnVlDQoNCiAgICBkZWYgZ2V0QXBpVmVyc2lvbihzZWxmKToN
 CiAgICAgICAgcmV0dXJuIDENCg0KICAgIGRlZiBpc1ZhbGlkQXV0aGVudGljYXRpb25NZXRob2Qoc2VsZiwgdXNhZ2VUeXBlLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHV
 ybiBUcnVlDQoNCiAgICBkZWYgZ2V0QWx0ZXJuYXRpdmVBdXRoZW50aWNhdGlvbk1ldGhvZChzZWxmLCB1c2FnZVR5cGUsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzKToNCiAgICAgICAgcmV0dXJuIE
 5vbmUNCg0KICAgIGRlZiBhdXRoZW50aWNhdGUoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3RQYXJhbWV0ZXJzLCBzdGVwKToNCiAgICAgICAgaWYgKHN0ZXAgPT0gMSk6DQogI
 CAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBBdXRoZW50aWNhdGUgZm9yIHN0ZXAgMSINCg0KICAgICAgICAgICAgY3JlZGVudGlhbHMgPSBJZGVudGl0eS5pbnN0YW5jZSgpLmdldENyZWRlbnRp
 YWxzKCkNCiAgICAgICAgICAgIHVzZXJuYW1lID0gY3JlZGVudGlhbHMuZ2V0VXNlcm5hbWUoKQ0KICAgICAgICAgICAgb3RwID0gY3JlZGVudGlhbHMuZ2V0UGFzc3dvcmQoKQ0KDQogICAgICAgICA
 gICAjIFZhbGlkYXRlIG90cCBsZW5ndGgNCiAgICAgICAgICAgIGlmIGxlbihvdHApIDwgMzIgb3IgbGVuKG90cCkgPiA0ODoNCiAgICAgICAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBJbnZhbG
 lkIE9UUCBsZW5ndGgiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIHVzZXJfc2VydmljZSA9IFVzZXJTZXJ2aWNlLmluc3RhbmNlKCkNCiAgICAgICAgICAgIHVzZ
 XIgPSB1c2VyX3NlcnZpY2UuZ2V0VXNlcih1c2VybmFtZSkNCg0KICAgICAgICAgICAgcHVibGljX2tleSA9IHVzZXIuZ2V0QXR0cmlidXRlKCd5dWJpa2V5SWQnKQ0KDQogICAgICAgICAgICAjIE1h
 dGNoIHRoZSB1c2VyIHdpdGggdGhlIHl1YmlrZXkNCiAgICAgICAgICAgIGlmIHB1YmxpY19rZXkgbm90IGluIG90cDoNCiAgICAgICAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBQdWJsaWMgS2V
 5IG5vdCBtYXRjaGluZyBPVFAiDQogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlDQoNCiAgICAgICAgICAgIGRhdGEgPSAiIg0KICAgICAgICAgICAgdHJ5Og0KICAgICAgICAgICAgICAgIG5vbm
 NlID0gc3RyKHV1aWQudXVpZDQoKSkucmVwbGFjZSgiLSIsICIiKQ0KICAgICAgICAgICAgICAgIHBhcmFtcyA9IHVybGxpYi51cmxlbmNvZGUoeyJpZCI6IHNlbGYuY2xpZW50X2lkLCAib3RwIjogb
 3RwLCAibm9uY2UiOiBub25jZX0pDQogICAgICAgICAgICAgICAgdXJsID0gImh0dHBzOi8vIiArIHNlbGYuYXBpX3NlcnZlciArICIvd3NhcGkvMi4wL3ZlcmlmeS8/IiArIHBhcmFtcw0KICAgICAg
 ICAgICAgICAgIGYgPSB1cmxsaWIyLnVybG9wZW4odXJsKQ0KICAgICAgICAgICAgICAgIGRhdGEgPSBmLnJlYWQoKQ0KICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOg0KICAgICAgICA
 gICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEV4Y2VwdGlvbiAiLCBlDQoNCiAgICAgICAgICAgIGlmICdzdGF0dXM9T0snIGluIGRhdGE6DQogICAgICAgICAgICAgICAgdXNlcl9zZXJ2aWNlLmF1dG
 hlbnRpY2F0ZSh1c2VybmFtZSkNCiAgICAgICAgICAgICAgICBwcmludCAiWXViaWNsb3VkLiBBdXRoZW50aWNhdGlvbiBTdWNjZXNzZnVsIg0KICAgICAgICAgICAgICAgIHJldHVybiBUcnVlDQoNC
 iAgICAgICAgICAgIHByaW50ICJZdWJpY2xvdWQuIEVuZCBvZiBTdGVwIDEuIFJldHVybmluZyBGYWxzZS4iDQogICAgICAgICAgICByZXR1cm4gRmFsc2UNCiAgICAgICAgZWxzZToNCiAgICAgICAg
 ICAgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIHByZXBhcmVGb3JTdGVwKHNlbGYsIGNvbmZpZ3VyYXRpb25BdHRyaWJ1dGVzLCByZXF1ZXN0UGFyYW1ldGVycywgc3RlcCk6DQogICAgICAgIGlmICh
 zdGVwID09IDEpOg0KICAgICAgICAgICAgcHJpbnQgIll1YmljbG91ZC4gUHJlcGFyZSBmb3IgU3RlcCAxIg0KICAgICAgICAgICAgcmV0dXJuIFRydWUNCiAgICAgICAgZWxzZToNCiAgICAgICAgIC
 AgIHJldHVybiBGYWxzZQ0KDQogICAgZGVmIGdldEV4dHJhUGFyYW1ldGVyc0ZvclN0ZXAoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gTm9uZQ0KD
 QogICAgZGVmIGdldENvdW50QXV0aGVudGljYXRpb25TdGVwcyhzZWxmLCBjb25maWd1cmF0aW9uQXR0cmlidXRlcyk6DQogICAgICAgIHJldHVybiAxDQoNCiAgICBkZWYgZ2V0UGFnZUZvclN0ZXAo
 c2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHN0ZXApOg0KICAgICAgICByZXR1cm4gIiINCg0KICAgIGRlZiBsb2dvdXQoc2VsZiwgY29uZmlndXJhdGlvbkF0dHJpYnV0ZXMsIHJlcXVlc3R
 QYXJhbWV0ZXJzKToNCiAgICAgICAgcmV0dXJuIFRydWUNCg==
oxScriptType: person_authentication
programmingLanguage: python
